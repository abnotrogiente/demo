import"./modulepreload-polyfill-B5Qt9EMX.js";var w=function(){var i,c={create:function(t){t=t||{};var r=document.createElement("canvas");r.width=800,r.height=600,"alpha"in t||(t.alpha=!1);try{i=r.getContext("webgl",t)}catch{}try{i=i||r.getContext("experimental-webgl",t)}catch{}if(!i)throw new Error("WebGL not supported");return i.HALF_FLOAT_OES=36193,T(),C(),O(),N(),i},keys:{},Matrix:p,Indexer:H,Buffer:k,Mesh:P,HitTest:j,Raytracer:Y,Shader:v,Texture:_,Vector:l};function T(){i.MODELVIEW=L|1,i.PROJECTION=L|2;var t=new p,r=new p;i.modelviewMatrix=new p,i.projectionMatrix=new p;var e=[],n=[],a,o;i.matrixMode=function(h){switch(h){case i.MODELVIEW:a="modelviewMatrix",o=e;break;case i.PROJECTION:a="projectionMatrix",o=n;break;default:throw new Error("invalid matrix mode "+h)}},i.loadIdentity=function(){p.identity(i[a])},i.loadMatrix=function(h){for(var s=h.m,m=i[a].m,f=0;f<16;f++)m[f]=s[f]},i.multMatrix=function(h){i.loadMatrix(p.multiply(i[a],h,r))},i.perspective=function(h,s,m,f){i.multMatrix(p.perspective(h,s,m,f,t))},i.frustum=function(h,s,m,f,u,d){i.multMatrix(p.frustum(h,s,m,f,u,d,t))},i.ortho=function(h,s,m,f,u,d){i.multMatrix(p.ortho(h,s,m,f,u,d,t))},i.scale=function(h,s,m){i.multMatrix(p.scale(h,s,m,t))},i.translate=function(h,s,m){i.multMatrix(p.translate(h,s,m,t))},i.rotate=function(h,s,m,f){i.multMatrix(p.rotate(h,s,m,f,t))},i.lookAt=function(h,s,m,f,u,d,x,g,y){i.multMatrix(p.lookAt(h,s,m,f,u,d,x,g,y,t))},i.pushMatrix=function(){o.push(Array.prototype.slice.call(i[a].m))},i.popMatrix=function(){var h=o.pop();i[a].m=W?new Float32Array(h):h},i.project=function(h,s,m,f,u,d){f=f||i.modelviewMatrix,u=u||i.projectionMatrix,d=d||i.getParameter(i.VIEWPORT);var x=u.transformPoint(f.transformPoint(new l(h,s,m)));return new l(d[0]+d[2]*(x.x*.5+.5),d[1]+d[3]*(x.y*.5+.5),x.z*.5+.5)},i.unProject=function(h,s,m,f,u,d){f=f||i.modelviewMatrix,u=u||i.projectionMatrix,d=d||i.getParameter(i.VIEWPORT);var x=new l((h-d[0])/d[2]*2-1,(s-d[1])/d[3]*2-1,m*2-1);return p.inverse(p.multiply(u,f,t),r).transformPoint(x)},i.matrixMode(i.MODELVIEW)}function C(){var t={mesh:new P({coords:!0,colors:!0,triangles:!1}),mode:-1,coord:[0,0,0,0],color:[1,1,1,1],shader:new v("      uniform float pointSize;      varying vec4 color;      varying vec4 coord;      void main() {        color = gl_Color;        coord = gl_TexCoord;        gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;        gl_PointSize = pointSize;      }    ","      uniform sampler2D texture;      uniform float pointSize;      uniform bool useTexture;      varying vec4 color;      varying vec4 coord;      void main() {        gl_FragColor = color;        if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);      }    ")};i.pointSize=function(r){t.shader.uniforms({pointSize:r})},i.begin=function(r){if(t.mode!=-1)throw new Error("mismatched gl.begin() and gl.end() calls");t.mode=r,t.mesh.colors=[],t.mesh.coords=[],t.mesh.vertices=[]},i.color=function(r,e,n,a){t.color=arguments.length==1?r.toArray().concat(1):[r,e,n,a||1]},i.texCoord=function(r,e){t.coord=arguments.length==1?r.toArray(2):[r,e]},i.vertex=function(r,e,n){t.mesh.colors.push(t.color),t.mesh.coords.push(t.coord),t.mesh.vertices.push(arguments.length==1?r.toArray():[r,e,n])},i.end=function(){if(t.mode==-1)throw new Error("mismatched gl.begin() and gl.end() calls");t.mesh.compile(),t.shader.uniforms({useTexture:!!i.getParameter(i.TEXTURE_BINDING_2D)}).draw(t.mesh,t.mode),t.mode=-1}}function O(){var t=i,r=0,e=0,n={},a=!1,o=Object.prototype.hasOwnProperty;function h(){for(var g in n)if(o.call(n,g)&&n[g])return!0;return!1}function s(g){var y={};for(var A in g)typeof g[A]=="function"?y[A]=function(Q){return function(){Q.apply(g,arguments)}}(g[A]):y[A]=g[A];y.original=g,y.x=y.pageX,y.y=y.pageY;for(var R=i.canvas;R;R=R.offsetParent)y.x-=R.offsetLeft,y.y-=R.offsetTop;return a?(y.deltaX=y.x-r,y.deltaY=y.y-e):(y.deltaX=0,y.deltaY=0,a=!0),r=y.x,e=y.y,y.dragging=h(),y.preventDefault=function(){y.original.preventDefault()},y.stopPropagation=function(){y.original.stopPropagation()},y}function m(g){i=t,h()||(M(document,"mousemove",f),M(document,"mouseup",u),D(i.canvas,"mousemove",f),D(i.canvas,"mouseup",u)),n[g.which]=!0,g=s(g),i.onmousedown&&i.onmousedown(g),g.preventDefault()}function f(g){i=t,g=s(g),i.onmousemove&&i.onmousemove(g),g.preventDefault()}function u(g){i=t,n[g.which]=!1,h()||(D(document,"mousemove",f),D(document,"mouseup",u),M(i.canvas,"mousemove",f),M(i.canvas,"mouseup",u)),g=s(g),i.onmouseup&&i.onmouseup(g),g.preventDefault()}function d(){a=!1}function x(){n={},a=!1}M(i.canvas,"mousedown",m),M(i.canvas,"mousemove",f),M(i.canvas,"mouseup",u),M(i.canvas,"mouseover",d),M(i.canvas,"mouseout",d),M(document,"contextmenu",x)}function X(t){var r={8:"BACKSPACE",9:"TAB",13:"ENTER",16:"SHIFT",27:"ESCAPE",32:"SPACE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"};return r[t]||(t>=65&&t<=90?String.fromCharCode(t):null)}function M(t,r,e){t.addEventListener(r,e)}function D(t,r,e){t.removeEventListener(r,e)}M(document,"keydown",function(t){if(!t.altKey&&!t.ctrlKey&&!t.metaKey){var r=X(t.keyCode);r&&(c.keys[r]=!0),c.keys[t.keyCode]=!0}}),M(document,"keyup",function(t){if(!t.altKey&&!t.ctrlKey&&!t.metaKey){var r=X(t.keyCode);r&&(c.keys[r]=!1),c.keys[t.keyCode]=!1}});function N(){(function(t){i.makeCurrent=function(){i=t}})(i),i.animate=function(){var t=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,16.666666666666668)},r=new Date().getTime(),e=i;function n(){i=e;var a=new Date().getTime();i.onupdate&&i.onupdate((a-r)/1e3),i.ondraw&&i.ondraw(),t(n),r=a}n()},i.fullscreen=function(t){t=t||{};var r=t.paddingTop||0,e=t.paddingLeft||0,n=t.paddingRight||0,a=t.paddingBottom||0;if(!document.body)throw new Error("document.body doesn't exist yet (call gl.fullscreen() from window.onload() or from inside the <body> tag)");document.body.appendChild(i.canvas),document.body.style.overflow="hidden",i.canvas.style.position="absolute",i.canvas.style.left=e+"px",i.canvas.style.top=r+"px";function o(){i.canvas.width=window.innerWidth-e-n,i.canvas.height=window.innerHeight-r-a,i.viewport(0,0,i.canvas.width,i.canvas.height),(t.camera||!("camera"in t))&&(i.matrixMode(i.PROJECTION),i.loadIdentity(),i.perspective(t.fov||45,i.canvas.width/i.canvas.height,t.near||.1,t.far||1e3),i.matrixMode(i.MODELVIEW)),i.ondraw&&i.ondraw()}M(window,"resize",o),o()}}var L=305397760,W=typeof Float32Array<"u";function p(){var t=Array.prototype.concat.apply([],arguments);t.length||(t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.m=W?new Float32Array(t):t}p.prototype={inverse:function(){return p.inverse(this,new p)},transpose:function(){return p.transpose(this,new p)},multiply:function(t){return p.multiply(this,t,new p)},transformPoint:function(t){var r=this.m;return new l(r[0]*t.x+r[1]*t.y+r[2]*t.z+r[3],r[4]*t.x+r[5]*t.y+r[6]*t.z+r[7],r[8]*t.x+r[9]*t.y+r[10]*t.z+r[11]).divide(r[12]*t.x+r[13]*t.y+r[14]*t.z+r[15])},transformVector:function(t){var r=this.m;return new l(r[0]*t.x+r[1]*t.y+r[2]*t.z,r[4]*t.x+r[5]*t.y+r[6]*t.z,r[8]*t.x+r[9]*t.y+r[10]*t.z)}},p.inverse=function(t,r){r=r||new p;var e=t.m,n=r.m;n[0]=e[5]*e[10]*e[15]-e[5]*e[14]*e[11]-e[6]*e[9]*e[15]+e[6]*e[13]*e[11]+e[7]*e[9]*e[14]-e[7]*e[13]*e[10],n[1]=-e[1]*e[10]*e[15]+e[1]*e[14]*e[11]+e[2]*e[9]*e[15]-e[2]*e[13]*e[11]-e[3]*e[9]*e[14]+e[3]*e[13]*e[10],n[2]=e[1]*e[6]*e[15]-e[1]*e[14]*e[7]-e[2]*e[5]*e[15]+e[2]*e[13]*e[7]+e[3]*e[5]*e[14]-e[3]*e[13]*e[6],n[3]=-e[1]*e[6]*e[11]+e[1]*e[10]*e[7]+e[2]*e[5]*e[11]-e[2]*e[9]*e[7]-e[3]*e[5]*e[10]+e[3]*e[9]*e[6],n[4]=-e[4]*e[10]*e[15]+e[4]*e[14]*e[11]+e[6]*e[8]*e[15]-e[6]*e[12]*e[11]-e[7]*e[8]*e[14]+e[7]*e[12]*e[10],n[5]=e[0]*e[10]*e[15]-e[0]*e[14]*e[11]-e[2]*e[8]*e[15]+e[2]*e[12]*e[11]+e[3]*e[8]*e[14]-e[3]*e[12]*e[10],n[6]=-e[0]*e[6]*e[15]+e[0]*e[14]*e[7]+e[2]*e[4]*e[15]-e[2]*e[12]*e[7]-e[3]*e[4]*e[14]+e[3]*e[12]*e[6],n[7]=e[0]*e[6]*e[11]-e[0]*e[10]*e[7]-e[2]*e[4]*e[11]+e[2]*e[8]*e[7]+e[3]*e[4]*e[10]-e[3]*e[8]*e[6],n[8]=e[4]*e[9]*e[15]-e[4]*e[13]*e[11]-e[5]*e[8]*e[15]+e[5]*e[12]*e[11]+e[7]*e[8]*e[13]-e[7]*e[12]*e[9],n[9]=-e[0]*e[9]*e[15]+e[0]*e[13]*e[11]+e[1]*e[8]*e[15]-e[1]*e[12]*e[11]-e[3]*e[8]*e[13]+e[3]*e[12]*e[9],n[10]=e[0]*e[5]*e[15]-e[0]*e[13]*e[7]-e[1]*e[4]*e[15]+e[1]*e[12]*e[7]+e[3]*e[4]*e[13]-e[3]*e[12]*e[5],n[11]=-e[0]*e[5]*e[11]+e[0]*e[9]*e[7]+e[1]*e[4]*e[11]-e[1]*e[8]*e[7]-e[3]*e[4]*e[9]+e[3]*e[8]*e[5],n[12]=-e[4]*e[9]*e[14]+e[4]*e[13]*e[10]+e[5]*e[8]*e[14]-e[5]*e[12]*e[10]-e[6]*e[8]*e[13]+e[6]*e[12]*e[9],n[13]=e[0]*e[9]*e[14]-e[0]*e[13]*e[10]-e[1]*e[8]*e[14]+e[1]*e[12]*e[10]+e[2]*e[8]*e[13]-e[2]*e[12]*e[9],n[14]=-e[0]*e[5]*e[14]+e[0]*e[13]*e[6]+e[1]*e[4]*e[14]-e[1]*e[12]*e[6]-e[2]*e[4]*e[13]+e[2]*e[12]*e[5],n[15]=e[0]*e[5]*e[10]-e[0]*e[9]*e[6]-e[1]*e[4]*e[10]+e[1]*e[8]*e[6]+e[2]*e[4]*e[9]-e[2]*e[8]*e[5];for(var a=e[0]*n[0]+e[1]*n[4]+e[2]*n[8]+e[3]*n[12],o=0;o<16;o++)n[o]/=a;return r},p.transpose=function(t,r){r=r||new p;var e=t.m,n=r.m;return n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15],r},p.multiply=function(t,r,e){e=e||new p;var n=t.m,a=r.m,o=e.m;return o[0]=n[0]*a[0]+n[1]*a[4]+n[2]*a[8]+n[3]*a[12],o[1]=n[0]*a[1]+n[1]*a[5]+n[2]*a[9]+n[3]*a[13],o[2]=n[0]*a[2]+n[1]*a[6]+n[2]*a[10]+n[3]*a[14],o[3]=n[0]*a[3]+n[1]*a[7]+n[2]*a[11]+n[3]*a[15],o[4]=n[4]*a[0]+n[5]*a[4]+n[6]*a[8]+n[7]*a[12],o[5]=n[4]*a[1]+n[5]*a[5]+n[6]*a[9]+n[7]*a[13],o[6]=n[4]*a[2]+n[5]*a[6]+n[6]*a[10]+n[7]*a[14],o[7]=n[4]*a[3]+n[5]*a[7]+n[6]*a[11]+n[7]*a[15],o[8]=n[8]*a[0]+n[9]*a[4]+n[10]*a[8]+n[11]*a[12],o[9]=n[8]*a[1]+n[9]*a[5]+n[10]*a[9]+n[11]*a[13],o[10]=n[8]*a[2]+n[9]*a[6]+n[10]*a[10]+n[11]*a[14],o[11]=n[8]*a[3]+n[9]*a[7]+n[10]*a[11]+n[11]*a[15],o[12]=n[12]*a[0]+n[13]*a[4]+n[14]*a[8]+n[15]*a[12],o[13]=n[12]*a[1]+n[13]*a[5]+n[14]*a[9]+n[15]*a[13],o[14]=n[12]*a[2]+n[13]*a[6]+n[14]*a[10]+n[15]*a[14],o[15]=n[12]*a[3]+n[13]*a[7]+n[14]*a[11]+n[15]*a[15],e},p.identity=function(t){t=t||new p;var r=t.m;return r[0]=r[5]=r[10]=r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,t},p.perspective=function(t,r,e,n,a){var o=Math.tan(t*Math.PI/360)*e,h=o*r;return p.frustum(-h,h,-o,o,e,n,a)},p.frustum=function(t,r,e,n,a,o,h){h=h||new p;var s=h.m;return s[0]=2*a/(r-t),s[1]=0,s[2]=(r+t)/(r-t),s[3]=0,s[4]=0,s[5]=2*a/(n-e),s[6]=(n+e)/(n-e),s[7]=0,s[8]=0,s[9]=0,s[10]=-(o+a)/(o-a),s[11]=-2*o*a/(o-a),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,h},p.ortho=function(t,r,e,n,a,o,h){h=h||new p;var s=h.m;return s[0]=2/(r-t),s[1]=0,s[2]=0,s[3]=-(r+t)/(r-t),s[4]=0,s[5]=2/(n-e),s[6]=0,s[7]=-(n+e)/(n-e),s[8]=0,s[9]=0,s[10]=-2/(o-a),s[11]=-(o+a)/(o-a),s[12]=0,s[13]=0,s[14]=0,s[15]=1,h},p.scale=function(t,r,e,n){n=n||new p;var a=n.m;return a[0]=t,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n},p.translate=function(t,r,e,n){n=n||new p;var a=n.m;return a[0]=1,a[1]=0,a[2]=0,a[3]=t,a[4]=0,a[5]=1,a[6]=0,a[7]=r,a[8]=0,a[9]=0,a[10]=1,a[11]=e,a[12]=0,a[13]=0,a[14]=0,a[15]=1,n},p.rotate=function(t,r,e,n,a){if(!t||!r&&!e&&!n)return p.identity(a);a=a||new p;var o=a.m,h=Math.sqrt(r*r+e*e+n*n);t*=Math.PI/180,r/=h,e/=h,n/=h;var s=Math.cos(t),m=Math.sin(t),f=1-s;return o[0]=r*r*f+s,o[1]=r*e*f-n*m,o[2]=r*n*f+e*m,o[3]=0,o[4]=e*r*f+n*m,o[5]=e*e*f+s,o[6]=e*n*f-r*m,o[7]=0,o[8]=n*r*f-e*m,o[9]=n*e*f+r*m,o[10]=n*n*f+s,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,a},p.lookAt=function(t,r,e,n,a,o,h,s,m,f){f=f||new p;var u=f.m,d=new l(t,r,e),x=new l(n,a,o),g=new l(h,s,m),y=d.subtract(x).unit(),A=g.cross(y).unit(),R=y.cross(A).unit();return u[0]=A.x,u[1]=A.y,u[2]=A.z,u[3]=-A.dot(d),u[4]=R.x,u[5]=R.y,u[6]=R.z,u[7]=-R.dot(d),u[8]=y.x,u[9]=y.y,u[10]=y.z,u[11]=-y.dot(d),u[12]=0,u[13]=0,u[14]=0,u[15]=1,f};function H(){this.unique=[],this.indices=[],this.map={}}H.prototype={add:function(t){var r=JSON.stringify(t);return r in this.map||(this.map[r]=this.unique.length,this.unique.push(t)),this.map[r]}};function k(t,r){this.buffer=null,this.target=t,this.type=r,this.data=[]}k.prototype={compile:function(t){for(var r=[],e=0,n=1e4;e<this.data.length;e+=n)r=Array.prototype.concat.apply(r,this.data.slice(e,e+n));var a=this.data.length?r.length/this.data.length:0;if(a!=Math.round(a))throw new Error("buffer elements not of consistent size, average size is "+a);this.buffer=this.buffer||i.createBuffer(),this.buffer.length=r.length,this.buffer.spacing=a,i.bindBuffer(this.target,this.buffer),i.bufferData(this.target,new this.type(r),t||i.STATIC_DRAW)}};function P(t){t=t||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),t.coords&&this.addVertexBuffer("coords","gl_TexCoord"),t.normals&&this.addVertexBuffer("normals","gl_Normal"),t.colors&&this.addVertexBuffer("colors","gl_Color"),(!("triangles"in t)||t.triangles)&&this.addIndexBuffer("triangles"),t.lines&&this.addIndexBuffer("lines")}P.prototype={addVertexBuffer:function(t,r){var e=this.vertexBuffers[r]=new k(i.ARRAY_BUFFER,Float32Array);e.name=t,this[t]=[]},addIndexBuffer:function(t){this.indexBuffers[t]=new k(i.ELEMENT_ARRAY_BUFFER,Uint16Array),this[t]=[]},compile:function(){for(var t in this.vertexBuffers){var r=this.vertexBuffers[t];r.data=this[r.name],r.compile()}for(var e in this.indexBuffers){var r=this.indexBuffers[e];r.data=this[e],r.compile()}},transform:function(t){if(this.vertices=this.vertices.map(function(e){return t.transformPoint(l.fromArray(e)).toArray()}),this.normals){var r=t.inverse().transpose();this.normals=this.normals.map(function(e){return r.transformVector(l.fromArray(e)).unit().toArray()})}return this.compile(),this},computeNormals:function(){this.normals||this.addVertexBuffer("normals","gl_Normal");for(var t=0;t<this.vertices.length;t++)this.normals[t]=new l;for(var t=0;t<this.triangles.length;t++){var r=this.triangles[t],e=l.fromArray(this.vertices[r[0]]),n=l.fromArray(this.vertices[r[1]]),a=l.fromArray(this.vertices[r[2]]),o=n.subtract(e).cross(a.subtract(e)).unit();this.normals[r[0]]=this.normals[r[0]].add(o),this.normals[r[1]]=this.normals[r[1]].add(o),this.normals[r[2]]=this.normals[r[2]].add(o)}for(var t=0;t<this.vertices.length;t++)this.normals[t]=this.normals[t].unit().toArray();return this.compile(),this},computeWireframe:function(){for(var t=new H,r=0;r<this.triangles.length;r++)for(var e=this.triangles[r],n=0;n<e.length;n++){var a=e[n],o=e[(n+1)%e.length];t.add([Math.min(a,o),Math.max(a,o)])}return this.lines||this.addIndexBuffer("lines"),this.lines=t.unique,this.compile(),this},getAABB:function(){var t={min:new l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};t.max=t.min.negative();for(var r=0;r<this.vertices.length;r++){var e=l.fromArray(this.vertices[r]);t.min=l.min(t.min,e),t.max=l.max(t.max,e)}return t},getBoundingSphere:function(){for(var t=this.getAABB(),r={center:t.min.add(t.max).divide(2),radius:0},e=0;e<this.vertices.length;e++)r.radius=Math.max(r.radius,l.fromArray(this.vertices[e]).subtract(r.center).length());return r}},P.plane=function(t){t=t||{};for(var r=new P(t),e=t.detailX||t.detail||1,n=t.detailY||t.detail||1,a=0;a<=n;a++)for(var o=a/n,h=0;h<=e;h++){var s=h/e;if(r.vertices.push([2*s-1,2*o-1,0]),r.coords&&r.coords.push([s,o]),r.normals&&r.normals.push([0,0,1]),h<e&&a<n){var m=h+a*(e+1);r.triangles.push([m,m+1,m+e+1]),r.triangles.push([m+e+1,m+1,m+e+2])}}return r.compile(),r};var $=[[0,4,2,6,-1,0,0],[1,3,5,7,1,0,0],[0,1,4,5,0,-1,0],[2,6,3,7,0,1,0],[0,2,1,3,0,0,-1],[4,5,6,7,0,0,1]];function K(t){return new l((t&1)*2-1,(t&2)-1,(t&4)/2-1)}P.cube=function(t){for(var r=new P(t),e=0;e<$.length;e++){for(var n=$[e],a=e*4,o=0;o<4;o++){var h=n[o];r.vertices.push(K(h).toArray()),r.coords&&r.coords.push([o&1,(o&2)/2]),r.normals&&r.normals.push(n.slice(4,7))}r.triangles.push([a,a+1,a+2]),r.triangles.push([a+2,a+1,a+3])}return r.compile(),r},P.sphere=function(t){function r(R,Q,ie){return m?[R,ie,Q]:[R,Q,ie]}function e(R){return R+(R-R*R)/2}t=t||{};for(var n=new P(t),a=new H,o=t.detail||6,h=0;h<8;h++)for(var s=K(h),m=s.x*s.y*s.z>0,f=[],u=0;u<=o;u++){for(var d=0;u+d<=o;d++){var x=u/o,g=d/o,y=(o-u-d)/o,A={vertex:new l(e(x),e(g),e(y)).unit().multiply(s).toArray()};n.coords&&(A.coord=s.y>0?[1-x,y]:[y,1-x]),f.push(a.add(A))}if(u>0)for(var d=0;u+d<=o;d++){var x=(u-1)*(o+1)+(u-1-(u-1)*(u-1))/2+d,g=u*(o+1)+(u-u*u)/2+d;n.triangles.push(r(f[x],f[x+1],f[g])),u+d<o&&n.triangles.push(r(f[g],f[x+1],f[g+1]))}}return n.vertices=a.unique.map(function(R){return R.vertex}),n.coords&&(n.coords=a.unique.map(function(R){return R.coord})),n.normals&&(n.normals=n.vertices),n.compile(),n},P.load=function(t,r){r=r||{},"coords"in r||(r.coords=!!t.coords),"normals"in r||(r.normals=!!t.normals),"colors"in r||(r.colors=!!t.colors),"triangles"in r||(r.triangles=!!t.triangles),"lines"in r||(r.lines=!!t.lines);var e=new P(r);return e.vertices=t.vertices,e.coords&&(e.coords=t.coords),e.normals&&(e.normals=t.normals),e.colors&&(e.colors=t.colors),e.triangles&&(e.triangles=t.triangles),e.lines&&(e.lines=t.lines),e.compile(),e};function j(t,r,e){this.t=arguments.length?t:Number.MAX_VALUE,this.hit=r,this.normal=e}j.prototype={mergeWith:function(t){t.t>0&&t.t<this.t&&(this.t=t.t,this.hit=t.hit,this.normal=t.normal)}};function Y(){var t=i.getParameter(i.VIEWPORT),r=i.modelviewMatrix.m,e=new l(r[0],r[4],r[8]),n=new l(r[1],r[5],r[9]),a=new l(r[2],r[6],r[10]),o=new l(r[3],r[7],r[11]);this.eye=new l(-o.dot(e),-o.dot(n),-o.dot(a));var h=t[0],s=h+t[2],m=t[1],f=m+t[3];this.ray00=i.unProject(h,m,1).subtract(this.eye),this.ray10=i.unProject(s,m,1).subtract(this.eye),this.ray01=i.unProject(h,f,1).subtract(this.eye),this.ray11=i.unProject(s,f,1).subtract(this.eye),this.viewport=t}Y.prototype={getRayForPixel:function(t,r){t=(t-this.viewport[0])/this.viewport[2],r=1-(r-this.viewport[1])/this.viewport[3];var e=l.lerp(this.ray00,this.ray10,t),n=l.lerp(this.ray01,this.ray11,t);return l.lerp(e,n,r).unit()}},Y.hitTestBox=function(t,r,e,n){var a=e.subtract(t).divide(r),o=n.subtract(t).divide(r),h=l.min(a,o),s=l.max(a,o),m=h.max(),f=s.min();if(m>0&&m<f){var u=1e-6,d=t.add(r.multiply(m));return e=e.add(u),n=n.subtract(u),new j(m,d,new l((d.x>n.x)-(d.x<e.x),(d.y>n.y)-(d.y<e.y),(d.z>n.z)-(d.z<e.z)))}return null},Y.hitTestSphere=function(t,r,e,n){var a=t.subtract(e),o=r.dot(r),h=2*r.dot(a),s=a.dot(a)-n*n,m=h*h-4*o*s;if(m>0){var f=(-h-Math.sqrt(m))/(2*o),u=t.add(r.multiply(f));return new j(f,u,u.subtract(e).divide(n))}return null},Y.hitTestTriangle=function(t,r,e,n,a){var o=n.subtract(e),h=a.subtract(e),s=o.cross(h).unit(),m=s.dot(e.subtract(t))/s.dot(r);if(m>0){var f=t.add(r.multiply(m)),u=f.subtract(e),d=h.dot(h),x=h.dot(o),g=h.dot(u),y=o.dot(o),A=o.dot(u),R=d*y-x*x,Q=(y*g-x*A)/R,ie=(d*A-x*g)/R;if(Q>=0&&ie>=0&&Q+ie<=1)return new j(m,f,s)}return null};function re(t,r,e){let n;for(;(n=t.exec(r))!=null;)e(n)}var q="LIGHTGL";function v(t,r){function e(d){var x=document.getElementById(d);return x?x.text:d}t=e(t),r=e(r);var n="    uniform mat3 gl_NormalMatrix;    uniform mat4 gl_ModelViewMatrix;    uniform mat4 gl_ProjectionMatrix;    uniform mat4 gl_ModelViewProjectionMatrix;    uniform mat4 gl_ModelViewMatrixInverse;    uniform mat4 gl_ProjectionMatrixInverse;    uniform mat4 gl_ModelViewProjectionMatrixInverse;  ",a=n+"    attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;    attribute vec3 gl_Normal;    attribute vec4 gl_Color;    vec4 ftransform() {      return gl_ModelViewProjectionMatrix * gl_Vertex;    }  ",o="    precision highp float;  "+n,h=t+r,s={};re(/\b(gl_[^;]*)\b;/g,n,function(d){var x=d[1];if(h.indexOf(x)!=-1){var g=x.replace(/[a-z_]/g,"");s[g]=q+x}}),h.indexOf("ftransform")!=-1&&(s.MVPM=q+"gl_ModelViewProjectionMatrix"),this.usedMatrices=s;function m(d,x){var g={},y=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(x);return x=y?y[1]+d+x.substr(y[1].length):d+x,re(/\bgl_\w+\b/g,d,function(A){A in g||(x=x.replace(new RegExp("\\b"+A+"\\b","g"),q+A),g[A]=!0)}),x}t=m(a,t),r=m(o,r);function f(d,x){var g=i.createShader(d);if(i.shaderSource(g,x),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS))throw new Error("compile error: "+i.getShaderInfoLog(g));return g}if(this.program=i.createProgram(),i.attachShader(this.program,f(i.VERTEX_SHADER,t)),i.attachShader(this.program,f(i.FRAGMENT_SHADER,r)),i.linkProgram(this.program),!i.getProgramParameter(this.program,i.LINK_STATUS))throw new Error("link error: "+i.getProgramInfoLog(this.program));this.attributes={},this.uniformLocations={};var u={};re(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,t+r,function(d){u[d[2]]=1}),this.isSampler=u}function I(t){var r=Object.prototype.toString.call(t);return r=="[object Array]"||r=="[object Float32Array]"}function S(t){var r=Object.prototype.toString.call(t);return r=="[object Number]"||r=="[object Boolean]"}new p,new p,v.prototype={uniforms:function(t){i.useProgram(this.program);for(var r in t){var e=this.uniformLocations[r]||i.getUniformLocation(this.program,r);if(e){this.uniformLocations[r]=e;var n=t[r];if(n instanceof l?n=[n.x,n.y,n.z]:n instanceof p&&(n=n.m),I(n))switch(n.length){case 1:i.uniform1fv(e,new Float32Array(n));break;case 2:i.uniform2fv(e,new Float32Array(n));break;case 3:i.uniform3fv(e,new Float32Array(n));break;case 4:i.uniform4fv(e,new Float32Array(n));break;case 9:i.uniformMatrix3fv(e,!1,new Float32Array([n[0],n[3],n[6],n[1],n[4],n[7],n[2],n[5],n[8]]));break;case 16:i.uniformMatrix4fv(e,!1,new Float32Array([n[0],n[4],n[8],n[12],n[1],n[5],n[9],n[13],n[2],n[6],n[10],n[14],n[3],n[7],n[11],n[15]]));break;default:throw new Error(`don't know how to load uniform "`+r+'" of length '+n.length)}else if(S(n))(this.isSampler[r]?i.uniform1i:i.uniform1f).call(i,e,n);else throw new Error('attempted to set uniform "'+r+'" to invalid value '+n)}}return this},draw:function(t,r){this.drawBuffers(t.vertexBuffers,t.indexBuffers[r==i.LINES?"lines":"triangles"],arguments.length<2?i.TRIANGLES:r)},drawBuffers:function(t,r,e){var n=this.usedMatrices,a=i.modelviewMatrix,o=i.projectionMatrix,h=n.MVMI||n.NM?a.inverse():null,s=n.PMI?o.inverse():null,m=n.MVPM||n.MVPMI?o.multiply(a):null,f={};if(n.MVM&&(f[n.MVM]=a),n.MVMI&&(f[n.MVMI]=h),n.PM&&(f[n.PM]=o),n.PMI&&(f[n.PMI]=s),n.MVPM&&(f[n.MVPM]=m),n.MVPMI&&(f[n.MVPMI]=m.inverse()),n.NM){var u=h.m;f[n.NM]=[u[0],u[4],u[8],u[1],u[5],u[9],u[2],u[6],u[10]]}this.uniforms(f);var d=0;for(var x in t){var g=t[x],y=this.attributes[x]||i.getAttribLocation(this.program,x.replace(/^(gl_.*)$/,q+"$1"));y==-1||!g.buffer||(this.attributes[x]=y,i.bindBuffer(i.ARRAY_BUFFER,g.buffer),i.enableVertexAttribArray(y),i.vertexAttribPointer(y,g.buffer.spacing,i.FLOAT,!1,0,0),d=g.buffer.length/g.buffer.spacing)}for(var x in this.attributes)x in t||i.disableVertexAttribArray(this.attributes[x]);return d&&(!r||r.buffer)&&(r?(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,r.buffer),i.drawElements(e,r.buffer.length,i.UNSIGNED_SHORT,0)):i.drawArrays(e,0,d)),this}};function _(t,r,e){e=e||{},this.id=i.createTexture(),this.width=t,this.height=r,this.format=e.format||i.RGBA,this.type=e.type||i.UNSIGNED_BYTE;var n=e.filter||e.magFilter||i.LINEAR,a=e.filter||e.minFilter||i.LINEAR;if(this.type===i.FLOAT){if(!_.canUseFloatingPointTextures())throw new Error("OES_texture_float is required but not supported");if((a!==i.NEAREST||n!==i.NEAREST)&&!_.canUseFloatingPointLinearFiltering())throw new Error("OES_texture_float_linear is required but not supported")}else if(this.type===i.HALF_FLOAT_OES){if(!_.canUseHalfFloatingPointTextures())throw new Error("OES_texture_half_float is required but not supported");if((a!==i.NEAREST||n!==i.NEAREST)&&!_.canUseHalfFloatingPointLinearFiltering())throw new Error("OES_texture_half_float_linear is required but not supported")}i.bindTexture(i.TEXTURE_2D,this.id),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,1),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e.wrap||e.wrapS||i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e.wrap||e.wrapT||i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,this.format,t,r,0,this.format,this.type,null)}var V,B,te;_.prototype={bind:function(t){i.activeTexture(i.TEXTURE0+(t||0)),i.bindTexture(i.TEXTURE_2D,this.id)},unbind:function(t){i.activeTexture(i.TEXTURE0+(t||0)),i.bindTexture(i.TEXTURE_2D,null)},canDrawTo:function(){V=V||i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,V),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.id,0);var t=i.checkFramebufferStatus(i.FRAMEBUFFER)==i.FRAMEBUFFER_COMPLETE;return i.bindFramebuffer(i.FRAMEBUFFER,null),t},drawTo:function(t){var r=i.getParameter(i.VIEWPORT);if(V=V||i.createFramebuffer(),B=B||i.createRenderbuffer(),i.bindFramebuffer(i.FRAMEBUFFER,V),i.bindRenderbuffer(i.RENDERBUFFER,B),(this.width!=B.width||this.height!=B.height)&&(B.width=this.width,B.height=this.height,i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,this.width,this.height)),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.id,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,B),i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE)throw new Error("Rendering to this texture is not supported (incomplete framebuffer)");i.viewport(0,0,this.width,this.height),t(),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.viewport(r[0],r[1],r[2],r[3])},swapWith:function(t){var r;r=t.id,t.id=this.id,this.id=r,r=t.width,t.width=this.width,this.width=r,r=t.height,t.height=this.height,this.height=r}},_.fromImage=function(t,r){r=r||{};var e=new _(t.width,t.height,r);try{i.texImage2D(i.TEXTURE_2D,0,e.format,e.format,e.type,t)}catch{throw location.protocol=="file:"?new Error('image not loaded for security reasons (serve this page over "http://" instead)'):new Error("image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)")}return r.minFilter&&r.minFilter!=i.NEAREST&&r.minFilter!=i.LINEAR&&i.generateMipmap(i.TEXTURE_2D),e},_.fromURL=function(t,r){te=te||function(){var o=document.createElement("canvas").getContext("2d");o.canvas.width=o.canvas.height=128;for(var h=0;h<o.canvas.height;h+=16)for(var s=0;s<o.canvas.width;s+=16)o.fillStyle=(s^h)&16?"#FFF":"#DDD",o.fillRect(s,h,16,16);return o.canvas}();var e=_.fromImage(te,r),n=new Image,a=i;return n.onload=function(){a.makeCurrent(),_.fromImage(n,r).swapWith(e)},n.src=t,e},_.canUseFloatingPointTextures=function(){return!!i.getExtension("OES_texture_float")},_.canUseFloatingPointLinearFiltering=function(){return!!i.getExtension("OES_texture_float_linear")},_.canUseHalfFloatingPointTextures=function(){return!!i.getExtension("OES_texture_half_float")},_.canUseHalfFloatingPointLinearFiltering=function(){return!!i.getExtension("OES_texture_half_float_linear")};function l(t,r,e){this.x=t||0,this.y=r||0,this.z=e||0}return l.prototype={negative:function(){return new l(-this.x,-this.y,-this.z)},add:function(t){return t instanceof l?new l(this.x+t.x,this.y+t.y,this.z+t.z):new l(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof l?new l(this.x-t.x,this.y-t.y,this.z-t.z):new l(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof l?new l(this.x*t.x,this.y*t.y,this.z*t.z):new l(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof l?new l(this.x/t.x,this.y/t.y,this.z/t.z):new l(this.x/t,this.y/t,this.z/t)},equals:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new l(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(t){return Math.acos(this.dot(t)/(this.length()*t.length()))},toArray:function(t){return[this.x,this.y,this.z].slice(0,t||3)},clone:function(){return new l(this.x,this.y,this.z)},init:function(t,r,e){return this.x=t,this.y=r,this.z=e,this}},l.negative=function(t,r){return r.x=-t.x,r.y=-t.y,r.z=-t.z,r},l.add=function(t,r,e){return r instanceof l?(e.x=t.x+r.x,e.y=t.y+r.y,e.z=t.z+r.z):(e.x=t.x+r,e.y=t.y+r,e.z=t.z+r),e},l.subtract=function(t,r,e){return r instanceof l?(e.x=t.x-r.x,e.y=t.y-r.y,e.z=t.z-r.z):(e.x=t.x-r,e.y=t.y-r,e.z=t.z-r),e},l.multiply=function(t,r,e){return r instanceof l?(e.x=t.x*r.x,e.y=t.y*r.y,e.z=t.z*r.z):(e.x=t.x*r,e.y=t.y*r,e.z=t.z*r),e},l.divide=function(t,r,e){return r instanceof l?(e.x=t.x/r.x,e.y=t.y/r.y,e.z=t.z/r.z):(e.x=t.x/r,e.y=t.y/r,e.z=t.z/r),e},l.cross=function(t,r,e){return e.x=t.y*r.z-t.z*r.y,e.y=t.z*r.x-t.x*r.z,e.z=t.x*r.y-t.y*r.x,e},l.unit=function(t,r){var e=t.length();return r.x=t.x/e,r.y=t.y/e,r.z=t.z/e,r},l.fromAngles=function(t,r){return new l(Math.cos(t)*Math.cos(r),Math.sin(r),Math.sin(t)*Math.cos(r))},l.randomDirection=function(){return l.fromAngles(Math.random()*Math.PI*2,Math.asin(Math.random()*2-1))},l.min=function(t,r){return new l(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.min(t.z,r.z))},l.max=function(t,r){return new l(Math.max(t.x,r.x),Math.max(t.y,r.y),Math.max(t.z,r.z))},l.lerp=function(t,r,e){return r.subtract(t).multiply(e).add(t)},l.fromArray=function(t){return new l(t[0],t[1],t[2])},l.angleBetween=function(t,r){return t.angleTo(r)},c}();function Z(i){this.gl=i;var c="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }  ";if(this.plane=w.Mesh.plane(),!w.Texture.canUseFloatingPointTextures())throw new Error("This demo requires the OES_texture_float extension");var T=w.Texture.canUseFloatingPointLinearFiltering()?i.LINEAR:i.NEAREST;this.textureA=new w.Texture(256,256,{type:i.FLOAT,filter:T}),this.textureB=new w.Texture(256,256,{type:i.FLOAT,filter:T}),this.areaConservationTexture=new w.Texture(256,256,{type:i.FLOAT,filter:T}),this.areaConservationEnabled=!0,this.W=256,this.H=256,(!this.textureA.canDrawTo()||!this.textureB.canDrawTo())&&w.Texture.canUseHalfFloatingPointTextures()&&(T=w.Texture.canUseHalfFloatingPointLinearFiltering()?i.LINEAR:i.NEAREST,this.textureA=new w.Texture(256,256,{type:i.HALF_FLOAT_OES,filter:T}),this.textureB=new w.Texture(256,256,{type:i.HALF_FLOAT_OES,filter:T})),this.dropShader=new w.Shader(c,"    const float PI = 3.141592653589793;    uniform sampler2D texture;    uniform vec2 center;    uniform float radius;    uniform float strength;    varying vec2 coord;    void main() {      /* get vertex info */      vec4 info = texture2D(texture, coord);            /* add the drop to the height */      float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);      drop = 0.5 - cos(drop * PI) * 0.5;      info.r += drop * strength;            gl_FragColor = info;    }  "),this.updateShader=new w.Shader(c,"    uniform sampler2D texture;    uniform vec2 delta;    varying vec2 coord;    void main() {      /* get vertex info */      vec4 info = texture2D(texture, coord);            /* calculate average neighbor height */      vec2 dx = vec2(delta.x, 0.0);      vec2 dy = vec2(0.0, delta.y);      float average = (        texture2D(texture, coord - dx).r +        texture2D(texture, coord - dy).r +        texture2D(texture, coord + dx).r +        texture2D(texture, coord + dy).r      ) * 0.25;            /* change the velocity to move toward the average */      info.g += (average - info.r) * 2.0;            /* attenuate the velocity a little so waves do not last forever */      info.g *= 0.995;            /* move the vertex along the velocity */      info.r += info.g;            gl_FragColor = info;    }  "),this.AreaConservationInitShader=new w.Shader(c,"    varying vec2 coord;    void main() {      gl_FragColor = vec4(coord, 0.0, 0.0);    }  "),this.normalShader=new w.Shader(c,"    uniform sampler2D texture;    uniform vec2 delta;    varying vec2 coord;    void main() {      /* get vertex info */      vec4 info = texture2D(texture, coord);            /* update the normal */      vec3 dx = vec3(delta.x, texture2D(texture, vec2(coord.x + delta.x, coord.y)).r - info.r, 0.0);      vec3 dy = vec3(0.0, texture2D(texture, vec2(coord.x, coord.y + delta.y)).r - info.r, delta.y);      info.ba = normalize(cross(dy, dx)).xz;            gl_FragColor = info;    }  "),this.sphereShader=new w.Shader(c,"    uniform sampler2D texture;    uniform vec3 oldCenter;    uniform vec3 newCenter;    uniform float radius;    varying vec2 coord;        float volumeInSphere(vec3 center) {      vec3 toCenter = vec3(coord.x * 2.0 - 1.0, 0.0, coord.y * 2.0 - 1.0) - center;      float t = length(toCenter) / radius;      float dy = exp(-pow(t * 1.5, 6.0));      float ymin = min(0.0, center.y - dy);      float ymax = min(max(0.0, center.y + dy), ymin + 2.0 * dy);      return (ymax - ymin) * 0.1;    }        void main() {      /* get vertex info */      vec4 info = texture2D(texture, coord);            /* add the old volume */      info.r += volumeInSphere(oldCenter);            /* subtract the new volume */      info.r -= volumeInSphere(newCenter);            gl_FragColor = info;    }  ")}Z.prototype.addDrop=function(i,c,T,C){var O=this;this.textureB.drawTo(function(){O.textureA.bind(),O.dropShader.uniforms({center:[i,c],radius:T,strength:C}).draw(O.plane)}),this.textureB.swapWith(this.textureA)};Z.prototype.moveSphere=function(i,c,T){var C=this;this.textureB.drawTo(function(){C.textureA.bind(),C.sphereShader.uniforms({oldCenter:i,newCenter:c,radius:T}).draw(C.plane)}),this.textureB.swapWith(this.textureA)};Z.prototype.initAreaConservation=function(){var i=this;this.areaConservationTexture.drawTo(function(){i.AreaConservationInitShader.draw(i.plane)})};Z.prototype.stepSimulation=function(){var i=this;this.textureB.drawTo(function(){i.textureA.bind(),i.updateShader.uniforms({delta:[1/i.textureA.width,1/i.textureA.height]}).draw(i.plane)}),this.textureB.swapWith(this.textureA),this.updateAreaConservation()};Z.prototype.updateNormals=function(){var i=this;this.textureB.drawTo(function(){i.textureA.bind(),i.normalShader.uniforms({delta:[1/i.textureA.width,1/i.textureA.height]}).draw(i.plane)}),this.textureB.swapWith(this.textureA)};Z.prototype.setAreaConservation=function(i){this.areaConservationEnabled=i};Z.prototype.updateAreaConservation=function(){var i,c,T;if(this.textureA.type===this.gl.FLOAT)i=this.gl.FLOAT,c=Float32Array,T="WEBGL_color_buffer_float";else if(this.textureA.type===this.gl.HALF_FLOAT_OES)i=this.gl.HALF_FLOAT_OES,c=Uint16Array,T="EXT_color_buffer_half_float";else{console.warn("Unsupported texture type for reading");return}if(!this.gl.getExtension(T)){console.warn(T+" not available; cannot read pixels");return}this.fb||(this.fb=this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fb),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.textureA.id,0);const C=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(C!==this.gl.FRAMEBUFFER_COMPLETE){console.error("Framebuffer incomplete: "+C+" for texture type "+this.textureA.type),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null);return}this.gl.pixelStorei(this.gl.PACK_ALIGNMENT,1);const O=new c(this.W*this.H*4),X=new Float32Array(this.W*this.H*4);if(this.gl.readPixels(0,0,this.W,this.H,this.gl.RGBA,i,O),this.textureA.type===this.gl.FLOAT){for(let M=0;M<this.H;M+=1)for(let D=0;D<this.W;D+=1){const N=(D*this.H+M)*4,L=O[N+2],W=O[N+3],H=1/new w.Vector(L,Math.sqrt(1-L*L)).dot(new w.Vector(0,1))/this.W,P=1/new w.Vector(W,Math.sqrt(1-W*W)).dot(new w.Vector(0,1))/this.H,$=X[N],K=X[N+1];M+1<this.W&&(X[N+4]=$+H),D+1<this.H&&(X[N+4*this.W+1]=K+P)}this.gl.bindTexture(this.gl.TEXTURE_2D,this.areaConservationTexture.id),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,1),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.W,this.H,this.gl.RGBA,this.gl.FLOAT,X)}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)};var ee="  const float IOR_AIR = 1.0;  const float IOR_WATER = 1.333;  const vec3 abovewaterColor = vec3(0.25, 1.0, 1.25);  const vec3 underwaterColor = vec3(0.4, 0.9, 1.0);  const float poolHeight = 1.0;  uniform vec3 light;  uniform vec3 sphereCenter;  uniform float sphereRadius;  uniform sampler2D tiles;  uniform sampler2D causticTex;  uniform sampler2D water;  uniform sampler2D flag;  uniform sampler2D areaConservationTexture;  uniform bool areaConservation;  uniform vec2 flagCenter;  uniform float flagSize;    vec2 intersectCube(vec3 origin, vec3 ray, vec3 cubeMin, vec3 cubeMax) {    vec3 tMin = (cubeMin - origin) / ray;    vec3 tMax = (cubeMax - origin) / ray;    vec3 t1 = min(tMin, tMax);    vec3 t2 = max(tMin, tMax);    float tNear = max(max(t1.x, t1.y), t1.z);    float tFar = min(min(t2.x, t2.y), t2.z);    return vec2(tNear, tFar);  }    float intersectSphere(vec3 origin, vec3 ray, vec3 sphereCenter, float sphereRadius) {    vec3 toSphere = origin - sphereCenter;    float a = dot(ray, ray);    float b = 2.0 * dot(toSphere, ray);    float c = dot(toSphere, toSphere) - sphereRadius * sphereRadius;    float discriminant = b*b - 4.0*a*c;    if (discriminant > 0.0) {      float t = (-b - sqrt(discriminant)) / (2.0 * a);      if (t > 0.0) return t;    }    return 1.0e6;  }    vec3 getSphereColor(vec3 point) {    vec3 color = vec3(0.5);        /* ambient occlusion with walls */    color *= 1.0 - 0.9 / pow((1.0 + sphereRadius - abs(point.x)) / sphereRadius, 3.0);    color *= 1.0 - 0.9 / pow((1.0 + sphereRadius - abs(point.z)) / sphereRadius, 3.0);    color *= 1.0 - 0.9 / pow((point.y + 1.0 + sphereRadius) / sphereRadius, 3.0);        /* caustics */    vec3 sphereNormal = (point - sphereCenter) / sphereRadius;    vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);    float diffuse = max(0.0, dot(-refractedLight, sphereNormal)) * 0.5;    vec4 info = texture2D(water, point.xz * 0.5 + 0.5);    if (point.y < info.r) {      vec4 caustic = texture2D(causticTex, 0.75 * (point.xz - point.y * refractedLight.xz / refractedLight.y) * 0.5 + 0.5);      diffuse *= caustic.r * 4.0;    }    color += diffuse;        return color;  }    vec3 getWallColor(vec3 point) {    float scale = 0.5;        vec3 wallColor;    vec3 normal;    if (abs(point.x) > 0.999) {      wallColor = texture2D(tiles, point.yz * 0.5 + vec2(1.0, 0.5)).rgb;      normal = vec3(-point.x, 0.0, 0.0);    } else if (abs(point.z) > 0.999) {      wallColor = texture2D(tiles, point.yx * 0.5 + vec2(1.0, 0.5)).rgb;      normal = vec3(0.0, 0.0, -point.z);    } else {      wallColor = texture2D(tiles, point.xz * 0.5 + 0.5).rgb;      normal = vec3(0.0, 1.0, 0.0);    }        scale /= length(point); /* pool ambient occlusion */    scale *= 1.0 - 0.9 / pow(length(point - sphereCenter) / sphereRadius, 4.0); /* sphere ambient occlusion */        /* caustics */    vec3 refractedLight = -refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);    float diffuse = max(0.0, dot(refractedLight, normal));    vec4 info = texture2D(water, point.xz * 0.5 + 0.5);    if (point.y < info.r) {      vec4 caustic = texture2D(causticTex, 0.75 * (point.xz - point.y * refractedLight.xz / refractedLight.y) * 0.5 + 0.5);      scale += diffuse * caustic.r * 2.0 * caustic.g;    } else {      /* shadow for the rim of the pool */      vec2 t = intersectCube(point, refractedLight, vec3(-1.0, -poolHeight, -1.0), vec3(1.0, 2.0, 1.0));      diffuse *= 1.0 / (1.0 + exp(-200.0 / (1.0 + 10.0 * (t.y - t.x)) * (point.y + refractedLight.y * t.y - 2.0 / 12.0)));            scale += diffuse * 0.5;    }        return wallColor * scale;  }";function ae(i){this.gl=i,this.tileTexture=w.Texture.fromImage(document.getElementById("tiles"),{minFilter:this.gl.LINEAR_MIPMAP_LINEAR,wrap:this.gl.REPEAT,format:this.gl.RGB}),this.flagTexture=w.Texture.fromImage(document.getElementById("flag"),{minFilter:this.gl.LINEAR_MIPMAP_LINEAR,wrap:this.gl.REPEAT,format:this.gl.RGB}),this.flagSize=.5,this.flagCenter=new w.Vector(0,0),this.lightDir=new w.Vector(2,2,-1).unit(),this.causticTex=new w.Texture(1024,1024),this.waterMesh=w.Mesh.plane({detail:200}),this.waterShaders=[];for(var c=0;c<2;c++)this.waterShaders[c]=new w.Shader("      uniform sampler2D water;      varying vec3 position;      void main() {        vec4 info = texture2D(water, gl_Vertex.xy * 0.5 + 0.5);        position = gl_Vertex.xzy;        position.y += info.r;        gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);      }    ",ee+'      uniform vec3 eye;      varying vec3 position;      uniform samplerCube sky;            vec3 getSurfaceRayColor(vec3 origin, vec3 ray, vec3 waterColor) {        vec3 color;        float q = intersectSphere(origin, ray, sphereCenter, sphereRadius);        if (q < 1.0e6) {          color = getSphereColor(origin + ray * q);        } else if (ray.y < 0.0) {          vec2 t = intersectCube(origin, ray, vec3(-1.0, -poolHeight, -1.0), vec3(1.0, 2.0, 1.0));          color = getWallColor(origin + ray * t.y);        } else {          vec2 t = intersectCube(origin, ray, vec3(-1.0, -poolHeight, -1.0), vec3(1.0, 2.0, 1.0));          vec3 hit = origin + ray * t.y;          if (hit.y < 2.0 / 12.0) {            color = getWallColor(hit);          } else {            color = textureCube(sky, ray).rgb;            color += vec3(pow(max(0.0, dot(light, ray)), 5000.0)) * vec3(10.0, 8.0, 6.0);          }        }        if (ray.y < 0.0) {          color *= waterColor;          vec2 position = origin.xz;          if (areaConservation) {            vec2 coord = origin.xz * 0.5 + 0.5;            vec2 areaConservedCoord = texture2D(areaConservationTexture, coord).xy;            position = areaConservedCoord * 2.0 - 1.0;          }          float xFlag = position.x - flagCenter.x;          float yFlag = position.y - flagCenter.y;          vec2 posFlag = vec2(xFlag, yFlag);          if (abs(posFlag.x) <= flagSize / 2. && abs(posFlag.y) <= flagSize / 2.) {            vec2 flagCoord = posFlag / flagSize + vec2(.5, .5);            vec3 flagColor = texture2D(flag, flagCoord).xyz;            flagColor = flagCoord.x <= .33 ? vec3(0., 0., 1.) : flagCoord.x >= .66 ? vec3(1., 0., 0.) : vec3(1., 1., 1.);            color += flagColor;            color /= 2.;          }        }        return color;      }            void main() {        vec2 coord = position.xz * 0.5 + 0.5;        vec4 info = texture2D(water, coord);                /* make water look more "peaked" */        for (int i = 0; i < 5; i++) {          coord += info.ba * 0.005;          info = texture2D(water, coord);        }                vec3 normal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);        vec3 incomingRay = normalize(position - eye);                '+(c?"          normal = -normal;          vec3 reflectedRay = reflect(incomingRay, normal);          vec3 refractedRay = refract(incomingRay, normal, IOR_WATER / IOR_AIR);          float fresnel = mix(0.5, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));                    vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, underwaterColor);          vec3 refractedColor = getSurfaceRayColor(position, refractedRay, vec3(1.0)) * vec3(0.8, 1.0, 1.1);                    gl_FragColor = vec4(mix(reflectedColor, refractedColor, (1.0 - fresnel) * length(refractedRay)), 1.0);        ":"          vec3 reflectedRay = reflect(incomingRay, normal);          vec3 refractedRay = refract(incomingRay, normal, IOR_AIR / IOR_WATER);          float fresnel = mix(0.25, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));                    vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, abovewaterColor);          vec3 refractedColor = getSurfaceRayColor(position, refractedRay, abovewaterColor);                    gl_FragColor = vec4(mix(refractedColor, reflectedColor, fresnel), 1.0);        ")+"      }    ");this.sphereMesh=w.Mesh.sphere({detail:10}),this.sphereShader=new w.Shader(ee+"    varying vec3 position;    void main() {      position = sphereCenter + gl_Vertex.xyz * sphereRadius;      gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);    }  ",ee+"    varying vec3 position;    void main() {      gl_FragColor = vec4(getSphereColor(position), 1.0);      vec4 info = texture2D(water, position.xz * 0.5 + 0.5);      if (position.y < info.r) {        gl_FragColor.rgb *= underwaterColor * 1.2;      }    }  "),this.cubeMesh=w.Mesh.cube(),this.cubeMesh.triangles.splice(4,2),this.cubeMesh.compile(),this.cubeShader=new w.Shader(ee+"    varying vec3 position;    void main() {      position = gl_Vertex.xyz;      position.y = ((1.0 - position.y) * (7.0 / 12.0) - 1.0) * poolHeight;      gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);    }  ",ee+"    varying vec3 position;    void main() {      gl_FragColor = vec4(getWallColor(position), 1.0);      vec4 info = texture2D(water, position.xz * 0.5 + 0.5);      if (position.y < info.r) {        gl_FragColor.rgb *= underwaterColor * 1.2;      }    }  "),this.sphereCenter=new w.Vector,this.sphereRadius=0;var T=!!this.gl.getExtension("OES_standard_derivatives");this.causticsShader=new w.Shader(ee+"    varying vec3 oldPos;    varying vec3 newPos;    varying vec3 ray;        /* project the ray onto the plane */    vec3 project(vec3 origin, vec3 ray, vec3 refractedLight) {      vec2 tcube = intersectCube(origin, ray, vec3(-1.0, -poolHeight, -1.0), vec3(1.0, 2.0, 1.0));      origin += ray * tcube.y;      float tplane = (-origin.y - 1.0) / refractedLight.y;      return origin + refractedLight * tplane;    }        void main() {      vec4 info = texture2D(water, gl_Vertex.xy * 0.5 + 0.5);      info.ba *= 0.5;      vec3 normal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);            /* project the vertices along the refracted vertex ray */      vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);      ray = refract(-light, normal, IOR_AIR / IOR_WATER);      oldPos = project(gl_Vertex.xzy, refractedLight, refractedLight);      newPos = project(gl_Vertex.xzy + vec3(0.0, info.r, 0.0), ray, refractedLight);            gl_Position = vec4(0.75 * (newPos.xz + refractedLight.xz / refractedLight.y), 0.0, 1.0);    }  ",(T?`#extension GL_OES_standard_derivatives : enable
`:"")+"    "+ee+"    varying vec3 oldPos;    varying vec3 newPos;    varying vec3 ray;        void main() {      "+(T?"        /* if the triangle gets smaller, it gets brighter, and vice versa */        float oldArea = length(dFdx(oldPos)) * length(dFdy(oldPos));        float newArea = length(dFdx(newPos)) * length(dFdy(newPos));        gl_FragColor = vec4(oldArea / newArea * 0.2, 1.0, 0.0, 0.0);      ":"        gl_FragColor = vec4(0.2, 0.2, 0.0, 0.0);      ")+"            vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);            /* compute a blob shadow and make sure we only draw a shadow if the player is blocking the light */      vec3 dir = (sphereCenter - newPos) / sphereRadius;      vec3 area = cross(dir, refractedLight);      float shadow = dot(area, area);      float dist = dot(dir, -refractedLight);      shadow = 1.0 + (shadow - 1.0) / (0.05 + dist * 0.025);      shadow = clamp(1.0 / (1.0 + exp(-shadow)), 0.0, 1.0);      shadow = mix(1.0, shadow, clamp(dist * 2.0, 0.0, 1.0));      gl_FragColor.g = shadow;            /* shadow for the rim of the pool */      vec2 t = intersectCube(newPos, -refractedLight, vec3(-1.0, -poolHeight, -1.0), vec3(1.0, 2.0, 1.0));      gl_FragColor.r *= 1.0 / (1.0 + exp(-200.0 / (1.0 + 10.0 * (t.y - t.x)) * (newPos.y - refractedLight.y * t.y - 2.0 / 12.0)));    }  ")}ae.prototype.updateCaustics=function(i){if(this.causticsShader){var c=this;this.causticTex.drawTo(function(){c.gl.clear(c.gl.COLOR_BUFFER_BIT),i.textureA.bind(0),c.causticsShader.uniforms({light:c.lightDir,water:0,sphereCenter:c.sphereCenter,sphereRadius:c.sphereRadius}).draw(c.waterMesh)})}};ae.prototype.renderWater=function(i,c){var T=new w.Raytracer;i.textureA.bind(0),this.tileTexture.bind(1),c.bind(2),this.causticTex.bind(3),this.flagTexture.bind(4),i.areaConservationTexture.bind(5),this.gl.enable(this.gl.CULL_FACE);for(var C=0;C<2;C++)this.gl.cullFace(C?this.gl.BACK:this.gl.FRONT),this.waterShaders[C].uniforms({light:this.lightDir,water:0,tiles:1,sky:2,causticTex:3,flag:4,areaConservationTexture:5,areaConservation:i.areaConservationEnabled,flagSize:.8,flagCenter:this.flagCenter,eye:T.eye,sphereCenter:this.sphereCenter,sphereRadius:this.sphereRadius}).draw(this.waterMesh);this.gl.disable(this.gl.CULL_FACE)};ae.prototype.renderSphere=function(i){i.textureA.bind(0),this.causticTex.bind(1),this.sphereShader.uniforms({light:this.lightDir,water:0,causticTex:1,sphereCenter:this.sphereCenter,sphereRadius:this.sphereRadius}).draw(this.sphereMesh)};ae.prototype.renderCube=function(i){this.gl.enable(this.gl.CULL_FACE),i.textureA.bind(0),this.tileTexture.bind(1),this.causticTex.bind(2),this.cubeShader.uniforms({light:this.lightDir,water:0,tiles:1,causticTex:2,sphereCenter:this.sphereCenter,sphereRadius:this.sphereRadius}).draw(this.cubeMesh),this.gl.disable(this.gl.CULL_FACE)};function he(i,c){this.gl=c,this.id=c.createTexture(),c.bindTexture(c.TEXTURE_CUBE_MAP,this.id),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,1),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.xneg),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.xpos),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.yneg),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.ypos),c.texImage2D(c.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.zneg),c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,i.zpos)}he.prototype.bind=function(i){this.gl.activeTexture(this.gl.TEXTURE0+(i||0)),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.id)};he.prototype.unbind=function(i){this.gl.activeTexture(this.gl.TEXTURE0+(i||0)),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null)};function le(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}function de(i){var c=le(i);c=="WebGL not supported"&&(c='Your browser does not support WebGL.<br>Please see    <a href="http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation">    Getting a WebGL Implementation</a>.');var T=document.getElementById("loading");T.innerHTML=c,T.style.zIndex=1}window.onerror=de;var E=w.create(),b,ue,G,ne=-25,se=-200.5,oe=!1,F,ce,z,fe,U,J=!1;window.onload=function(){var i=window.devicePixelRatio||1,c=document.getElementById("help");function T(){var v=innerWidth,I=innerHeight;E.canvas.width=v*i,E.canvas.height=I*i,E.canvas.style.width=v+"px",E.canvas.style.height=I+"px",E.viewport(0,0,E.canvas.width,E.canvas.height),E.matrixMode(E.PROJECTION),E.loadIdentity(),E.perspective(45,E.canvas.width/E.canvas.height,.01,100),E.matrixMode(E.MODELVIEW),q()}if(document.body.appendChild(E.canvas),E.clearColor(0,0,0,1),b=new Z(E),b.initAreaConservation(),console.log("Area conservation initialized."),G=new ae(E),ue=new he({xneg:document.getElementById("xneg"),xpos:document.getElementById("xpos"),yneg:document.getElementById("ypos"),ypos:document.getElementById("ypos"),zneg:document.getElementById("zneg"),zpos:document.getElementById("zpos")},E),!b.textureA.canDrawTo()||!b.textureB.canDrawTo())throw new Error("Rendering to floating-point textures is required but not supported");F=ce=new w.Vector(-.4,-.75,.2),z=new w.Vector,fe=new w.Vector(0,-4,0),U=.25;for(var C=0;C<20;C++)b.addDrop(Math.random()*2-1,Math.random()*2-1,.03,C&1?.01:-.01);document.getElementById("loading").innerHTML="",T();var O=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(v){setTimeout(v,0)},X=new Date().getTime();function M(){var v=new Date().getTime();J||(re((v-X)/1e3),q()),X=v,O(M)}O(M),window.onresize=T;var D,N,L=-1,W=0,p=1,H=2,k,P;function $(v,I){k=v,P=I;var S=new w.Raytracer,_=S.getRayForPixel(v*i,I*i),V=S.eye.add(_.multiply(-S.eye.y/_.y)),B=w.Raytracer.hitTestSphere(S.eye,_,F,U);B?(L=p,D=B.hit,N=S.getRayForPixel(E.canvas.width/2,E.canvas.height/2).negative()):Math.abs(V.x)<1&&Math.abs(V.z)<1?(L=W,K(v,I)):L=H}function K(v,I){switch(L){case W:{var S=new w.Raytracer,_=S.getRayForPixel(v*i,I*i),V=S.eye.add(_.multiply(-S.eye.y/_.y));b.addDrop(V.x,V.z,.03,.01),J&&(b.updateNormals(),G.updateCaustics(b));break}case p:{var S=new w.Raytracer,_=S.getRayForPixel(v*i,I*i),B=-N.dot(S.eye.subtract(D))/N.dot(_),te=S.eye.add(_.multiply(B));F=F.add(te.subtract(D)),F.x=Math.max(U-1,Math.min(1-U,F.x)),F.y=Math.max(U-1,Math.min(10,F.y)),F.z=Math.max(U-1,Math.min(1-U,F.z)),D=te,J&&G.updateCaustics(b);break}case H:{se-=v-k,ne-=I-P,ne=Math.max(-89.999,Math.min(89.999,ne));break}}k=v,P=I,J&&q()}function j(){L=-1}function Y(v){return v===c||v.parentNode&&Y(v.parentNode)}document.onmousedown=function(v){Y(v.target)||(v.preventDefault(),$(v.pageX,v.pageY))},document.onmousemove=function(v){K(v.pageX,v.pageY)},document.onmouseup=function(){j()},document.ontouchstart=function(v){v.touches.length===1&&!Y(v.target)&&(v.preventDefault(),$(v.touches[0].pageX,v.touches[0].pageY))},document.ontouchmove=function(v){v.touches.length===1&&K(v.touches[0].pageX,v.touches[0].pageY)},document.ontouchend=function(v){v.touches.length==0&&j()},document.onkeydown=function(v){v.which==32?J=!J:v.which==71?oe=!oe:v.which==76&&J?q():v.which==74?(z=new w.Vector(0,0,1.5),F=new w.Vector(0,1,-1),oe=!0):v.which==67&&(b.setAreaConservation(!b.areaConservationEnabled),console.log("Area conservation "+(b.areaConservationEnabled?"enabled.":"disabled.")))};function re(v){if(!(v>1)){if(L==p)z=new w.Vector;else if(oe){var I=Math.max(0,Math.min(1,(U-F.y)/(2*U)));z=z.add(fe.multiply(v-1.1*v*I)),z=z.subtract(z.unit().multiply(I*v*z.dot(z))),F=F.add(z.multiply(v)),F.y<U-1&&(F.y=U-1,z.y=Math.abs(z.y)*.7)}b.moveSphere(ce,F,U),ce=F,b.stepSimulation(),b.stepSimulation(),b.updateNormals(),G.updateCaustics(b)}}function q(){w.keys.L&&(G.lightDir=w.Vector.fromAngles((90-se)*Math.PI/180,-ne*Math.PI/180),J&&G.updateCaustics(b)),E.clear(E.COLOR_BUFFER_BIT|E.DEPTH_BUFFER_BIT),E.loadIdentity(),E.translate(0,0,-4),E.rotate(-ne,1,0,0),E.rotate(-se,0,1,0),E.translate(0,.5,0),E.enable(E.DEPTH_TEST),G.sphereCenter=F,G.sphereRadius=U,G.renderCube(b),G.renderWater(b,ue),G.renderSphere(b),E.disable(E.DEPTH_TEST)}};
//# sourceMappingURL=swimming-CesAxEzZ.js.map
