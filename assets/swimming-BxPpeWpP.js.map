{"version":3,"file":"swimming-BxPpeWpP.js","sources":["../../swimming/init-buffers.js","../../swimming/draw-scene.js","../../swimming/lightgl.js","../../swimming/video.js","../../swimming/test.js"],"sourcesContent":["// FROM https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample8\n\nfunction initBuffers(gl) {\n  const positionBuffer = initPositionBuffer(gl);\n\n  const textureCoordBuffer = initTextureBuffer(gl);\n\n  const indexBuffer = initIndexBuffer(gl);\n\n  const normalBuffer = initNormalBuffer(gl);\n\n  return {\n    position: positionBuffer,\n    normal: normalBuffer,\n    textureCoord: textureCoordBuffer,\n    indices: indexBuffer,\n  };\n}\n\nfunction initPositionBuffer(gl) {\n  // Create a buffer for the square's positions.\n  const positionBuffer = gl.createBuffer();\n\n  // Select the positionBuffer as the one to apply buffer\n  // operations to from here out.\n  gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n\n  const positions = [\n    // Front face\n    -1.0, -1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0,\n  ];\n\n  // Now pass the list of positions into WebGL to build the\n  // shape. We do this by creating a Float32Array from the\n  // JavaScript array, then use it to fill the current buffer.\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(positions), gl.STATIC_DRAW);\n\n  return positionBuffer;\n}\n\nfunction initColorBuffer(gl) {\n  const faceColors = [\n    [1.0, 1.0, 1.0, 1.0] // Front face: whit\n  ];\n\n  // Convert the array of colors into a table for all the vertices.\n\n  var colors = [];\n\n  for (var j = 0; j < faceColors.length; ++j) {\n    const c = faceColors[j];\n    // Repeat each color four times for the four vertices of the face\n    colors = colors.concat(c, c, c, c);\n  }\n\n  const colorBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, colorBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW);\n\n  return colorBuffer;\n}\n\nfunction initIndexBuffer(gl) {\n  const indexBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n\n  // This array defines each face as two triangles, using the\n  // indices into the vertex array to specify each triangle's\n  // position.\n\n  const indices = [\n    0,\n    1,\n    2,\n    0,\n    2,\n    3, // front\n  ];\n\n  // Now send the element array to GL\n\n  gl.bufferData(\n    gl.ELEMENT_ARRAY_BUFFER,\n    new Uint16Array(indices),\n    gl.STATIC_DRAW\n  );\n\n  return indexBuffer;\n}\n\nfunction initTextureBuffer(gl) {\n  const textureCoordBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, textureCoordBuffer);\n\n  const textureCoordinates = [\n    // Front\n    0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\n  ];\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array(textureCoordinates),\n    gl.STATIC_DRAW\n  );\n\n  return textureCoordBuffer;\n}\n\nfunction initNormalBuffer(gl) {\n  const normalBuffer = gl.createBuffer();\n  gl.bindBuffer(gl.ARRAY_BUFFER, normalBuffer);\n\n  const vertexNormals = [\n    // Front\n    0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\n  ];\n\n  gl.bufferData(\n    gl.ARRAY_BUFFER,\n    new Float32Array(vertexNormals),\n    gl.STATIC_DRAW\n  );\n\n  return normalBuffer;\n}\n\nexport { initBuffers };\n","// FROM https://github.com/mdn/dom-examples/tree/main/webgl-examples/tutorial/sample8\n\nfunction drawScene(gl, programInfo, buffers, texture, cubeRotation) {\n  gl.clearColor(0.0, 0.0, 0.0, 1.0); // Clear to black, fully opaque\n  gl.clearDepth(1.0); // Clear everything\n  gl.enable(gl.DEPTH_TEST); // Enable depth testing\n  gl.depthFunc(gl.LEQUAL); // Near things obscure far things\n\n  // Clear the canvas before we start drawing on it.\n\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n  // Create a perspective matrix, a special matrix that is\n  // used to simulate the distortion of perspective in a camera.\n  // Our field of view is 45 degrees, with a width/height\n  // ratio that matches the display size of the canvas\n  // and we only want to see objects between 0.1 units\n  // and 100 units away from the camera.\n\n  const fieldOfView = (45 * Math.PI) / 180; // in radians\n  const aspect = gl.canvas.clientWidth / gl.canvas.clientHeight;\n  const zNear = 0.1;\n  const zFar = 100.0;\n  const projectionMatrix = mat4.create();\n\n  // note: glmatrix.js always has the first argument\n  // as the destination to receive the result.\n  mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);\n\n  // Set the drawing position to the \"identity\" point, which is\n  // the center of the scene.\n  const modelViewMatrix = mat4.create();\n\n  // Now move the drawing position a bit to where we want to\n  // start drawing the square.\n  mat4.translate(\n    modelViewMatrix, // destination matrix\n    modelViewMatrix, // matrix to translate\n    [-0.0, 0.0, -6.0]\n  ); // amount to translate\n\n  mat4.rotate(\n    modelViewMatrix, // destination matrix\n    modelViewMatrix, // matrix to rotate\n    cubeRotation, // amount to rotate in radians\n    [0, 0, 1]\n  ); // axis to rotate around (Z)\n  mat4.rotate(\n    modelViewMatrix, // destination matrix\n    modelViewMatrix, // matrix to rotate\n    cubeRotation * 0.7, // amount to rotate in radians\n    [0, 1, 0]\n  ); // axis to rotate around (Y)\n  mat4.rotate(\n    modelViewMatrix, // destination matrix\n    modelViewMatrix, // matrix to rotate\n    cubeRotation * 0.3, // amount to rotate in radians\n    [1, 0, 0]\n  ); // axis to rotate around (X)\n\n  const normalMatrix = mat4.create();\n  mat4.invert(normalMatrix, modelViewMatrix);\n  mat4.transpose(normalMatrix, normalMatrix);\n\n  // Tell WebGL how to pull out the positions from the position\n  // buffer into the vertexPosition attribute.\n  setPositionAttribute(gl, buffers, programInfo);\n\n  setTextureAttribute(gl, buffers, programInfo);\n\n  // Tell WebGL which indices to use to index the vertices\n  gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffers.indices);\n\n  setNormalAttribute(gl, buffers, programInfo);\n\n  // Tell WebGL to use our program when drawing\n  gl.useProgram(programInfo.program);\n\n  // Set the shader uniforms\n  gl.uniformMatrix4fv(\n    programInfo.uniformLocations.projectionMatrix,\n    false,\n    projectionMatrix\n  );\n  gl.uniformMatrix4fv(\n    programInfo.uniformLocations.modelViewMatrix,\n    false,\n    modelViewMatrix\n  );\n  gl.uniformMatrix4fv(\n    programInfo.uniformLocations.normalMatrix,\n    false,\n    normalMatrix\n  );\n\n  // Tell WebGL we want to affect texture unit 0\n  gl.activeTexture(gl.TEXTURE0);\n\n  // Bind the texture to texture unit 0\n  gl.bindTexture(gl.TEXTURE_2D, texture);\n\n  // Tell the shader we bound the texture to texture unit 0\n  gl.uniform1i(programInfo.uniformLocations.uSampler, 0);\n\n  {\n    const vertexCount = 6;\n    const type = gl.UNSIGNED_SHORT;\n    const offset = 0;\n    gl.drawElements(gl.TRIANGLES, vertexCount, type, offset);\n  }\n}\n\n// Tell WebGL how to pull out the positions from the position\n// buffer into the vertexPosition attribute.\nfunction setPositionAttribute(gl, buffers, programInfo) {\n  const numComponents = 3;\n  const type = gl.FLOAT; // the data in the buffer is 32bit floats\n  const normalize = false; // don't normalize\n  const stride = 0; // how many bytes to get from one set of values to the next\n  // 0 = use type and numComponents above\n  const offset = 0; // how many bytes inside the buffer to start from\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffers.position);\n  gl.vertexAttribPointer(\n    programInfo.attribLocations.vertexPosition,\n    numComponents,\n    type,\n    normalize,\n    stride,\n    offset\n  );\n  gl.enableVertexAttribArray(programInfo.attribLocations.vertexPosition);\n}\n\n// Tell WebGL how to pull out the colors from the color buffer\n// into the vertexColor attribute.\nfunction setColorAttribute(gl, buffers, programInfo) {\n  const numComponents = 4;\n  const type = gl.FLOAT;\n  const normalize = false;\n  const stride = 0;\n  const offset = 0;\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffers.color);\n  gl.vertexAttribPointer(\n    programInfo.attribLocations.vertexColor,\n    numComponents,\n    type,\n    normalize,\n    stride,\n    offset\n  );\n  gl.enableVertexAttribArray(programInfo.attribLocations.vertexColor);\n}\n\n// tell webgl how to pull out the texture coordinates from buffer\nfunction setTextureAttribute(gl, buffers, programInfo) {\n  const num = 2; // every coordinate composed of 2 values\n  const type = gl.FLOAT; // the data in the buffer is 32-bit float\n  const normalize = false; // don't normalize\n  const stride = 0; // how many bytes to get from one set to the next\n  const offset = 0; // how many bytes inside the buffer to start from\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffers.textureCoord);\n  gl.vertexAttribPointer(\n    programInfo.attribLocations.textureCoord,\n    num,\n    type,\n    normalize,\n    stride,\n    offset\n  );\n  gl.enableVertexAttribArray(programInfo.attribLocations.textureCoord);\n}\n\n// Tell WebGL how to pull out the normals from\n// the normal buffer into the vertexNormal attribute.\nfunction setNormalAttribute(gl, buffers, programInfo) {\n  const numComponents = 3;\n  const type = gl.FLOAT;\n  const normalize = false;\n  const stride = 0;\n  const offset = 0;\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffers.normal);\n  gl.vertexAttribPointer(\n    programInfo.attribLocations.vertexNormal,\n    numComponents,\n    type,\n    normalize,\n    stride,\n    offset\n  );\n  gl.enableVertexAttribArray(programInfo.attribLocations.vertexNormal);\n}\n\nexport { drawScene };\n","/*\n * lightgl.js\n * http://github.com/evanw/lightgl.js/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\nvar GL = (function () {\n\n  // src/main.js\n  // The internal `gl` variable holds the current WebGL context.\n  var gl;\n\n  var GL = {\n    // ### Initialization\n    //\n    // `GL.create()` creates a new WebGL context and augments it with more\n    // methods. The alpha channel is disabled by default because it usually causes\n    // unintended transparencies in the canvas.\n    create: function (options) {\n      options = options || {};\n      var canvas = document.createElement('canvas');\n      canvas.width = 800;\n      canvas.height = 600;\n      if (!('alpha' in options)) options.alpha = false;\n      try { gl = canvas.getContext('webgl', options); } catch (e) { }\n      try { gl = gl || canvas.getContext('experimental-webgl', options); } catch (e) { }\n      if (!gl) throw new Error('WebGL not supported');\n      gl.HALF_FLOAT_OES = 0x8D61;\n      addMatrixStack();\n      addImmediateMode();\n      addEventListeners();\n      addOtherMethods();\n      return gl;\n    },\n\n    // `GL.keys` contains a mapping of key codes to booleans indicating whether\n    // that key is currently pressed.\n    keys: {},\n\n    // Export all external classes.\n    Matrix: Matrix,\n    Indexer: Indexer,\n    Buffer: Buffer,\n    Mesh: Mesh,\n    HitTest: HitTest,\n    Raytracer: Raytracer,\n    Shader: Shader,\n    Texture: Texture,\n    Vector: Vector\n  };\n\n  // ### Matrix stack\n  //\n  // Implement the OpenGL modelview and projection matrix stacks, along with some\n  // other useful GLU matrix functions.\n\n  function addMatrixStack() {\n    gl.MODELVIEW = ENUM | 1;\n    gl.PROJECTION = ENUM | 2;\n    var tempMatrix = new Matrix();\n    var resultMatrix = new Matrix();\n    gl.modelviewMatrix = new Matrix();\n    gl.projectionMatrix = new Matrix();\n    var modelviewStack = [];\n    var projectionStack = [];\n    var matrix, stack;\n    gl.matrixMode = function (mode) {\n      switch (mode) {\n        case gl.MODELVIEW:\n          matrix = 'modelviewMatrix';\n          stack = modelviewStack;\n          break;\n        case gl.PROJECTION:\n          matrix = 'projectionMatrix';\n          stack = projectionStack;\n          break;\n        default:\n          throw new Error('invalid matrix mode ' + mode);\n      }\n    };\n    gl.loadIdentity = function () {\n      Matrix.identity(gl[matrix]);\n    };\n    gl.loadMatrix = function (m) {\n      var from = m.m, to = gl[matrix].m;\n      for (var i = 0; i < 16; i++) {\n        to[i] = from[i];\n      }\n    };\n    gl.multMatrix = function (m) {\n      gl.loadMatrix(Matrix.multiply(gl[matrix], m, resultMatrix));\n    };\n    gl.perspective = function (fov, aspect, near, far) {\n      gl.multMatrix(Matrix.perspective(fov, aspect, near, far, tempMatrix));\n    };\n    gl.frustum = function (l, r, b, t, n, f) {\n      gl.multMatrix(Matrix.frustum(l, r, b, t, n, f, tempMatrix));\n    };\n    gl.ortho = function (l, r, b, t, n, f) {\n      gl.multMatrix(Matrix.ortho(l, r, b, t, n, f, tempMatrix));\n    };\n    gl.scale = function (x, y, z) {\n      gl.multMatrix(Matrix.scale(x, y, z, tempMatrix));\n    };\n    gl.translate = function (x, y, z) {\n      gl.multMatrix(Matrix.translate(x, y, z, tempMatrix));\n    };\n    gl.rotate = function (a, x, y, z) {\n      gl.multMatrix(Matrix.rotate(a, x, y, z, tempMatrix));\n    };\n    gl.lookAt = function (ex, ey, ez, cx, cy, cz, ux, uy, uz) {\n      gl.multMatrix(Matrix.lookAt(ex, ey, ez, cx, cy, cz, ux, uy, uz, tempMatrix));\n    };\n    gl.pushMatrix = function () {\n      stack.push(Array.prototype.slice.call(gl[matrix].m));\n    };\n    gl.popMatrix = function () {\n      var m = stack.pop();\n      gl[matrix].m = hasFloat32Array ? new Float32Array(m) : m;\n    };\n    gl.project = function (objX, objY, objZ, modelview, projection, viewport) {\n      modelview = modelview || gl.modelviewMatrix;\n      projection = projection || gl.projectionMatrix;\n      viewport = viewport || gl.getParameter(gl.VIEWPORT);\n      var point = projection.transformPoint(modelview.transformPoint(new Vector(objX, objY, objZ)));\n      return new Vector(\n        viewport[0] + viewport[2] * (point.x * 0.5 + 0.5),\n        viewport[1] + viewport[3] * (point.y * 0.5 + 0.5),\n        point.z * 0.5 + 0.5\n      );\n    };\n    gl.unProject = function (winX, winY, winZ, modelview, projection, viewport) {\n      modelview = modelview || gl.modelviewMatrix;\n      projection = projection || gl.projectionMatrix;\n      viewport = viewport || gl.getParameter(gl.VIEWPORT);\n      var point = new Vector(\n        (winX - viewport[0]) / viewport[2] * 2 - 1,\n        (winY - viewport[1]) / viewport[3] * 2 - 1,\n        winZ * 2 - 1\n      );\n      return Matrix.inverse(Matrix.multiply(projection, modelview, tempMatrix), resultMatrix).transformPoint(point);\n    };\n    gl.matrixMode(gl.MODELVIEW);\n  }\n\n  // ### Immediate mode\n  //\n  // Provide an implementation of OpenGL's deprecated immediate mode. This is\n  // depricated for a reason: constantly re-specifying the geometry is a bad\n  // idea for performance. You should use a `GL.Mesh` instead, which specifies\n  // the geometry once and caches it on the graphics card. Still, nothing\n  // beats a quick `gl.begin(gl.POINTS); gl.vertex(1, 2, 3); gl.end();` for\n  // debugging. This intentionally doesn't implement fixed-function lighting\n  // because it's only meant for quick debugging tasks.\n\n  function addImmediateMode() {\n    var immediateMode = {\n      mesh: new Mesh({ coords: true, colors: true, triangles: false }),\n      mode: -1,\n      coord: [0, 0, 0, 0],\n      color: [1, 1, 1, 1],\n      pointSize: 1,\n      shader: new Shader('\\\n      uniform float pointSize;\\\n      varying vec4 color;\\\n      varying vec4 coord;\\\n      void main() {\\\n        color = gl_Color;\\\n        coord = gl_TexCoord;\\\n        gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\\\n        gl_PointSize = pointSize;\\\n      }\\\n    ', '\\\n      uniform sampler2D texture;\\\n      uniform float pointSize;\\\n      uniform bool useTexture;\\\n      varying vec4 color;\\\n      varying vec4 coord;\\\n      void main() {\\\n        gl_FragColor = color;\\\n        if (useTexture) gl_FragColor *= texture2D(texture, coord.xy);\\\n      }\\\n    ')\n    };\n    gl.pointSize = function (pointSize) {\n      immediateMode.shader.uniforms({ pointSize: pointSize });\n    };\n    gl.begin = function (mode) {\n      if (immediateMode.mode != -1) throw new Error('mismatched gl.begin() and gl.end() calls');\n      immediateMode.mode = mode;\n      immediateMode.mesh.colors = [];\n      immediateMode.mesh.coords = [];\n      immediateMode.mesh.vertices = [];\n    };\n    gl.color = function (r, g, b, a) {\n      immediateMode.color = (arguments.length == 1) ? r.toArray().concat(1) : [r, g, b, a || 1];\n    };\n    gl.texCoord = function (s, t) {\n      immediateMode.coord = (arguments.length == 1) ? s.toArray(2) : [s, t];\n    };\n    gl.vertex = function (x, y, z) {\n      immediateMode.mesh.colors.push(immediateMode.color);\n      immediateMode.mesh.coords.push(immediateMode.coord);\n      immediateMode.mesh.vertices.push(arguments.length == 1 ? x.toArray() : [x, y, z]);\n    };\n    gl.end = function () {\n      if (immediateMode.mode == -1) throw new Error('mismatched gl.begin() and gl.end() calls');\n      immediateMode.mesh.compile();\n      immediateMode.shader.uniforms({\n        useTexture: !!gl.getParameter(gl.TEXTURE_BINDING_2D)\n      }).draw(immediateMode.mesh, immediateMode.mode);\n      immediateMode.mode = -1;\n    };\n  }\n\n  // ### Improved mouse events\n  //\n  // This adds event listeners on the `gl.canvas` element that call\n  // `gl.onmousedown()`, `gl.onmousemove()`, and `gl.onmouseup()` with an\n  // augmented event object. The event object also has the properties `x`, `y`,\n  // `deltaX`, `deltaY`, and `dragging`.\n  function addEventListeners() {\n    var context = gl, oldX = 0, oldY = 0, buttons = {}, hasOld = false;\n    var has = Object.prototype.hasOwnProperty;\n    function isDragging() {\n      for (var b in buttons) {\n        if (has.call(buttons, b) && buttons[b]) return true;\n      }\n      return false;\n    }\n    function augment(original) {\n      // Make a copy of original, a native `MouseEvent`, so we can overwrite\n      // WebKit's non-standard read-only `x` and `y` properties (which are just\n      // duplicates of `pageX` and `pageY`). We can't just use\n      // `Object.create(original)` because some `MouseEvent` functions must be\n      // called in the context of the original event object.\n      var e = {};\n      for (var name in original) {\n        if (typeof original[name] == 'function') {\n          e[name] = (function (callback) {\n            return function () {\n              callback.apply(original, arguments);\n            };\n          })(original[name]);\n        } else {\n          e[name] = original[name];\n        }\n      }\n      e.original = original;\n      e.x = e.pageX;\n      e.y = e.pageY;\n      for (var obj = gl.canvas; obj; obj = obj.offsetParent) {\n        e.x -= obj.offsetLeft;\n        e.y -= obj.offsetTop;\n      }\n      if (hasOld) {\n        e.deltaX = e.x - oldX;\n        e.deltaY = e.y - oldY;\n      } else {\n        e.deltaX = 0;\n        e.deltaY = 0;\n        hasOld = true;\n      }\n      oldX = e.x;\n      oldY = e.y;\n      e.dragging = isDragging();\n      e.preventDefault = function () {\n        e.original.preventDefault();\n      };\n      e.stopPropagation = function () {\n        e.original.stopPropagation();\n      };\n      return e;\n    }\n    function mousedown(e) {\n      gl = context;\n      if (!isDragging()) {\n        // Expand the event handlers to the document to handle dragging off canvas.\n        on(document, 'mousemove', mousemove);\n        on(document, 'mouseup', mouseup);\n        off(gl.canvas, 'mousemove', mousemove);\n        off(gl.canvas, 'mouseup', mouseup);\n      }\n      buttons[e.which] = true;\n      e = augment(e);\n      if (gl.onmousedown) gl.onmousedown(e);\n      e.preventDefault();\n    }\n    function mousemove(e) {\n      gl = context;\n      e = augment(e);\n      if (gl.onmousemove) gl.onmousemove(e);\n      e.preventDefault();\n    }\n    function mouseup(e) {\n      gl = context;\n      buttons[e.which] = false;\n      if (!isDragging()) {\n        // Shrink the event handlers back to the canvas when dragging ends.\n        off(document, 'mousemove', mousemove);\n        off(document, 'mouseup', mouseup);\n        on(gl.canvas, 'mousemove', mousemove);\n        on(gl.canvas, 'mouseup', mouseup);\n      }\n      e = augment(e);\n      if (gl.onmouseup) gl.onmouseup(e);\n      e.preventDefault();\n    }\n    function reset() {\n      hasOld = false;\n    }\n    function resetAll() {\n      buttons = {};\n      hasOld = false;\n    }\n    on(gl.canvas, 'mousedown', mousedown);\n    on(gl.canvas, 'mousemove', mousemove);\n    on(gl.canvas, 'mouseup', mouseup);\n    on(gl.canvas, 'mouseover', reset);\n    on(gl.canvas, 'mouseout', reset);\n    on(document, 'contextmenu', resetAll);\n  }\n\n  // ### Automatic keyboard state\n  //\n  // The current keyboard state is stored in `GL.keys`, a map of integer key\n  // codes to booleans indicating whether that key is currently pressed. Certain\n  // keys also have named identifiers that can be used directly, such as\n  // `GL.keys.SPACE`. Values in `GL.keys` are initially undefined until that\n  // key is pressed for the first time. If you need a boolean value, you can\n  // cast the value to boolean by applying the not operator twice (as in\n  // `!!GL.keys.SPACE`).\n\n  function mapKeyCode(code) {\n    var named = {\n      8: 'BACKSPACE',\n      9: 'TAB',\n      13: 'ENTER',\n      16: 'SHIFT',\n      27: 'ESCAPE',\n      32: 'SPACE',\n      37: 'LEFT',\n      38: 'UP',\n      39: 'RIGHT',\n      40: 'DOWN'\n    };\n    return named[code] || (code >= 65 && code <= 90 ? String.fromCharCode(code) : null);\n  }\n\n  function on(element, name, callback) {\n    element.addEventListener(name, callback);\n  }\n\n  function off(element, name, callback) {\n    element.removeEventListener(name, callback);\n  }\n\n  on(document, 'keydown', function (e) {\n    if (!e.altKey && !e.ctrlKey && !e.metaKey) {\n      var key = mapKeyCode(e.keyCode);\n      if (key) GL.keys[key] = true;\n      GL.keys[e.keyCode] = true;\n    }\n  });\n\n  on(document, 'keyup', function (e) {\n    if (!e.altKey && !e.ctrlKey && !e.metaKey) {\n      var key = mapKeyCode(e.keyCode);\n      if (key) GL.keys[key] = false;\n      GL.keys[e.keyCode] = false;\n    }\n  });\n\n  function addOtherMethods() {\n    // ### Multiple contexts\n    //\n    // When using multiple contexts in one web page, `gl.makeCurrent()` must be\n    // called before issuing commands to a different context.\n    (function (context) {\n      gl.makeCurrent = function () {\n        gl = context;\n      };\n    })(gl);\n\n    // ### Animation\n    //\n    // Call `gl.animate()` to provide an animation loop that repeatedly calls\n    // `gl.onupdate()` and `gl.ondraw()`.\n    gl.animate = function () {\n      var post =\n        window.requestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        function (callback) { setTimeout(callback, 1000 / 60); };\n      var time = new Date().getTime();\n      var context = gl;\n      function update() {\n        gl = context;\n        var now = new Date().getTime();\n        if (gl.onupdate) gl.onupdate((now - time) / 1000);\n        if (gl.ondraw) gl.ondraw();\n        post(update);\n        time = now;\n      }\n      update();\n    };\n\n    // ### Fullscreen\n    //\n    // Provide an easy way to get a fullscreen app running, including an\n    // automatic 3D perspective projection matrix by default. This should be\n    // called once.\n    //\n    // Just fullscreen, no automatic camera:\n    //\n    //     gl.fullscreen({ camera: false });\n    //\n    // Adjusting field of view, near plane distance, and far plane distance:\n    //\n    //     gl.fullscreen({ fov: 45, near: 0.1, far: 1000 });\n    //\n    // Adding padding from the edge of the window:\n    //\n    //     gl.fullscreen({ paddingLeft: 250, paddingBottom: 60 });\n    //\n    gl.fullscreen = function (options) {\n      options = options || {};\n      var top = options.paddingTop || 0;\n      var left = options.paddingLeft || 0;\n      var right = options.paddingRight || 0;\n      var bottom = options.paddingBottom || 0;\n      if (!document.body) {\n        throw new Error('document.body doesn\\'t exist yet (call gl.fullscreen() from ' +\n          'window.onload() or from inside the <body> tag)');\n      }\n      document.body.appendChild(gl.canvas);\n      document.body.style.overflow = 'hidden';\n      gl.canvas.style.position = 'absolute';\n      gl.canvas.style.left = left + 'px';\n      gl.canvas.style.top = top + 'px';\n      function resize() {\n        gl.canvas.width = window.innerWidth - left - right;\n        gl.canvas.height = window.innerHeight - top - bottom;\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n        if (options.camera || !('camera' in options)) {\n          gl.matrixMode(gl.PROJECTION);\n          gl.loadIdentity();\n          gl.perspective(options.fov || 45, gl.canvas.width / gl.canvas.height,\n            options.near || 0.1, options.far || 1000);\n          gl.matrixMode(gl.MODELVIEW);\n        }\n        if (gl.ondraw) gl.ondraw();\n      }\n      on(window, 'resize', resize);\n      resize();\n    };\n  }\n\n  // A value to bitwise-or with new enums to make them distinguishable from the\n  // standard WebGL enums.\n  var ENUM = 0x12340000;\n\n  // src/matrix.js\n  // Represents a 4x4 matrix stored in row-major order that uses Float32Arrays\n  // when available. Matrix operations can either be done using convenient\n  // methods that return a new matrix for the result or optimized methods\n  // that store the result in an existing matrix to avoid generating garbage.\n\n  var hasFloat32Array = (typeof Float32Array != 'undefined');\n\n  // ### new GL.Matrix([elements])\n  //\n  // This constructor takes 16 arguments in row-major order, which can be passed\n  // individually, as a list, or even as four lists, one for each row. If the\n  // arguments are omitted then the identity matrix is constructed instead.\n  function Matrix() {\n    var m = Array.prototype.concat.apply([], arguments);\n    if (!m.length) {\n      m = [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1\n      ];\n    }\n    this.m = hasFloat32Array ? new Float32Array(m) : m;\n  }\n\n  Matrix.prototype = {\n    // ### .inverse()\n    //\n    // Returns the matrix that when multiplied with this matrix results in the\n    // identity matrix.\n    inverse: function () {\n      return Matrix.inverse(this, new Matrix());\n    },\n\n    // ### .transpose()\n    //\n    // Returns this matrix, exchanging columns for rows.\n    transpose: function () {\n      return Matrix.transpose(this, new Matrix());\n    },\n\n    // ### .multiply(matrix)\n    //\n    // Returns the concatenation of the transforms for this matrix and `matrix`.\n    // This emulates the OpenGL function `glMultMatrix()`.\n    multiply: function (matrix) {\n      return Matrix.multiply(this, matrix, new Matrix());\n    },\n\n    // ### .transformPoint(point)\n    //\n    // Transforms the vector as a point with a w coordinate of 1. This\n    // means translations will have an effect, for example.\n    transformPoint: function (v) {\n      var m = this.m;\n      return new Vector(\n        m[0] * v.x + m[1] * v.y + m[2] * v.z + m[3],\n        m[4] * v.x + m[5] * v.y + m[6] * v.z + m[7],\n        m[8] * v.x + m[9] * v.y + m[10] * v.z + m[11]\n      ).divide(m[12] * v.x + m[13] * v.y + m[14] * v.z + m[15]);\n    },\n\n    // ### .transformPoint(vector)\n    //\n    // Transforms the vector as a vector with a w coordinate of 0. This\n    // means translations will have no effect, for example.\n    transformVector: function (v) {\n      var m = this.m;\n      return new Vector(\n        m[0] * v.x + m[1] * v.y + m[2] * v.z,\n        m[4] * v.x + m[5] * v.y + m[6] * v.z,\n        m[8] * v.x + m[9] * v.y + m[10] * v.z\n      );\n    }\n  };\n\n  // ### GL.Matrix.inverse(matrix[, result])\n  //\n  // Returns the matrix that when multiplied with `matrix` results in the\n  // identity matrix. You can optionally pass an existing matrix in `result`\n  // to avoid allocating a new matrix. This implementation is from the Mesa\n  // OpenGL function `__gluInvertMatrixd()` found in `project.c`.\n  Matrix.inverse = function (matrix, result) {\n    result = result || new Matrix();\n    var m = matrix.m, r = result.m;\n\n    r[0] = m[5] * m[10] * m[15] - m[5] * m[14] * m[11] - m[6] * m[9] * m[15] + m[6] * m[13] * m[11] + m[7] * m[9] * m[14] - m[7] * m[13] * m[10];\n    r[1] = -m[1] * m[10] * m[15] + m[1] * m[14] * m[11] + m[2] * m[9] * m[15] - m[2] * m[13] * m[11] - m[3] * m[9] * m[14] + m[3] * m[13] * m[10];\n    r[2] = m[1] * m[6] * m[15] - m[1] * m[14] * m[7] - m[2] * m[5] * m[15] + m[2] * m[13] * m[7] + m[3] * m[5] * m[14] - m[3] * m[13] * m[6];\n    r[3] = -m[1] * m[6] * m[11] + m[1] * m[10] * m[7] + m[2] * m[5] * m[11] - m[2] * m[9] * m[7] - m[3] * m[5] * m[10] + m[3] * m[9] * m[6];\n\n    r[4] = -m[4] * m[10] * m[15] + m[4] * m[14] * m[11] + m[6] * m[8] * m[15] - m[6] * m[12] * m[11] - m[7] * m[8] * m[14] + m[7] * m[12] * m[10];\n    r[5] = m[0] * m[10] * m[15] - m[0] * m[14] * m[11] - m[2] * m[8] * m[15] + m[2] * m[12] * m[11] + m[3] * m[8] * m[14] - m[3] * m[12] * m[10];\n    r[6] = -m[0] * m[6] * m[15] + m[0] * m[14] * m[7] + m[2] * m[4] * m[15] - m[2] * m[12] * m[7] - m[3] * m[4] * m[14] + m[3] * m[12] * m[6];\n    r[7] = m[0] * m[6] * m[11] - m[0] * m[10] * m[7] - m[2] * m[4] * m[11] + m[2] * m[8] * m[7] + m[3] * m[4] * m[10] - m[3] * m[8] * m[6];\n\n    r[8] = m[4] * m[9] * m[15] - m[4] * m[13] * m[11] - m[5] * m[8] * m[15] + m[5] * m[12] * m[11] + m[7] * m[8] * m[13] - m[7] * m[12] * m[9];\n    r[9] = -m[0] * m[9] * m[15] + m[0] * m[13] * m[11] + m[1] * m[8] * m[15] - m[1] * m[12] * m[11] - m[3] * m[8] * m[13] + m[3] * m[12] * m[9];\n    r[10] = m[0] * m[5] * m[15] - m[0] * m[13] * m[7] - m[1] * m[4] * m[15] + m[1] * m[12] * m[7] + m[3] * m[4] * m[13] - m[3] * m[12] * m[5];\n    r[11] = -m[0] * m[5] * m[11] + m[0] * m[9] * m[7] + m[1] * m[4] * m[11] - m[1] * m[8] * m[7] - m[3] * m[4] * m[9] + m[3] * m[8] * m[5];\n\n    r[12] = -m[4] * m[9] * m[14] + m[4] * m[13] * m[10] + m[5] * m[8] * m[14] - m[5] * m[12] * m[10] - m[6] * m[8] * m[13] + m[6] * m[12] * m[9];\n    r[13] = m[0] * m[9] * m[14] - m[0] * m[13] * m[10] - m[1] * m[8] * m[14] + m[1] * m[12] * m[10] + m[2] * m[8] * m[13] - m[2] * m[12] * m[9];\n    r[14] = -m[0] * m[5] * m[14] + m[0] * m[13] * m[6] + m[1] * m[4] * m[14] - m[1] * m[12] * m[6] - m[2] * m[4] * m[13] + m[2] * m[12] * m[5];\n    r[15] = m[0] * m[5] * m[10] - m[0] * m[9] * m[6] - m[1] * m[4] * m[10] + m[1] * m[8] * m[6] + m[2] * m[4] * m[9] - m[2] * m[8] * m[5];\n\n    var det = m[0] * r[0] + m[1] * r[4] + m[2] * r[8] + m[3] * r[12];\n    for (var i = 0; i < 16; i++) r[i] /= det;\n    return result;\n  };\n\n  // ### GL.Matrix.transpose(matrix[, result])\n  //\n  // Returns `matrix`, exchanging columns for rows. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.transpose = function (matrix, result) {\n    result = result || new Matrix();\n    var m = matrix.m, r = result.m;\n    r[0] = m[0]; r[1] = m[4]; r[2] = m[8]; r[3] = m[12];\n    r[4] = m[1]; r[5] = m[5]; r[6] = m[9]; r[7] = m[13];\n    r[8] = m[2]; r[9] = m[6]; r[10] = m[10]; r[11] = m[14];\n    r[12] = m[3]; r[13] = m[7]; r[14] = m[11]; r[15] = m[15];\n    return result;\n  };\n\n  // ### GL.Matrix.multiply(left, right[, result])\n  //\n  // Returns the concatenation of the transforms for `left` and `right`. You can\n  // optionally pass an existing matrix in `result` to avoid allocating a new\n  // matrix. This emulates the OpenGL function `glMultMatrix()`.\n  Matrix.multiply = function (left, right, result) {\n    result = result || new Matrix();\n    var a = left.m, b = right.m, r = result.m;\n\n    r[0] = a[0] * b[0] + a[1] * b[4] + a[2] * b[8] + a[3] * b[12];\n    r[1] = a[0] * b[1] + a[1] * b[5] + a[2] * b[9] + a[3] * b[13];\n    r[2] = a[0] * b[2] + a[1] * b[6] + a[2] * b[10] + a[3] * b[14];\n    r[3] = a[0] * b[3] + a[1] * b[7] + a[2] * b[11] + a[3] * b[15];\n\n    r[4] = a[4] * b[0] + a[5] * b[4] + a[6] * b[8] + a[7] * b[12];\n    r[5] = a[4] * b[1] + a[5] * b[5] + a[6] * b[9] + a[7] * b[13];\n    r[6] = a[4] * b[2] + a[5] * b[6] + a[6] * b[10] + a[7] * b[14];\n    r[7] = a[4] * b[3] + a[5] * b[7] + a[6] * b[11] + a[7] * b[15];\n\n    r[8] = a[8] * b[0] + a[9] * b[4] + a[10] * b[8] + a[11] * b[12];\n    r[9] = a[8] * b[1] + a[9] * b[5] + a[10] * b[9] + a[11] * b[13];\n    r[10] = a[8] * b[2] + a[9] * b[6] + a[10] * b[10] + a[11] * b[14];\n    r[11] = a[8] * b[3] + a[9] * b[7] + a[10] * b[11] + a[11] * b[15];\n\n    r[12] = a[12] * b[0] + a[13] * b[4] + a[14] * b[8] + a[15] * b[12];\n    r[13] = a[12] * b[1] + a[13] * b[5] + a[14] * b[9] + a[15] * b[13];\n    r[14] = a[12] * b[2] + a[13] * b[6] + a[14] * b[10] + a[15] * b[14];\n    r[15] = a[12] * b[3] + a[13] * b[7] + a[14] * b[11] + a[15] * b[15];\n\n    return result;\n  };\n\n  // ### GL.Matrix.identity([result])\n  //\n  // Returns an identity matrix. You can optionally pass an existing matrix in\n  // `result` to avoid allocating a new matrix. This emulates the OpenGL function\n  // `glLoadIdentity()`.\n  Matrix.identity = function (result) {\n    result = result || new Matrix();\n    var m = result.m;\n    m[0] = m[5] = m[10] = m[15] = 1;\n    m[1] = m[2] = m[3] = m[4] = m[6] = m[7] = m[8] = m[9] = m[11] = m[12] = m[13] = m[14] = 0;\n    return result;\n  };\n\n  // ### GL.Matrix.perspective(fov, aspect, near, far[, result])\n  //\n  // Returns a perspective transform matrix, which makes far away objects appear\n  // smaller than nearby objects. The `aspect` argument should be the width\n  // divided by the height of your viewport and `fov` is the top-to-bottom angle\n  // of the field of view in degrees. You can optionally pass an existing matrix\n  // in `result` to avoid allocating a new matrix. This emulates the OpenGL\n  // function `gluPerspective()`.\n  Matrix.perspective = function (fov, aspect, near, far, result) {\n    var y = Math.tan(fov * Math.PI / 360) * near;\n    var x = y * aspect;\n    return Matrix.frustum(-x, x, -y, y, near, far, result);\n  };\n\n  // ### GL.Matrix.frustum(left, right, bottom, top, near, far[, result])\n  //\n  // Sets up a viewing frustum, which is shaped like a truncated pyramid with the\n  // camera where the point of the pyramid would be. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix. This emulates\n  // the OpenGL function `glFrustum()`.\n  Matrix.frustum = function (l, r, b, t, n, f, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 2 * n / (r - l);\n    m[1] = 0;\n    m[2] = (r + l) / (r - l);\n    m[3] = 0;\n\n    m[4] = 0;\n    m[5] = 2 * n / (t - b);\n    m[6] = (t + b) / (t - b);\n    m[7] = 0;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = -(f + n) / (f - n);\n    m[11] = -2 * f * n / (f - n);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = -1;\n    m[15] = 0;\n\n    return result;\n  };\n\n  // ### GL.Matrix.ortho(left, right, bottom, top, near, far[, result])\n  //\n  // Returns an orthographic projection, in which objects are the same size no\n  // matter how far away or nearby they are. You can optionally pass an existing\n  // matrix in `result` to avoid allocating a new matrix. This emulates the OpenGL\n  // function `glOrtho()`.\n  Matrix.ortho = function (l, r, b, t, n, f, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 2 / (r - l);\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = -(r + l) / (r - l);\n\n    m[4] = 0;\n    m[5] = 2 / (t - b);\n    m[6] = 0;\n    m[7] = -(t + b) / (t - b);\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = -2 / (f - n);\n    m[11] = -(f + n) / (f - n);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.scale(x, y, z[, result])\n  //\n  // This emulates the OpenGL function `glScale()`. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.scale = function (x, y, z, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = x;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = 0;\n\n    m[4] = 0;\n    m[5] = y;\n    m[6] = 0;\n    m[7] = 0;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = z;\n    m[11] = 0;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.translate(x, y, z[, result])\n  //\n  // This emulates the OpenGL function `glTranslate()`. You can optionally pass\n  // an existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.translate = function (x, y, z, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 1;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = x;\n\n    m[4] = 0;\n    m[5] = 1;\n    m[6] = 0;\n    m[7] = y;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = 1;\n    m[11] = z;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.rotate(a, x, y, z[, result])\n  //\n  // Returns a matrix that rotates by `a` degrees around the vector `x, y, z`.\n  // You can optionally pass an existing matrix in `result` to avoid allocating\n  // a new matrix. This emulates the OpenGL function `glRotate()`.\n  Matrix.rotate = function (a, x, y, z, result) {\n    if (!a || (!x && !y && !z)) {\n      return Matrix.identity(result);\n    }\n\n    result = result || new Matrix();\n    var m = result.m;\n\n    var d = Math.sqrt(x * x + y * y + z * z);\n    a *= Math.PI / 180; x /= d; y /= d; z /= d;\n    var c = Math.cos(a), s = Math.sin(a), t = 1 - c;\n\n    m[0] = x * x * t + c;\n    m[1] = x * y * t - z * s;\n    m[2] = x * z * t + y * s;\n    m[3] = 0;\n\n    m[4] = y * x * t + z * s;\n    m[5] = y * y * t + c;\n    m[6] = y * z * t - x * s;\n    m[7] = 0;\n\n    m[8] = z * x * t - y * s;\n    m[9] = z * y * t + x * s;\n    m[10] = z * z * t + c;\n    m[11] = 0;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.lookAt(ex, ey, ez, cx, cy, cz, ux, uy, uz[, result])\n  //\n  // Returns a matrix that puts the camera at the eye point `ex, ey, ez` looking\n  // toward the center point `cx, cy, cz` with an up direction of `ux, uy, uz`.\n  // You can optionally pass an existing matrix in `result` to avoid allocating\n  // a new matrix. This emulates the OpenGL function `gluLookAt()`.\n  Matrix.lookAt = function (ex, ey, ez, cx, cy, cz, ux, uy, uz, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    var e = new Vector(ex, ey, ez);\n    var c = new Vector(cx, cy, cz);\n    var u = new Vector(ux, uy, uz);\n    var f = e.subtract(c).unit();\n    var s = u.cross(f).unit();\n    var t = f.cross(s).unit();\n\n    m[0] = s.x;\n    m[1] = s.y;\n    m[2] = s.z;\n    m[3] = -s.dot(e);\n\n    m[4] = t.x;\n    m[5] = t.y;\n    m[6] = t.z;\n    m[7] = -t.dot(e);\n\n    m[8] = f.x;\n    m[9] = f.y;\n    m[10] = f.z;\n    m[11] = -f.dot(e);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // src/mesh.js\n  // Represents indexed triangle geometry with arbitrary additional attributes.\n  // You need a shader to draw a mesh; meshes can't draw themselves.\n  //\n  // A mesh is a collection of `GL.Buffer` objects which are either vertex buffers\n  // (holding per-vertex attributes) or index buffers (holding the order in which\n  // vertices are rendered). By default, a mesh has a position vertex buffer called\n  // `vertices` and a triangle index buffer called `triangles`. New buffers can be\n  // added using `addVertexBuffer()` and `addIndexBuffer()`. Two strings are\n  // required when adding a new vertex buffer, the name of the data array on the\n  // mesh instance and the name of the GLSL attribute in the vertex shader.\n  //\n  // Example usage:\n  //\n  //     var mesh = new GL.Mesh({ coords: true, lines: true });\n  //\n  //     // Default attribute \"vertices\", available as \"gl_Vertex\" in\n  //     // the vertex shader\n  //     mesh.vertices = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]];\n  //\n  //     // Optional attribute \"coords\" enabled in constructor,\n  //     // available as \"gl_TexCoord\" in the vertex shader\n  //     mesh.coords = [[0, 0], [1, 0], [0, 1], [1, 1]];\n  //\n  //     // Custom attribute \"weights\", available as \"weight\" in the\n  //     // vertex shader\n  //     mesh.addVertexBuffer('weights', 'weight');\n  //     mesh.weights = [1, 0, 0, 1];\n  //\n  //     // Default index buffer \"triangles\"\n  //     mesh.triangles = [[0, 1, 2], [2, 1, 3]];\n  //\n  //     // Optional index buffer \"lines\" enabled in constructor\n  //     mesh.lines = [[0, 1], [0, 2], [1, 3], [2, 3]];\n  //\n  //     // Upload provided data to GPU memory\n  //     mesh.compile();\n\n  // ### new GL.Indexer()\n  //\n  // Generates indices into a list of unique objects from a stream of objects\n  // that may contain duplicates. This is useful for generating compact indexed\n  // meshes from unindexed data.\n  function Indexer() {\n    this.unique = [];\n    this.indices = [];\n    this.map = {};\n  }\n\n  Indexer.prototype = {\n    // ### .add(v)\n    //\n    // Adds the object `obj` to `unique` if it hasn't already been added. Returns\n    // the index of `obj` in `unique`.\n    add: function (obj) {\n      var key = JSON.stringify(obj);\n      if (!(key in this.map)) {\n        this.map[key] = this.unique.length;\n        this.unique.push(obj);\n      }\n      return this.map[key];\n    }\n  };\n\n  // ### new GL.Buffer(target, type)\n  //\n  // Provides a simple method of uploading data to a GPU buffer. Example usage:\n  //\n  //     var vertices = new GL.Buffer(gl.ARRAY_BUFFER, Float32Array);\n  //     var indices = new GL.Buffer(gl.ELEMENT_ARRAY_BUFFER, Uint16Array);\n  //     vertices.data = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]];\n  //     indices.data = [[0, 1, 2], [2, 1, 3]];\n  //     vertices.compile();\n  //     indices.compile();\n  //\n  function Buffer(target, type) {\n    this.buffer = null;\n    this.target = target;\n    this.type = type;\n    this.data = [];\n  }\n\n  Buffer.prototype = {\n    // ### .compile(type)\n    //\n    // Upload the contents of `data` to the GPU in preparation for rendering. The\n    // data must be a list of lists where each inner list has the same length. For\n    // example, each element of data for vertex normals would be a list of length three.\n    // This will remember the data length and element length for later use by shaders.\n    // The type can be either `gl.STATIC_DRAW` or `gl.DYNAMIC_DRAW`, and defaults to\n    // `gl.STATIC_DRAW`.\n    //\n    // This could have used `[].concat.apply([], this.data)` to flatten\n    // the array but Google Chrome has a maximum number of arguments so the\n    // concatenations are chunked to avoid that limit.\n    compile: function (type) {\n      var data = [];\n      for (var i = 0, chunk = 10000; i < this.data.length; i += chunk) {\n        data = Array.prototype.concat.apply(data, this.data.slice(i, i + chunk));\n      }\n      var spacing = this.data.length ? data.length / this.data.length : 0;\n      if (spacing != Math.round(spacing)) throw new Error('buffer elements not of consistent size, average size is ' + spacing);\n      this.buffer = this.buffer || gl.createBuffer();\n      this.buffer.length = data.length;\n      this.buffer.spacing = spacing;\n      gl.bindBuffer(this.target, this.buffer);\n      gl.bufferData(this.target, new this.type(data), type || gl.STATIC_DRAW);\n    }\n  };\n\n  // ### new GL.Mesh([options])\n  //\n  // Represents a collection of vertex buffers and index buffers. Each vertex\n  // buffer maps to one attribute in GLSL and has a corresponding property set\n  // on the Mesh instance. There is one vertex buffer by default: `vertices`,\n  // which maps to `gl_Vertex`. The `coords`, `normals`, and `colors` vertex\n  // buffers map to `gl_TexCoord`, `gl_Normal`, and `gl_Color` respectively,\n  // and can be enabled by setting the corresponding options to true. There are\n  // two index buffers, `triangles` and `lines`, which are used for rendering\n  // `gl.TRIANGLES` and `gl.LINES`, respectively. Only `triangles` is enabled by\n  // default, although `computeWireframe()` will add a normal buffer if it wasn't\n  // initially enabled.\n  function Mesh(options) {\n    options = options || {};\n    this.vertexBuffers = {};\n    this.indexBuffers = {};\n    this.addVertexBuffer('vertices', 'gl_Vertex');\n    if (options.coords) this.addVertexBuffer('coords', 'gl_TexCoord');\n    if (options.normals) this.addVertexBuffer('normals', 'gl_Normal');\n    if (options.colors) this.addVertexBuffer('colors', 'gl_Color');\n    if (!('triangles' in options) || options.triangles) this.addIndexBuffer('triangles');\n    if (options.lines) this.addIndexBuffer('lines');\n  }\n\n  Mesh.prototype = {\n    // ### .addVertexBuffer(name, attribute)\n    //\n    // Add a new vertex buffer with a list as a property called `name` on this object\n    // and map it to the attribute called `attribute` in all shaders that draw this mesh.\n    addVertexBuffer: function (name, attribute) {\n      var buffer = this.vertexBuffers[attribute] = new Buffer(gl.ARRAY_BUFFER, Float32Array);\n      buffer.name = name;\n      this[name] = [];\n    },\n\n    // ### .addIndexBuffer(name)\n    //\n    // Add a new index buffer with a list as a property called `name` on this object.\n    addIndexBuffer: function (name) {\n      var buffer = this.indexBuffers[name] = new Buffer(gl.ELEMENT_ARRAY_BUFFER, Uint16Array);\n      this[name] = [];\n    },\n\n    // ### .compile()\n    //\n    // Upload all attached buffers to the GPU in preparation for rendering. This\n    // doesn't need to be called every frame, only needs to be done when the data\n    // changes.\n    compile: function () {\n      for (var attribute in this.vertexBuffers) {\n        var buffer = this.vertexBuffers[attribute];\n        buffer.data = this[buffer.name];\n        buffer.compile();\n      }\n\n      for (var name in this.indexBuffers) {\n        var buffer = this.indexBuffers[name];\n        buffer.data = this[name];\n        buffer.compile();\n      }\n    },\n\n    // ### .transform(matrix)\n    //\n    // Transform all vertices by `matrix` and all normals by the inverse transpose\n    // of `matrix`.\n    transform: function (matrix) {\n      this.vertices = this.vertices.map(function (v) {\n        return matrix.transformPoint(Vector.fromArray(v)).toArray();\n      });\n      if (this.normals) {\n        var invTrans = matrix.inverse().transpose();\n        this.normals = this.normals.map(function (n) {\n          return invTrans.transformVector(Vector.fromArray(n)).unit().toArray();\n        });\n      }\n      this.compile();\n      return this;\n    },\n\n    // ### .computeNormals()\n    //\n    // Computes a new normal for each vertex from the average normal of the\n    // neighboring triangles. This means adjacent triangles must share vertices\n    // for the resulting normals to be smooth.\n    computeNormals: function () {\n      if (!this.normals) this.addVertexBuffer('normals', 'gl_Normal');\n      for (var i = 0; i < this.vertices.length; i++) {\n        this.normals[i] = new Vector();\n      }\n      for (var i = 0; i < this.triangles.length; i++) {\n        var t = this.triangles[i];\n        var a = Vector.fromArray(this.vertices[t[0]]);\n        var b = Vector.fromArray(this.vertices[t[1]]);\n        var c = Vector.fromArray(this.vertices[t[2]]);\n        var normal = b.subtract(a).cross(c.subtract(a)).unit();\n        this.normals[t[0]] = this.normals[t[0]].add(normal);\n        this.normals[t[1]] = this.normals[t[1]].add(normal);\n        this.normals[t[2]] = this.normals[t[2]].add(normal);\n      }\n      for (var i = 0; i < this.vertices.length; i++) {\n        this.normals[i] = this.normals[i].unit().toArray();\n      }\n      this.compile();\n      return this;\n    },\n\n    // ### .computeWireframe()\n    //\n    // Populate the `lines` index buffer from the `triangles` index buffer.\n    computeWireframe: function () {\n      var indexer = new Indexer();\n      for (var i = 0; i < this.triangles.length; i++) {\n        var t = this.triangles[i];\n        for (var j = 0; j < t.length; j++) {\n          var a = t[j], b = t[(j + 1) % t.length];\n          indexer.add([Math.min(a, b), Math.max(a, b)]);\n        }\n      }\n      if (!this.lines) this.addIndexBuffer('lines');\n      this.lines = indexer.unique;\n      this.compile();\n      return this;\n    },\n\n    // ### .getAABB()\n    //\n    // Computes the axis-aligned bounding box, which is an object whose `min` and\n    // `max` properties contain the minimum and maximum coordinates of all vertices.\n    getAABB: function () {\n      var aabb = { min: new Vector(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE) };\n      aabb.max = aabb.min.negative();\n      for (var i = 0; i < this.vertices.length; i++) {\n        var v = Vector.fromArray(this.vertices[i]);\n        aabb.min = Vector.min(aabb.min, v);\n        aabb.max = Vector.max(aabb.max, v);\n      }\n      return aabb;\n    },\n\n    // ### .getBoundingSphere()\n    //\n    // Computes a sphere that contains all vertices (not necessarily the smallest\n    // sphere). The returned object has two properties, `center` and `radius`.\n    getBoundingSphere: function () {\n      var aabb = this.getAABB();\n      var sphere = { center: aabb.min.add(aabb.max).divide(2), radius: 0 };\n      for (var i = 0; i < this.vertices.length; i++) {\n        sphere.radius = Math.max(sphere.radius,\n          Vector.fromArray(this.vertices[i]).subtract(sphere.center).length());\n      }\n      return sphere;\n    }\n  };\n\n  // ### GL.Mesh.plane([options])\n  //\n  // Generates a square 2x2 mesh the xy plane centered at the origin. The\n  // `options` argument specifies options to pass to the mesh constructor.\n  // Additional options include `detailX` and `detailY`, which set the tesselation\n  // in x and y, and `detail`, which sets both `detailX` and `detailY` at once.\n  // Two triangles are generated by default.\n  // Example usage:\n  //\n  //     var mesh1 = GL.Mesh.plane();\n  //     var mesh2 = GL.Mesh.plane({ detail: 5 });\n  //     var mesh3 = GL.Mesh.plane({ detailX: 20, detailY: 40 });\n  //\n  Mesh.plane = function (options) {\n    options = options || {};\n    var mesh = new Mesh(options);\n    var detailX = options.detailX || options.detail || 1;\n    var detailY = options.detailY || options.detail || 1;\n    var W = options.width || 2;\n    var H = options.height || 2;\n\n    for (var y = 0; y <= detailY; y++) {\n      var t = y / detailY;\n      for (var x = 0; x <= detailX; x++) {\n        var s = x / detailX;\n        mesh.vertices.push([(s - 0.5) * W, (t - 0.5) * H, 0]);\n        if (mesh.coords) mesh.coords.push([s, t]);\n        if (mesh.normals) mesh.normals.push([0, 0, 1]);\n        if (x < detailX && y < detailY) {\n          var i = x + y * (detailX + 1);\n          mesh.triangles.push([i, i + 1, i + detailX + 1]);\n          mesh.triangles.push([i + detailX + 1, i + 1, i + detailX + 2]);\n        }\n      }\n    }\n\n    mesh.compile();\n    return mesh;\n  };\n\n  var cubeData = [\n    [0, 4, 2, 6, -1, 0, 0], // -x\n    [1, 3, 5, 7, +1, 0, 0], // +x\n    [0, 1, 4, 5, 0, -1, 0], // -y\n    [2, 6, 3, 7, 0, +1, 0], // +y\n    [0, 2, 1, 3, 0, 0, -1], // -z\n    [4, 5, 6, 7, 0, 0, +1]  // +z\n  ];\n\n  function pickOctant(i) {\n    return new Vector((i & 1) * 2 - 1, (i & 2) - 1, (i & 4) / 2 - 1);\n  }\n\n  // ### GL.Mesh.cube([options])\n  //\n  // Generates a 2x2x2 box centered at the origin. The `options` argument\n  // specifies options to pass to the mesh constructor.\n  Mesh.cube = function (options) {\n    var mesh = new Mesh(options);\n    var w = options && options.width || 2;\n    var h = options && options.height || 2;\n    var d = options && options.depth || 2;\n\n    for (var i = 0; i < cubeData.length; i++) {\n      var data = cubeData[i], v = i * 4;\n      for (var j = 0; j < 4; j++) {\n        var cd = data[j];\n        const vertex = pickOctant(cd).toArray();\n        vertex[0] *= w / 2;\n        vertex[1] *= h / 2;\n        vertex[2] *= d / 2;\n        mesh.vertices.push(vertex);\n        if (mesh.coords) mesh.coords.push([j & 1, (j & 2) / 2]);\n        if (mesh.normals) mesh.normals.push(data.slice(4, 7));\n      }\n      mesh.triangles.push([v, v + 1, v + 2]);\n      mesh.triangles.push([v + 2, v + 1, v + 3]);\n    }\n\n    mesh.compile();\n    return mesh;\n  };\n\n  // ### GL.Mesh.sphere([options])\n  //\n  // Generates a geodesic sphere of radius 1. The `options` argument specifies\n  // options to pass to the mesh constructor in addition to the `detail` option,\n  // which controls the tesselation level. The detail is `6` by default.\n  // Example usage:\n  //\n  //     var mesh1 = GL.Mesh.sphere();\n  //     var mesh2 = GL.Mesh.sphere({ detail: 2 });\n  //\n  Mesh.sphere = function (options) {\n    function tri(a, b, c) { return flip ? [a, c, b] : [a, b, c]; }\n    function fix(x) { return x + (x - x * x) / 2; }\n    options = options || {};\n    var mesh = new Mesh(options);\n    var indexer = new Indexer();\n    var detail = options.detail || 6;\n\n    for (var octant = 0; octant < 8; octant++) {\n      var scale = pickOctant(octant);\n      var flip = scale.x * scale.y * scale.z > 0;\n      var data = [];\n      for (var i = 0; i <= detail; i++) {\n        // Generate a row of vertices on the surface of the sphere\n        // using barycentric coordinates.\n        for (var j = 0; i + j <= detail; j++) {\n          var a = i / detail;\n          var b = j / detail;\n          var c = (detail - i - j) / detail;\n          var vertex = { vertex: new Vector(fix(a), fix(b), fix(c)).unit().multiply(scale).toArray() };\n          if (mesh.coords) vertex.coord = scale.y > 0 ? [1 - a, c] : [c, 1 - a];\n          data.push(indexer.add(vertex));\n        }\n\n        // Generate triangles from this row and the previous row.\n        if (i > 0) {\n          for (var j = 0; i + j <= detail; j++) {\n            var a = (i - 1) * (detail + 1) + ((i - 1) - (i - 1) * (i - 1)) / 2 + j;\n            var b = i * (detail + 1) + (i - i * i) / 2 + j;\n            mesh.triangles.push(tri(data[a], data[a + 1], data[b]));\n            if (i + j < detail) {\n              mesh.triangles.push(tri(data[b], data[a + 1], data[b + 1]));\n            }\n          }\n        }\n      }\n    }\n\n    // Reconstruct the geometry from the indexer.\n    mesh.vertices = indexer.unique.map(function (v) { return v.vertex; });\n    if (mesh.coords) mesh.coords = indexer.unique.map(function (v) { return v.coord; });\n    if (mesh.normals) mesh.normals = mesh.vertices;\n    mesh.compile();\n    return mesh;\n  };\n\n  // ### GL.Mesh.load(json[, options])\n  //\n  // Creates a mesh from the JSON generated by the `convert/convert.py` script.\n  // Example usage:\n  //\n  //     var data = {\n  //       vertices: [[0, 0, 0], [1, 0, 0], [0, 1, 0]],\n  //       triangles: [[0, 1, 2]]\n  //     };\n  //     var mesh = GL.Mesh.load(data);\n  //\n  Mesh.load = function (json, options) {\n    options = options || {};\n    if (!('coords' in options)) options.coords = !!json.coords;\n    if (!('normals' in options)) options.normals = !!json.normals;\n    if (!('colors' in options)) options.colors = !!json.colors;\n    if (!('triangles' in options)) options.triangles = !!json.triangles;\n    if (!('lines' in options)) options.lines = !!json.lines;\n    var mesh = new Mesh(options);\n    mesh.vertices = json.vertices;\n    if (mesh.coords) mesh.coords = json.coords;\n    if (mesh.normals) mesh.normals = json.normals;\n    if (mesh.colors) mesh.colors = json.colors;\n    if (mesh.triangles) mesh.triangles = json.triangles;\n    if (mesh.lines) mesh.lines = json.lines;\n    mesh.compile();\n    return mesh;\n  };\n\n  // src/raytracer.js\n  // Provides a convenient raytracing interface.\n\n  // ### new GL.HitTest([t, hit, normal])\n  //\n  // This is the object used to return hit test results. If there are no\n  // arguments, the constructed argument represents a hit infinitely far\n  // away.\n  function HitTest(t, hit, normal) {\n    this.t = arguments.length ? t : Number.MAX_VALUE;\n    this.hit = hit;\n    this.normal = normal;\n  }\n\n  // ### .mergeWith(other)\n  //\n  // Changes this object to be the closer of the two hit test results.\n  HitTest.prototype = {\n    mergeWith: function (other) {\n      if (other.t > 0 && other.t < this.t) {\n        this.t = other.t;\n        this.hit = other.hit;\n        this.normal = other.normal;\n      }\n    }\n  };\n\n  // ### new GL.Raytracer()\n  //\n  // This will read the current modelview matrix, projection matrix, and viewport,\n  // reconstruct the eye position, and store enough information to later generate\n  // per-pixel rays using `getRayForPixel()`.\n  //\n  // Example usage:\n  //\n  //     var tracer = new GL.Raytracer();\n  //     var ray = tracer.getRayForPixel(\n  //       gl.canvas.width / 2,\n  //       gl.canvas.height / 2);\n  //     var result = GL.Raytracer.hitTestSphere(\n  //       tracer.eye, ray, new GL.Vector(0, 0, 0), 1);\n  function Raytracer() {\n    var v = gl.getParameter(gl.VIEWPORT);\n    var m = gl.modelviewMatrix.m;\n\n    var axisX = new Vector(m[0], m[4], m[8]);\n    var axisY = new Vector(m[1], m[5], m[9]);\n    var axisZ = new Vector(m[2], m[6], m[10]);\n    var offset = new Vector(m[3], m[7], m[11]);\n    this.eye = new Vector(-offset.dot(axisX), -offset.dot(axisY), -offset.dot(axisZ));\n\n    var minX = v[0], maxX = minX + v[2];\n    var minY = v[1], maxY = minY + v[3];\n    this.ray00 = gl.unProject(minX, minY, 1).subtract(this.eye);\n    this.ray10 = gl.unProject(maxX, minY, 1).subtract(this.eye);\n    this.ray01 = gl.unProject(minX, maxY, 1).subtract(this.eye);\n    this.ray11 = gl.unProject(maxX, maxY, 1).subtract(this.eye);\n    this.viewport = v;\n  }\n\n  Raytracer.prototype = {\n    // ### .getRayForPixel(x, y)\n    //\n    // Returns the ray originating from the camera and traveling through the pixel `x, y`.\n    getRayForPixel: function (x, y) {\n      x = (x - this.viewport[0]) / this.viewport[2];\n      y = 1 - (y - this.viewport[1]) / this.viewport[3];\n      var ray0 = Vector.lerp(this.ray00, this.ray10, x);\n      var ray1 = Vector.lerp(this.ray01, this.ray11, x);\n      return Vector.lerp(ray0, ray1, y).unit();\n    }\n  };\n\n  // ### GL.Raytracer.hitTestBox(origin, ray, min, max)\n  //\n  // Traces the ray starting from `origin` along `ray` against the axis-aligned box\n  // whose coordinates extend from `min` to `max`. Returns a `HitTest` with the\n  // information or `null` for no intersection.\n  //\n  // This implementation uses the [slab intersection method](http://www.siggraph.org/education/materials/HyperGraph/raytrace/rtinter3.htm).\n  Raytracer.hitTestBox = function (origin, ray, min, max) {\n    var tMin = min.subtract(origin).divide(ray);\n    var tMax = max.subtract(origin).divide(ray);\n    var t1 = Vector.min(tMin, tMax);\n    var t2 = Vector.max(tMin, tMax);\n    var tNear = t1.max();\n    var tFar = t2.min();\n\n    if (tNear > 0 && tNear < tFar) {\n      var epsilon = 1.0e-6, hit = origin.add(ray.multiply(tNear));\n      min = min.add(epsilon);\n      max = max.subtract(epsilon);\n      return new HitTest(tNear, hit, new Vector(\n        (hit.x > max.x) - (hit.x < min.x),\n        (hit.y > max.y) - (hit.y < min.y),\n        (hit.z > max.z) - (hit.z < min.z)\n      ));\n    }\n\n    return null;\n  };\n\n  // ### GL.Raytracer.hitTestSphere(origin, ray, center, radius)\n  //\n  // Traces the ray starting from `origin` along `ray` against the sphere defined\n  // by `center` and `radius`. Returns a `HitTest` with the information or `null`\n  // for no intersection.\n  Raytracer.hitTestSphere = function (origin, ray, center, radius) {\n    var offset = origin.subtract(center);\n    var a = ray.dot(ray);\n    var b = 2 * ray.dot(offset);\n    var c = offset.dot(offset) - radius * radius;\n    var discriminant = b * b - 4 * a * c;\n\n    if (discriminant > 0) {\n      var t = (-b - Math.sqrt(discriminant)) / (2 * a), hit = origin.add(ray.multiply(t));\n      return new HitTest(t, hit, hit.subtract(center).divide(radius));\n    }\n\n    return null;\n  };\n\n  // ### GL.Raytracer.hitTestTriangle(origin, ray, a, b, c)\n  //\n  // Traces the ray starting from `origin` along `ray` against the triangle defined\n  // by the points `a`, `b`, and `c`. Returns a `HitTest` with the information or\n  // `null` for no intersection.\n  Raytracer.hitTestTriangle = function (origin, ray, a, b, c) {\n    var ab = b.subtract(a);\n    var ac = c.subtract(a);\n    var normal = ab.cross(ac).unit();\n    var t = normal.dot(a.subtract(origin)) / normal.dot(ray);\n\n    if (t > 0) {\n      var hit = origin.add(ray.multiply(t));\n      var toHit = hit.subtract(a);\n      var dot00 = ac.dot(ac);\n      var dot01 = ac.dot(ab);\n      var dot02 = ac.dot(toHit);\n      var dot11 = ab.dot(ab);\n      var dot12 = ab.dot(toHit);\n      var divide = dot00 * dot11 - dot01 * dot01;\n      var u = (dot11 * dot02 - dot01 * dot12) / divide;\n      var v = (dot00 * dot12 - dot01 * dot02) / divide;\n      if (u >= 0 && v >= 0 && u + v <= 1) return new HitTest(t, hit, normal);\n    }\n\n    return null;\n  };\n\n  // src/shader.js\n  // Provides a convenient wrapper for WebGL shaders. A few uniforms and attributes,\n  // prefixed with `gl_`, are automatically added to all shader sources to make\n  // simple shaders easier to write.\n  //\n  // Example usage:\n  //\n  //     var shader = new GL.Shader('\\\n  //       void main() {\\\n  //         gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\\\n  //       }\\\n  //     ', '\\\n  //       uniform vec4 color;\\\n  //       void main() {\\\n  //         gl_FragColor = color;\\\n  //       }\\\n  //     ');\n  //\n  //     shader.uniforms({\n  //       color: [1, 0, 0, 1]\n  //     }).draw(mesh);\n\n  function regexMap(regex, text, callback) {\n    let result;\n    while ((result = regex.exec(text)) != null) {\n      callback(result);\n    }\n  }\n\n  // Non-standard names beginning with `gl_` must be mangled because they will\n  // otherwise cause a compiler error.\n  var LIGHTGL_PREFIX = 'LIGHTGL';\n\n  // ### new GL.Shader(vertexSource, fragmentSource)\n  //\n  // Compiles a shader program using the provided vertex and fragment shaders.\n  function Shader(vertexSource, fragmentSource) {\n    // Allow passing in the id of an HTML script tag with the source\n    function followScriptTagById(id) {\n      var element = document.getElementById(id);\n      return element ? element.text : id;\n    }\n    vertexSource = followScriptTagById(vertexSource);\n    fragmentSource = followScriptTagById(fragmentSource);\n\n    // Headers are prepended to the sources to provide some automatic functionality.\n    var header = '\\\n    uniform mat3 gl_NormalMatrix;\\\n    uniform mat4 gl_ModelViewMatrix;\\\n    uniform mat4 gl_ProjectionMatrix;\\\n    uniform mat4 gl_ModelViewProjectionMatrix;\\\n    uniform mat4 gl_ModelViewMatrixInverse;\\\n    uniform mat4 gl_ProjectionMatrixInverse;\\\n    uniform mat4 gl_ModelViewProjectionMatrixInverse;\\\n  ';\n    var vertexHeader = header + '\\\n    attribute vec4 gl_Vertex;\\\n    attribute vec4 gl_TexCoord;\\\n    attribute vec3 gl_Normal;\\\n    attribute vec4 gl_Color;\\\n    vec4 ftransform() {\\\n      return gl_ModelViewProjectionMatrix * gl_Vertex;\\\n    }\\\n  ';\n    var fragmentHeader = '\\\n    precision highp float;\\\n  ' + header;\n\n    // Check for the use of built-in matrices that require expensive matrix\n    // multiplications to compute, and record these in `usedMatrices`.\n    var source = vertexSource + fragmentSource;\n    var usedMatrices = {};\n    regexMap(/\\b(gl_[^;]*)\\b;/g, header, function (groups) {\n      var name = groups[1];\n      if (source.indexOf(name) != -1) {\n        var capitalLetters = name.replace(/[a-z_]/g, '');\n        usedMatrices[capitalLetters] = LIGHTGL_PREFIX + name;\n      }\n    });\n    if (source.indexOf('ftransform') != -1) usedMatrices.MVPM = LIGHTGL_PREFIX + 'gl_ModelViewProjectionMatrix';\n    this.usedMatrices = usedMatrices;\n\n    // The `gl_` prefix must be substituted for something else to avoid compile\n    // errors, since it's a reserved prefix. This prefixes all reserved names with\n    // `_`. The header is inserted after any extensions, since those must come\n    // first.\n    function fix(header, source) {\n      var replaced = {};\n      var match = /^((\\s*\\/\\/.*\\n|\\s*#extension.*\\n)+)[^]*$/.exec(source);\n      source = match ? match[1] + header + source.substr(match[1].length) : header + source;\n      regexMap(/\\bgl_\\w+\\b/g, header, function (result) {\n        if (!(result in replaced)) {\n          source = source.replace(new RegExp('\\\\b' + result + '\\\\b', 'g'), LIGHTGL_PREFIX + result);\n          replaced[result] = true;\n        }\n      });\n      return source;\n    }\n    vertexSource = fix(vertexHeader, vertexSource);\n    fragmentSource = fix(fragmentHeader, fragmentSource);\n\n    // Compile and link errors are thrown as strings.\n    function compileSource(type, source) {\n      var shader = gl.createShader(type);\n      gl.shaderSource(shader, source);\n      gl.compileShader(shader);\n      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        throw new Error('compile error: ' + gl.getShaderInfoLog(shader));\n      }\n      return shader;\n    }\n    this.program = gl.createProgram();\n    gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource));\n    gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\n    gl.linkProgram(this.program);\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error('link error: ' + gl.getProgramInfoLog(this.program));\n    }\n    this.attributes = {};\n    this.uniformLocations = {};\n\n    // Sampler uniforms need to be uploaded using `gl.uniform1i()` instead of `gl.uniform1f()`.\n    // To do this automatically, we detect and remember all uniform samplers in the source code.\n    var isSampler = {};\n    regexMap(/uniform\\s+sampler(1D|2D|3D|Cube)\\s+(\\w+)\\s*;/g, vertexSource + fragmentSource, function (groups) {\n      isSampler[groups[2]] = 1;\n    });\n    this.isSampler = isSampler;\n  }\n\n  function isArray(obj) {\n    var str = Object.prototype.toString.call(obj);\n    return str == '[object Array]' || str == '[object Float32Array]';\n  }\n\n  function isNumber(obj) {\n    var str = Object.prototype.toString.call(obj);\n    return str == '[object Number]' || str == '[object Boolean]';\n  }\n\n  var tempMatrix = new Matrix();\n  var resultMatrix = new Matrix();\n\n  Shader.prototype = {\n    // ### .uniforms(uniforms)\n    //\n    // Set a uniform for each property of `uniforms`. The correct `gl.uniform*()` method is\n    // inferred from the value types and from the stored uniform sampler flags.\n    uniforms: function (uniforms) {\n      gl.useProgram(this.program);\n\n      for (var name in uniforms) {\n        var location = this.uniformLocations[name] || gl.getUniformLocation(this.program, name);\n        if (!location) continue;\n        this.uniformLocations[name] = location;\n        var value = uniforms[name];\n        if (value instanceof Vector) {\n          value = [value.x, value.y, value.z];\n        } else if (value instanceof Matrix) {\n          value = value.m;\n        }\n        if (isArray(value)) {\n          switch (value.length) {\n            case 1: gl.uniform1fv(location, new Float32Array(value)); break;\n            case 2: gl.uniform2fv(location, new Float32Array(value)); break;\n            case 3: gl.uniform3fv(location, new Float32Array(value)); break;\n            case 4: gl.uniform4fv(location, new Float32Array(value)); break;\n            // Matrices are automatically transposed, since WebGL uses column-major\n            // indices instead of row-major indices.\n            case 9: gl.uniformMatrix3fv(location, false, new Float32Array([\n              value[0], value[3], value[6],\n              value[1], value[4], value[7],\n              value[2], value[5], value[8]\n            ])); break;\n            case 16: gl.uniformMatrix4fv(location, false, new Float32Array([\n              value[0], value[4], value[8], value[12],\n              value[1], value[5], value[9], value[13],\n              value[2], value[6], value[10], value[14],\n              value[3], value[7], value[11], value[15]\n            ])); break;\n            default: throw new Error('don\\'t know how to load uniform \"' + name + '\" of length ' + value.length);\n          }\n        } else if (isNumber(value)) {\n          (this.isSampler[name] ? gl.uniform1i : gl.uniform1f).call(gl, location, value);\n        } else {\n          throw new Error('attempted to set uniform \"' + name + '\" to invalid value ' + value);\n        }\n      }\n\n      return this;\n    },\n\n    // ### .draw(mesh[, mode])\n    //\n    // Sets all uniform matrix attributes, binds all relevant buffers, and draws the\n    // mesh geometry as indexed triangles or indexed lines. Set `mode` to `gl.LINES`\n    // (and either add indices to `lines` or call `computeWireframe()`) to draw the\n    // mesh in wireframe.\n    draw: function (mesh, mode) {\n      this.drawBuffers(mesh.vertexBuffers,\n        mesh.indexBuffers[mode == gl.LINES ? 'lines' : 'triangles'],\n        arguments.length < 2 ? gl.TRIANGLES : mode);\n    },\n\n    // ### .drawBuffers(vertexBuffers, indexBuffer, mode)\n    //\n    // Sets all uniform matrix attributes, binds all relevant buffers, and draws the\n    // indexed mesh geometry. The `vertexBuffers` argument is a map from attribute\n    // names to `Buffer` objects of type `gl.ARRAY_BUFFER`, `indexBuffer` is a `Buffer`\n    // object of type `gl.ELEMENT_ARRAY_BUFFER`, and `mode` is a WebGL primitive mode\n    // like `gl.TRIANGLES` or `gl.LINES`. This method automatically creates and caches\n    // vertex attribute pointers for attributes as needed.\n    drawBuffers: function (vertexBuffers, indexBuffer, mode) {\n      // Only construct up the built-in matrices we need for this shader.\n      var used = this.usedMatrices;\n      var MVM = gl.modelviewMatrix;\n      var PM = gl.projectionMatrix;\n      var MVMI = (used.MVMI || used.NM) ? MVM.inverse() : null;\n      var PMI = (used.PMI) ? PM.inverse() : null;\n      var MVPM = (used.MVPM || used.MVPMI) ? PM.multiply(MVM) : null;\n      var matrices = {};\n      if (used.MVM) matrices[used.MVM] = MVM;\n      if (used.MVMI) matrices[used.MVMI] = MVMI;\n      if (used.PM) matrices[used.PM] = PM;\n      if (used.PMI) matrices[used.PMI] = PMI;\n      if (used.MVPM) matrices[used.MVPM] = MVPM;\n      if (used.MVPMI) matrices[used.MVPMI] = MVPM.inverse();\n      if (used.NM) {\n        var m = MVMI.m;\n        matrices[used.NM] = [m[0], m[4], m[8], m[1], m[5], m[9], m[2], m[6], m[10]];\n      }\n      this.uniforms(matrices);\n\n      // Create and enable attribute pointers as necessary.\n      var length = 0;\n      for (var attribute in vertexBuffers) {\n        var buffer = vertexBuffers[attribute];\n        var location = this.attributes[attribute] ||\n          gl.getAttribLocation(this.program, attribute.replace(/^(gl_.*)$/, LIGHTGL_PREFIX + '$1'));\n        if (location == -1 || !buffer.buffer) continue;\n        this.attributes[attribute] = location;\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer.buffer);\n        gl.enableVertexAttribArray(location);\n        gl.vertexAttribPointer(location, buffer.buffer.spacing, gl.FLOAT, false, 0, 0);\n        length = buffer.buffer.length / buffer.buffer.spacing;\n      }\n\n      // Disable unused attribute pointers.\n      for (var attribute in this.attributes) {\n        if (!(attribute in vertexBuffers)) {\n          gl.disableVertexAttribArray(this.attributes[attribute]);\n        }\n      }\n\n      // Draw the geometry.\n      if (length && (!indexBuffer || indexBuffer.buffer)) {\n        if (indexBuffer) {\n          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer.buffer);\n          gl.drawElements(mode, indexBuffer.buffer.length, gl.UNSIGNED_SHORT, 0);\n        } else {\n          gl.drawArrays(mode, 0, length);\n        }\n      }\n\n      return this;\n    }\n  };\n\n  // src/texture.js\n  // Provides a simple wrapper around WebGL textures that supports render-to-texture.\n\n  // ### new GL.Texture(width, height[, options])\n  //\n  // The arguments `width` and `height` give the size of the texture in texels.\n  // WebGL texture dimensions must be powers of two unless `filter` is set to\n  // either `gl.NEAREST` or `gl.LINEAR` and `wrap` is set to `gl.CLAMP_TO_EDGE`\n  // (which they are by default).\n  //\n  // Texture parameters can be passed in via the `options` argument.\n  // Example usage:\n  //\n  //     var t = new GL.Texture(256, 256, {\n  //       // Defaults to gl.LINEAR, set both at once with \"filter\"\n  //       magFilter: gl.NEAREST,\n  //       minFilter: gl.LINEAR,\n  //\n  //       // Defaults to gl.CLAMP_TO_EDGE, set both at once with \"wrap\"\n  //       wrapS: gl.REPEAT,\n  //       wrapT: gl.REPEAT,\n  //\n  //       format: gl.RGB, // Defaults to gl.RGBA\n  //       type: gl.FLOAT // Defaults to gl.UNSIGNED_BYTE\n  //     });\n  function Texture(width, height, options) {\n    options = options || {};\n    this.id = gl.createTexture();\n    this.width = width;\n    this.height = height;\n    this.format = options.format || gl.RGBA;\n    this.type = options.type || gl.UNSIGNED_BYTE;\n    var magFilter = options.filter || options.magFilter || gl.LINEAR;\n    var minFilter = options.filter || options.minFilter || gl.LINEAR;\n    if (this.type === gl.FLOAT) {\n      if (!Texture.canUseFloatingPointTextures()) {\n        throw new Error('OES_texture_float is required but not supported');\n      }\n      if ((minFilter !== gl.NEAREST || magFilter !== gl.NEAREST) &&\n        !Texture.canUseFloatingPointLinearFiltering()) {\n        throw new Error('OES_texture_float_linear is required but not supported');\n      }\n    } else if (this.type === gl.HALF_FLOAT_OES) {\n      if (!Texture.canUseHalfFloatingPointTextures()) {\n        throw new Error('OES_texture_half_float is required but not supported');\n      }\n      if ((minFilter !== gl.NEAREST || magFilter !== gl.NEAREST) &&\n        !Texture.canUseHalfFloatingPointLinearFiltering()) {\n        throw new Error('OES_texture_half_float_linear is required but not supported');\n      }\n    }\n    gl.bindTexture(gl.TEXTURE_2D, this.id);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, options.wrap || options.wrapS || gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, options.wrap || options.wrapT || gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_2D, 0, this.format, width, height, 0, this.format, this.type, null);\n  }\n\n  var framebuffer;\n  var renderbuffer;\n  var checkerboardCanvas;\n\n  Texture.prototype = {\n    // ### .bind([unit])\n    //\n    // Bind this texture to the given texture unit (0-7, defaults to 0).\n    bind: function (unit) {\n      gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n      gl.bindTexture(gl.TEXTURE_2D, this.id);\n    },\n\n    // ### .unbind([unit])\n    //\n    // Clear the given texture unit (0-7, defaults to 0).\n    unbind: function (unit) {\n      gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n      gl.bindTexture(gl.TEXTURE_2D, null);\n    },\n\n    // ### .canDrawTo()\n    //\n    // Check if rendering to this texture is supported. It may not be supported\n    // for floating-point textures on some configurations.\n    canDrawTo: function () {\n      framebuffer = framebuffer || gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n      var result = gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE;\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      return result;\n    },\n\n    // ### .drawTo(callback)\n    //\n    // Render all draw calls in `callback` to this texture. This method sets up\n    // a framebuffer with this texture as the color attachment and a renderbuffer\n    // as the depth attachment. It also temporarily changes the viewport to the\n    // size of the texture.\n    //\n    // Example usage:\n    //\n    //     texture.drawTo(function() {\n    //       gl.clearColor(1, 0, 0, 1);\n    //       gl.clear(gl.COLOR_BUFFER_BIT);\n    //     });\n    drawTo: function (callback) {\n      var v = gl.getParameter(gl.VIEWPORT);\n      framebuffer = framebuffer || gl.createFramebuffer();\n      renderbuffer = renderbuffer || gl.createRenderbuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\n      if (this.width != renderbuffer.width || this.height != renderbuffer.height) {\n        renderbuffer.width = this.width;\n        renderbuffer.height = this.height;\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderbuffer);\n      if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) != gl.FRAMEBUFFER_COMPLETE) {\n        throw new Error('Rendering to this texture is not supported (incomplete framebuffer)');\n      }\n      gl.viewport(0, 0, this.width, this.height);\n\n      callback();\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n      gl.viewport(v[0], v[1], v[2], v[3]);\n    },\n\n    // ### .swapWith(other)\n    //\n    // Switch this texture with `other`, useful for the ping-pong rendering\n    // technique used in multi-stage rendering.\n    swapWith: function (other) {\n      var temp;\n      temp = other.id; other.id = this.id; this.id = temp;\n      temp = other.width; other.width = this.width; this.width = temp;\n      temp = other.height; other.height = this.height; this.height = temp;\n    }\n  };\n\n  // ### GL.Texture.fromImage(image[, options])\n  //\n  // Return a new image created from `image`, an `<img>` tag.\n  Texture.fromImage = function (image, options) {\n    options = options || {};\n    var texture = new Texture(image.width, image.height, options);\n    try {\n      gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, texture.type, image);\n    } catch (e) {\n      if (location.protocol == 'file:') {\n        throw new Error('image not loaded for security reasons (serve this page over \"http://\" instead)');\n      } else {\n        throw new Error('image not loaded for security reasons (image must originate from the same ' +\n          'domain as this page or use Cross-Origin Resource Sharing)');\n      }\n    }\n    if (options.minFilter && options.minFilter != gl.NEAREST && options.minFilter != gl.LINEAR) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    }\n    return texture;\n  };\n\n  // ### GL.Texture.fromURL(url[, options])\n  //\n  // Returns a checkerboard texture that will switch to the correct texture when\n  // it loads.\n  Texture.fromURL = function (url, options) {\n    checkerboardCanvas = checkerboardCanvas || (function () {\n      var c = document.createElement('canvas').getContext('2d');\n      c.canvas.width = c.canvas.height = 128;\n      for (var y = 0; y < c.canvas.height; y += 16) {\n        for (var x = 0; x < c.canvas.width; x += 16) {\n          c.fillStyle = (x ^ y) & 16 ? '#FFF' : '#DDD';\n          c.fillRect(x, y, 16, 16);\n        }\n      }\n      return c.canvas;\n    })();\n    var texture = Texture.fromImage(checkerboardCanvas, options);\n    var image = new Image();\n    var context = gl;\n    image.onload = function () {\n      context.makeCurrent();\n      Texture.fromImage(image, options).swapWith(texture);\n    };\n    image.src = url;\n    return texture;\n  };\n\n  // ### GL.Texture.canUseFloatingPointTextures()\n  //\n  // Returns false if `gl.FLOAT` is not supported as a texture type. This is the\n  // `OES_texture_float` extension.\n  Texture.canUseFloatingPointTextures = function () {\n    return !!gl.getExtension('OES_texture_float');\n  };\n\n  // ### GL.Texture.canUseFloatingPointLinearFiltering()\n  //\n  // Returns false if `gl.LINEAR` is not supported as a texture filter mode for\n  // textures of type `gl.FLOAT`. This is the `OES_texture_float_linear`\n  // extension.\n  Texture.canUseFloatingPointLinearFiltering = function () {\n    return !!gl.getExtension('OES_texture_float_linear');\n  };\n\n  // ### GL.Texture.canUseFloatingPointTextures()\n  //\n  // Returns false if `gl.HALF_FLOAT_OES` is not supported as a texture type.\n  // This is the `OES_texture_half_float` extension.\n  Texture.canUseHalfFloatingPointTextures = function () {\n    return !!gl.getExtension('OES_texture_half_float');\n  };\n\n  // ### GL.Texture.canUseFloatingPointLinearFiltering()\n  //\n  // Returns false if `gl.LINEAR` is not supported as a texture filter mode for\n  // textures of type `gl.HALF_FLOAT_OES`. This is the\n  // `OES_texture_half_float_linear` extension.\n  Texture.canUseHalfFloatingPointLinearFiltering = function () {\n    return !!gl.getExtension('OES_texture_half_float_linear');\n  };\n\n  // src/vector.js\n  // Provides a simple 3D vector class. Vector operations can be done using member\n  // functions, which return new vectors, or static functions, which reuse\n  // existing vectors to avoid generating garbage.\n  function Vector(x, y, z) {\n    this.x = x || 0;\n    this.y = y || 0;\n    this.z = z || 0;\n  }\n\n  // ### Instance Methods\n  // The methods `add()`, `subtract()`, `multiply()`, and `divide()` can all\n  // take either a vector or a number as an argument.\n  Vector.prototype = {\n    negative: function () {\n      return new Vector(-this.x, -this.y, -this.z);\n    },\n    add: function (v) {\n      if (v instanceof Vector) return new Vector(this.x + v.x, this.y + v.y, this.z + v.z);\n      else return new Vector(this.x + v, this.y + v, this.z + v);\n    },\n    subtract: function (v) {\n      if (v instanceof Vector) return new Vector(this.x - v.x, this.y - v.y, this.z - v.z);\n      else return new Vector(this.x - v, this.y - v, this.z - v);\n    },\n    multiply: function (v) {\n      if (v instanceof Vector) return new Vector(this.x * v.x, this.y * v.y, this.z * v.z);\n      else return new Vector(this.x * v, this.y * v, this.z * v);\n    },\n    divide: function (v) {\n      if (v instanceof Vector) return new Vector(this.x / v.x, this.y / v.y, this.z / v.z);\n      else return new Vector(this.x / v, this.y / v, this.z / v);\n    },\n    equals: function (v) {\n      return this.x == v.x && this.y == v.y && this.z == v.z;\n    },\n    dot: function (v) {\n      return this.x * v.x + this.y * v.y + this.z * v.z;\n    },\n    cross: function (v) {\n      return new Vector(\n        this.y * v.z - this.z * v.y,\n        this.z * v.x - this.x * v.z,\n        this.x * v.y - this.y * v.x\n      );\n    },\n    length: function () {\n      return Math.sqrt(this.dot(this));\n    },\n    unit: function () {\n      return this.divide(this.length());\n    },\n    min: function () {\n      return Math.min(Math.min(this.x, this.y), this.z);\n    },\n    max: function () {\n      return Math.max(Math.max(this.x, this.y), this.z);\n    },\n    toAngles: function () {\n      return {\n        theta: Math.atan2(this.z, this.x),\n        phi: Math.asin(this.y / this.length())\n      };\n    },\n    angleTo: function (a) {\n      return Math.acos(this.dot(a) / (this.length() * a.length()));\n    },\n    toArray: function (n) {\n      return [this.x, this.y, this.z].slice(0, n || 3);\n    },\n    clone: function () {\n      return new Vector(this.x, this.y, this.z);\n    },\n    init: function (x, y, z) {\n      this.x = x; this.y = y; this.z = z;\n      return this;\n    }\n  };\n\n  // ### Static Methods\n  // `Vector.randomDirection()` returns a vector with a length of 1 and a\n  // statistically uniform direction. `Vector.lerp()` performs linear\n  // interpolation between two vectors.\n  Vector.negative = function (a, b) {\n    b.x = -a.x; b.y = -a.y; b.z = -a.z;\n    return b;\n  };\n  Vector.add = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x + b.x; c.y = a.y + b.y; c.z = a.z + b.z; }\n    else { c.x = a.x + b; c.y = a.y + b; c.z = a.z + b; }\n    return c;\n  };\n  Vector.subtract = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x - b.x; c.y = a.y - b.y; c.z = a.z - b.z; }\n    else { c.x = a.x - b; c.y = a.y - b; c.z = a.z - b; }\n    return c;\n  };\n  Vector.multiply = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x * b.x; c.y = a.y * b.y; c.z = a.z * b.z; }\n    else { c.x = a.x * b; c.y = a.y * b; c.z = a.z * b; }\n    return c;\n  };\n  Vector.divide = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x / b.x; c.y = a.y / b.y; c.z = a.z / b.z; }\n    else { c.x = a.x / b; c.y = a.y / b; c.z = a.z / b; }\n    return c;\n  };\n  Vector.cross = function (a, b, c) {\n    c.x = a.y * b.z - a.z * b.y;\n    c.y = a.z * b.x - a.x * b.z;\n    c.z = a.x * b.y - a.y * b.x;\n    return c;\n  };\n  Vector.unit = function (a, b) {\n    var length = a.length();\n    b.x = a.x / length;\n    b.y = a.y / length;\n    b.z = a.z / length;\n    return b;\n  };\n  Vector.fromAngles = function (theta, phi) {\n    return new Vector(Math.cos(theta) * Math.cos(phi), Math.sin(phi), Math.sin(theta) * Math.cos(phi));\n  };\n  Vector.randomDirection = function () {\n    return Vector.fromAngles(Math.random() * Math.PI * 2, Math.asin(Math.random() * 2 - 1));\n  };\n  Vector.min = function (a, b) {\n    return new Vector(Math.min(a.x, b.x), Math.min(a.y, b.y), Math.min(a.z, b.z));\n  };\n  Vector.max = function (a, b) {\n    return new Vector(Math.max(a.x, b.x), Math.max(a.y, b.y), Math.max(a.z, b.z));\n  };\n  Vector.lerp = function (a, b, fraction) {\n    return b.subtract(a).multiply(fraction).add(a);\n  };\n  Vector.fromArray = function (a) {\n    return new Vector(a[0], a[1], a[2]);\n  };\n  Vector.angleBetween = function (a, b) {\n    return a.angleTo(b);\n  };\n\n  return GL;\n})();\n\nexport default GL;\n\n","import { initBuffers } from \"./init-buffers.js\";\nimport { drawScene } from \"./draw-scene.js\";\nimport GL from \"./lightgl.js\";\n\nlet cubeRotation = 0.0;\n// will set to true when video can be copied to texture\n\n\n\n//\n// start here\n//\nclass Video {\n    constructor(path, gl) {\n        this.gl = gl\n        this.copyVideo = false;\n        this.deltaTime = 0;\n        // Only continue if WebGL is available and working\n        if (gl === null) {\n            alert(\n                \"Unable to initialize WebGL. Your browser or machine may not support it.\"\n            );\n            return;\n        }\n        // Set clear color to black, fully opaque\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        // Clear the color buffer with specified clear color\n        gl.clear(gl.COLOR_BUFFER_BIT);\n\n        // Vertex shader program\n\n        const vsSource = `\n  attribute vec4 aVertexPosition;\n  attribute vec3 aVertexNormal;\n  attribute vec2 aTextureCoord;\n\n  uniform mat4 uNormalMatrix;\n  uniform mat4 uModelViewMatrix;\n  uniform mat4 uProjectionMatrix;\n\n  varying highp vec2 vTextureCoord;\n  varying highp vec3 vLighting;\n\n  void main(void) {\n    gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;\n    vTextureCoord = aTextureCoord;\n\n    // Apply lighting effect\n\n    highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\n    highp vec3 directionalLightColor = vec3(1, 1, 1);\n    highp vec3 directionalVector = normalize(vec3(0.85, 0.8, 0.75));\n\n    highp vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);\n\n    highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\n    vLighting = ambientLight + (directionalLightColor * directional);\n  }\n`;\n\n        // Fragment shader program\n\n        const fsSource = `\n  varying highp vec2 vTextureCoord;\n  varying highp vec3 vLighting;\n\n  uniform sampler2D uSampler;\n\n  void main(void) {\n    highp vec4 texelColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor = vec4(texelColor.rgb * vLighting, texelColor.a);\n  }\n`;\n\n        // Initialize a shader program; this is where all the lighting\n        // for the vertices and so forth is established.\n        const shaderProgram = this.initShaderProgram(vsSource, fsSource);\n\n        // Collect all the info needed to use the shader program.\n        // Look up which attributes our shader program is using\n        // for aVertexPosition, aVertexColor and also\n        // look up uniform locations.\n        this.programInfo = {\n            program: shaderProgram,\n            attribLocations: {\n                vertexPosition: gl.getAttribLocation(shaderProgram, \"aVertexPosition\"),\n                vertexNormal: gl.getAttribLocation(shaderProgram, \"aVertexNormal\"),\n                textureCoord: gl.getAttribLocation(shaderProgram, \"aTextureCoord\"),\n            },\n            uniformLocations: {\n                projectionMatrix: gl.getUniformLocation(\n                    shaderProgram,\n                    \"uProjectionMatrix\"\n                ),\n                modelViewMatrix: gl.getUniformLocation(shaderProgram, \"uModelViewMatrix\"),\n                normalMatrix: gl.getUniformLocation(shaderProgram, \"uNormalMatrix\"),\n                uSampler: gl.getUniformLocation(shaderProgram, \"uSampler\"),\n            },\n        };\n\n        // Here's where we call the routine that builds all the\n        // objects we'll be drawing.\n        this.buffers = initBuffers(gl);\n\n        this.texture = this.initTexture();\n        this.video = this.setupVideo(path);\n\n        // Flip image pixels into the bottom-to-top order that WebGL expects.\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n        this.then = 0;\n    }\n\n    render(now) {\n        now *= 0.001; // convert to seconds\n        this.deltaTime = now - this.then;\n        this.then = now;\n\n        if (this.copyVideo) {\n            this.updateTexture();\n        }\n\n        drawScene(this.gl, this.programInfo, this.buffers, this.texture, cubeRotation);\n        cubeRotation += this.deltaTime;\n    }\n\n    //\n    // Initialize a shader program, so WebGL knows how to draw our data\n    //\n    initShaderProgram(vsSource, fsSource) {\n        const vertexShader = this.loadShader(this.gl.VERTEX_SHADER, vsSource);\n        const fragmentShader = this.loadShader(this.gl.FRAGMENT_SHADER, fsSource);\n\n        // Create the shader program\n\n        const shaderProgram = this.gl.createProgram();\n        this.gl.attachShader(shaderProgram, vertexShader);\n        this.gl.attachShader(shaderProgram, fragmentShader);\n        this.gl.linkProgram(shaderProgram);\n\n        // If creating the shader program failed, alert\n\n        if (!this.gl.getProgramParameter(shaderProgram, this.gl.LINK_STATUS)) {\n            alert(\n                `Unable to initialize the shader program: ${this.gl.getProgramInfoLog(\n                    shaderProgram\n                )}`\n            );\n            return null;\n        }\n\n        return shaderProgram;\n    }\n\n    //\n    // creates a shader of the given type, uploads the source and\n    // compiles it.\n    //\n    loadShader(type, source) {\n        const shader = this.gl.createShader(type);\n\n        // Send the source to the shader object\n\n        this.gl.shaderSource(shader, source);\n\n        // Compile the shader program\n\n        this.gl.compileShader(shader);\n\n        // See if it compiled successfully\n\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n            alert(\n                `An error occurred compiling the shaders: ${this.gl.getShaderInfoLog(shader)}`\n            );\n            this.gl.deleteShader(shader);\n            return null;\n        }\n\n        return shader;\n    }\n\n    initTexture() {\n        const texture = this.gl.createTexture();\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n        // Because video has to be download over the internet\n        // they might take a moment until it's ready so\n        // put a single pixel in the texture so we can\n        // use it immediately.\n        const level = 0;\n        const internalFormat = this.gl.RGBA;\n        const width = 1;\n        const height = 1;\n        const border = 0;\n        const srcFormat = this.gl.RGBA;\n        const srcType = this.gl.UNSIGNED_BYTE;\n        const pixel = new Uint8Array([0, 0, 255, 255]); // opaque blue\n        this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            level,\n            internalFormat,\n            width,\n            height,\n            border,\n            srcFormat,\n            srcType,\n            pixel\n        );\n\n        // Turn off mips and set wrapping to clamp to edge so it\n        // will work regardless of the dimensions of the video.\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\n        return texture;\n    }\n\n    updateTexture() {\n        const level = 0;\n        const internalFormat = this.gl.RGBA;\n        const srcFormat = this.gl.RGBA;\n        const srcType = this.gl.UNSIGNED_BYTE;\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\n        this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            level,\n            internalFormat,\n            srcFormat,\n            srcType,\n            this.video\n        );\n    }\n\n    setupVideo(url) {\n        const video = document.createElement(\"video\");\n\n        let playing = false;\n        let timeupdate = false;\n\n        video.playsInline = true;\n        video.muted = true;\n        video.loop = true;\n\n        // Waiting for these 2 events ensures\n        // there is data in the video\n\n        video.addEventListener(\n            \"playing\",\n            () => {\n                playing = true;\n                checkReady();\n            },\n            true\n        );\n\n        video.addEventListener(\n            \"timeupdate\",\n            () => {\n                timeupdate = true;\n                checkReady();\n            },\n            true\n        );\n\n        video.src = url;\n        video.play();\n        const this_ = this;\n        const checkReady = () => {\n            if (playing && timeupdate) {\n                this_.copyVideo = true;\n            }\n        }\n\n        return video;\n    }\n}\n\nexport { Video };","import { Video } from \"./video\";\nimport GL from \"./lightgl\";\n\nconst gl = GL.create();\ndocument.body.appendChild(gl.canvas);\nconst video = new Video(\"./assets/video.mp4\", gl);\n\nconst draw = function (now) {\n    video.render(now);\n    requestAnimationFrame(draw);\n}\n\nrequestAnimationFrame(draw);"],"names":["initBuffers","gl","positionBuffer","initPositionBuffer","textureCoordBuffer","initTextureBuffer","indexBuffer","initIndexBuffer","normalBuffer","initNormalBuffer","positions","indices","textureCoordinates","vertexNormals","drawScene","programInfo","buffers","texture","cubeRotation","fieldOfView","aspect","zNear","zFar","projectionMatrix","modelViewMatrix","normalMatrix","setPositionAttribute","setTextureAttribute","setNormalAttribute","type","normalize","stride","offset","GL","options","canvas","addMatrixStack","addImmediateMode","addEventListeners","addOtherMethods","Matrix","Indexer","Buffer","Mesh","HitTest","Raytracer","Shader","Texture","Vector","ENUM","tempMatrix","resultMatrix","modelviewStack","projectionStack","matrix","stack","mode","m","from","to","i","fov","near","far","l","r","b","t","n","f","x","y","z","a","ex","ey","ez","cx","cy","cz","ux","uy","uz","hasFloat32Array","objX","objY","objZ","modelview","projection","viewport","point","winX","winY","winZ","immediateMode","pointSize","g","s","context","oldX","oldY","buttons","hasOld","has","isDragging","augment","original","e","name","callback","obj","mousedown","on","mousemove","mouseup","off","reset","resetAll","mapKeyCode","code","named","element","key","post","time","update","now","top","left","right","bottom","resize","v","result","det","d","c","u","target","data","chunk","spacing","attribute","buffer","invTrans","normal","indexer","j","aabb","sphere","mesh","detailX","detailY","W","H","cubeData","pickOctant","w","h","cd","vertex","tri","flip","fix","detail","octant","scale","json","hit","other","axisX","axisY","axisZ","minX","maxX","minY","maxY","ray0","ray1","origin","ray","min","max","tMin","tMax","t1","t2","tNear","tFar","epsilon","center","radius","discriminant","ab","ac","toHit","dot00","dot01","dot02","dot11","dot12","divide","regexMap","regex","text","LIGHTGL_PREFIX","vertexSource","fragmentSource","followScriptTagById","id","header","vertexHeader","fragmentHeader","source","usedMatrices","groups","capitalLetters","replaced","match","compileSource","shader","isSampler","isArray","str","isNumber","uniforms","location","value","vertexBuffers","used","MVM","PM","MVMI","PMI","MVPM","matrices","length","width","height","magFilter","minFilter","framebuffer","renderbuffer","checkerboardCanvas","unit","temp","image","url","theta","phi","fraction","Video","path","shaderProgram","vsSource","fsSource","vertexShader","fragmentShader","level","internalFormat","border","srcFormat","srcType","pixel","video","playing","timeupdate","checkReady","this_","draw"],"mappings":"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EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAC5IQ,EAAE,CAAC,EAAIR,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EACvIQ,EAAE,CAAC,EAAI,CAACR,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAEtIQ,EAAE,CAAC,EAAI,CAACR,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAC5IQ,EAAE,CAAC,EAAIR,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAC3IQ,EAAE,CAAC,EAAI,CAACR,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EACxIQ,EAAE,CAAC,EAAIR,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAErIQ,EAAE,CAAC,EAAIR,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,EAAIA,EAAE,EAAE,EAAIA,EAAE,CAAC,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"}