{"version":3,"file":"swimming-Chdu0NDA.js","sources":["../../swimming/lightgl.js","../../swimming/params.js","../../swimming/sphere.js","../../swimming/swimmersConstants.js","../../swimming/swimmersAttributes.js","../../swimming/swimmer.js","../../swimming/water.js","../../swimming/renderText.js","../../swimming/renderer.js","../../swimming/cubemap.js","../../swimming/video.js","../../swimming/gui.js","../../swimming/main.js"],"sourcesContent":["/*\n * lightgl.js\n * http://github.com/evanw/lightgl.js/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\nvar GL = (function () {\n\n  // src/main.js\n  // The internal `gl` variable holds the current WebGL context.\n  var gl;\n\n  var GL = {\n    // ### Initialization\n    //\n    // `GL.create()` creates a new WebGL context and augments it with more\n    // methods. The alpha channel is disabled by default because it usually causes\n    // unintended transparencies in the canvas.\n    create: function (options) {\n      options = options || {};\n      var canvas = document.createElement('canvas');\n      canvas.width = 800;\n      canvas.height = 600;\n      if (!('alpha' in options)) options.alpha = false;\n      try { gl = canvas.getContext('webgl2', options); } catch (e) { }\n      try { gl = gl || canvas.getContext('experimental-webgl', options); } catch (e) { }\n      if (!gl) throw new Error('WebGL not supported');\n      gl.HALF_FLOAT_OES = 0x8D61;\n      addMatrixStack();\n      addImmediateMode();\n      addEventListeners();\n      addOtherMethods();\n      return gl;\n    },\n\n    // `GL.keys` contains a mapping of key codes to booleans indicating whether\n    // that key is currently pressed.\n    keys: {},\n\n    // Export all external classes.\n    Matrix: Matrix,\n    Indexer: Indexer,\n    Buffer: Buffer,\n    Mesh: Mesh,\n    HitTest: HitTest,\n    Raytracer: Raytracer,\n    Shader: Shader,\n    Texture: Texture,\n    Vector: Vector\n  };\n\n  // ### Matrix stack\n  //\n  // Implement the OpenGL modelview and projection matrix stacks, along with some\n  // other useful GLU matrix functions.\n\n  function addMatrixStack() {\n    gl.MODELVIEW = ENUM | 1;\n    gl.PROJECTION = ENUM | 2;\n    var tempMatrix = new Matrix();\n    var resultMatrix = new Matrix();\n    gl.modelviewMatrix = new Matrix();\n    gl.projectionMatrix = new Matrix();\n    var modelviewStack = [];\n    var projectionStack = [];\n    var matrix, stack;\n    gl.matrixMode = function (mode) {\n      switch (mode) {\n        case gl.MODELVIEW:\n          matrix = 'modelviewMatrix';\n          stack = modelviewStack;\n          break;\n        case gl.PROJECTION:\n          matrix = 'projectionMatrix';\n          stack = projectionStack;\n          break;\n        default:\n          throw new Error('invalid matrix mode ' + mode);\n      }\n    };\n    gl.loadIdentity = function () {\n      Matrix.identity(gl[matrix]);\n    };\n    gl.loadMatrix = function (m) {\n      var from = m.m, to = gl[matrix].m;\n      for (var i = 0; i < 16; i++) {\n        to[i] = from[i];\n      }\n    };\n    gl.multMatrix = function (m) {\n      gl.loadMatrix(Matrix.multiply(gl[matrix], m, resultMatrix));\n    };\n    gl.perspective = function (fov, aspect, near, far) {\n      gl.multMatrix(Matrix.perspective(fov, aspect, near, far, tempMatrix));\n    };\n    gl.frustum = function (l, r, b, t, n, f) {\n      gl.multMatrix(Matrix.frustum(l, r, b, t, n, f, tempMatrix));\n    };\n    gl.ortho = function (l, r, b, t, n, f) {\n      gl.multMatrix(Matrix.ortho(l, r, b, t, n, f, tempMatrix));\n    };\n    gl.scale = function (x, y, z) {\n      gl.multMatrix(Matrix.scale(x, y, z, tempMatrix));\n    };\n    gl.translate = function (x, y, z) {\n      gl.multMatrix(Matrix.translate(x, y, z, tempMatrix));\n    };\n    gl.rotate = function (a, x, y, z) {\n      gl.multMatrix(Matrix.rotate(a, x, y, z, tempMatrix));\n    };\n    gl.lookAt = function (ex, ey, ez, cx, cy, cz, ux, uy, uz) {\n      gl.multMatrix(Matrix.lookAt(ex, ey, ez, cx, cy, cz, ux, uy, uz, tempMatrix));\n    };\n    gl.pushMatrix = function () {\n      stack.push(Array.prototype.slice.call(gl[matrix].m));\n    };\n    gl.popMatrix = function () {\n      var m = stack.pop();\n      gl[matrix].m = hasFloat32Array ? new Float32Array(m) : m;\n    };\n    gl.project = function (objX, objY, objZ, modelview, projection, viewport) {\n      modelview = modelview || gl.modelviewMatrix;\n      projection = projection || gl.projectionMatrix;\n      viewport = viewport || gl.getParameter(gl.VIEWPORT);\n      var point = projection.transformPoint(modelview.transformPoint(new Vector(objX, objY, objZ)));\n      return new Vector(\n        viewport[0] + viewport[2] * (point.x * 0.5 + 0.5),\n        viewport[1] + viewport[3] * (point.y * 0.5 + 0.5),\n        point.z * 0.5 + 0.5\n      );\n    };\n    gl.unProject = function (winX, winY, winZ, modelview, projection, viewport) {\n      modelview = modelview || gl.modelviewMatrix;\n      projection = projection || gl.projectionMatrix;\n      viewport = viewport || gl.getParameter(gl.VIEWPORT);\n      var point = new Vector(\n        (winX - viewport[0]) / viewport[2] * 2 - 1,\n        (winY - viewport[1]) / viewport[3] * 2 - 1,\n        winZ * 2 - 1\n      );\n      return Matrix.inverse(Matrix.multiply(projection, modelview, tempMatrix), resultMatrix).transformPoint(point);\n    };\n    gl.matrixMode(gl.MODELVIEW);\n  }\n\n  // ### Immediate mode\n  //\n  // Provide an implementation of OpenGL's deprecated immediate mode. This is\n  // depricated for a reason: constantly re-specifying the geometry is a bad\n  // idea for performance. You should use a `GL.Mesh` instead, which specifies\n  // the geometry once and caches it on the graphics card. Still, nothing\n  // beats a quick `gl.begin(gl.POINTS); gl.vertex(1, 2, 3); gl.end();` for\n  // debugging. This intentionally doesn't implement fixed-function lighting\n  // because it's only meant for quick debugging tasks.\n\n  function addImmediateMode() {\n    var immediateMode = {\n      mesh: new Mesh({ coords: true, colors: true, triangles: false }),\n      mode: -1,\n      coord: [0, 0, 0, 0],\n      color: [1, 1, 1, 1],\n      pointSize: 1,\n      shader: new Shader('\\\n      uniform float pointSize;\\\n      out vec4 color;\\\n      out vec4 coord;\\\n      void main() {\\\n        color = gl_Color;\\\n        coord = gl_TexCoord;\\\n        gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\\\n        gl_PointSize = pointSize;\\\n      }\\\n    ', '\\\n      uniform sampler2D tex;\\\n      uniform float pointSize;\\\n      uniform bool useTexture;\\\n      in vec4 color;\\\n      in vec4 coord;\\\n      out vec4 fragColor;\\\n      void main() {\\\n        fragColor = color;\\\n        if (useTexture) fragColor *= texture(tex, coord.xy);\\\n      }\\\n    ')\n    };\n    gl.pointSize = function (pointSize) {\n      immediateMode.shader.uniforms({ pointSize: pointSize });\n    };\n    gl.begin = function (mode) {\n      if (immediateMode.mode != -1) throw new Error('mismatched gl.begin() and gl.end() calls');\n      immediateMode.mode = mode;\n      immediateMode.mesh.colors = [];\n      immediateMode.mesh.coords = [];\n      immediateMode.mesh.vertices = [];\n    };\n    gl.color = function (r, g, b, a) {\n      immediateMode.color = (arguments.length == 1) ? r.toArray().concat(1) : [r, g, b, a || 1];\n    };\n    gl.texCoord = function (s, t) {\n      immediateMode.coord = (arguments.length == 1) ? s.toArray(2) : [s, t];\n    };\n    gl.vertex = function (x, y, z) {\n      immediateMode.mesh.colors.push(immediateMode.color);\n      immediateMode.mesh.coords.push(immediateMode.coord);\n      immediateMode.mesh.vertices.push(arguments.length == 1 ? x.toArray() : [x, y, z]);\n    };\n    gl.end = function () {\n      if (immediateMode.mode == -1) throw new Error('mismatched gl.begin() and gl.end() calls');\n      immediateMode.mesh.compile();\n      immediateMode.shader.uniforms({\n        useTexture: !!gl.getParameter(gl.TEXTURE_BINDING_2D)\n      }).draw(immediateMode.mesh, immediateMode.mode);\n      immediateMode.mode = -1;\n    };\n  }\n\n  // ### Improved mouse events\n  //\n  // This adds event listeners on the `gl.canvas` element that call\n  // `gl.onmousedown()`, `gl.onmousemove()`, and `gl.onmouseup()` with an\n  // augmented event object. The event object also has the properties `x`, `y`,\n  // `deltaX`, `deltaY`, and `dragging`.\n  function addEventListeners() {\n    var context = gl, oldX = 0, oldY = 0, buttons = {}, hasOld = false;\n    var has = Object.prototype.hasOwnProperty;\n    function isDragging() {\n      for (var b in buttons) {\n        if (has.call(buttons, b) && buttons[b]) return true;\n      }\n      return false;\n    }\n    function augment(original) {\n      // Make a copy of original, a native `MouseEvent`, so we can overwrite\n      // WebKit's non-standard read-only `x` and `y` properties (which are just\n      // duplicates of `pageX` and `pageY`). We can't just use\n      // `Object.create(original)` because some `MouseEvent` functions must be\n      // called in the context of the original event object.\n      var e = {};\n      for (var name in original) {\n        if (typeof original[name] == 'function') {\n          e[name] = (function (callback) {\n            return function () {\n              callback.apply(original, arguments);\n            };\n          })(original[name]);\n        } else {\n          e[name] = original[name];\n        }\n      }\n      e.original = original;\n      e.x = e.pageX;\n      e.y = e.pageY;\n      for (var obj = gl.canvas; obj; obj = obj.offsetParent) {\n        e.x -= obj.offsetLeft;\n        e.y -= obj.offsetTop;\n      }\n      if (hasOld) {\n        e.deltaX = e.x - oldX;\n        e.deltaY = e.y - oldY;\n      } else {\n        e.deltaX = 0;\n        e.deltaY = 0;\n        hasOld = true;\n      }\n      oldX = e.x;\n      oldY = e.y;\n      e.dragging = isDragging();\n      e.preventDefault = function () {\n        e.original.preventDefault();\n      };\n      e.stopPropagation = function () {\n        e.original.stopPropagation();\n      };\n      return e;\n    }\n    function mousedown(e) {\n      gl = context;\n      if (!isDragging()) {\n        // Expand the event handlers to the document to handle dragging off canvas.\n        on(document, 'mousemove', mousemove);\n        on(document, 'mouseup', mouseup);\n        off(gl.canvas, 'mousemove', mousemove);\n        off(gl.canvas, 'mouseup', mouseup);\n      }\n      buttons[e.which] = true;\n      e = augment(e);\n      if (gl.onmousedown) gl.onmousedown(e);\n      e.preventDefault();\n    }\n    function mousemove(e) {\n      gl = context;\n      e = augment(e);\n      if (gl.onmousemove) gl.onmousemove(e);\n      e.preventDefault();\n    }\n    function mouseup(e) {\n      gl = context;\n      buttons[e.which] = false;\n      if (!isDragging()) {\n        // Shrink the event handlers back to the canvas when dragging ends.\n        off(document, 'mousemove', mousemove);\n        off(document, 'mouseup', mouseup);\n        on(gl.canvas, 'mousemove', mousemove);\n        on(gl.canvas, 'mouseup', mouseup);\n      }\n      e = augment(e);\n      if (gl.onmouseup) gl.onmouseup(e);\n      e.preventDefault();\n    }\n    function reset() {\n      hasOld = false;\n    }\n    function resetAll() {\n      buttons = {};\n      hasOld = false;\n    }\n    on(gl.canvas, 'mousedown', mousedown);\n    on(gl.canvas, 'mousemove', mousemove);\n    on(gl.canvas, 'mouseup', mouseup);\n    on(gl.canvas, 'mouseover', reset);\n    on(gl.canvas, 'mouseout', reset);\n    on(document, 'contextmenu', resetAll);\n  }\n\n  // ### Automatic keyboard state\n  //\n  // The current keyboard state is stored in `GL.keys`, a map of integer key\n  // codes to booleans indicating whether that key is currently pressed. Certain\n  // keys also have named identifiers that can be used directly, such as\n  // `GL.keys.SPACE`. Values in `GL.keys` are initially undefined until that\n  // key is pressed for the first time. If you need a boolean value, you can\n  // cast the value to boolean by applying the not operator twice (as in\n  // `!!GL.keys.SPACE`).\n\n  function mapKeyCode(code) {\n    var named = {\n      8: 'BACKSPACE',\n      9: 'TAB',\n      13: 'ENTER',\n      16: 'SHIFT',\n      27: 'ESCAPE',\n      32: 'SPACE',\n      37: 'LEFT',\n      38: 'UP',\n      39: 'RIGHT',\n      40: 'DOWN'\n    };\n    return named[code] || (code >= 65 && code <= 90 ? String.fromCharCode(code) : null);\n  }\n\n  function on(element, name, callback) {\n    element.addEventListener(name, callback);\n  }\n\n  function off(element, name, callback) {\n    element.removeEventListener(name, callback);\n  }\n\n  on(document, 'keydown', function (e) {\n    if (!e.altKey && !e.ctrlKey && !e.metaKey) {\n      var key = mapKeyCode(e.keyCode);\n      if (key) GL.keys[key] = true;\n      GL.keys[e.keyCode] = true;\n    }\n  });\n\n  on(document, 'keyup', function (e) {\n    if (!e.altKey && !e.ctrlKey && !e.metaKey) {\n      var key = mapKeyCode(e.keyCode);\n      if (key) GL.keys[key] = false;\n      GL.keys[e.keyCode] = false;\n    }\n  });\n\n  function addOtherMethods() {\n    // ### Multiple contexts\n    //\n    // When using multiple contexts in one web page, `gl.makeCurrent()` must be\n    // called before issuing commands to a different context.\n    (function (context) {\n      gl.makeCurrent = function () {\n        gl = context;\n      };\n    })(gl);\n\n    // ### Animation\n    //\n    // Call `gl.animate()` to provide an animation loop that repeatedly calls\n    // `gl.onupdate()` and `gl.ondraw()`.\n    gl.animate = function () {\n      var post =\n        window.requestAnimationFrame ||\n        window.mozRequestAnimationFrame ||\n        window.webkitRequestAnimationFrame ||\n        function (callback) { setTimeout(callback, 1000 / 60); };\n      var time = new Date().getTime();\n      var context = gl;\n      function update() {\n        gl = context;\n        var now = new Date().getTime();\n        if (gl.onupdate) gl.onupdate((now - time) / 1000);\n        if (gl.ondraw) gl.ondraw();\n        post(update);\n        time = now;\n      }\n      update();\n    };\n\n    // ### Fullscreen\n    //\n    // Provide an easy way to get a fullscreen app running, including an\n    // automatic 3D perspective projection matrix by default. This should be\n    // called once.\n    //\n    // Just fullscreen, no automatic camera:\n    //\n    //     gl.fullscreen({ camera: false });\n    //\n    // Adjusting field of view, near plane distance, and far plane distance:\n    //\n    //     gl.fullscreen({ fov: 45, near: 0.1, far: 1000 });\n    //\n    // Adding padding from the edge of the window:\n    //\n    //     gl.fullscreen({ paddingLeft: 250, paddingBottom: 60 });\n    //\n    gl.fullscreen = function (options) {\n      options = options || {};\n      var top = options.paddingTop || 0;\n      var left = options.paddingLeft || 0;\n      var right = options.paddingRight || 0;\n      var bottom = options.paddingBottom || 0;\n      if (!document.body) {\n        throw new Error('document.body doesn\\'t exist yet (call gl.fullscreen() from ' +\n          'window.onload() or from inside the <body> tag)');\n      }\n      document.body.appendChild(gl.canvas);\n      document.body.style.overflow = 'hidden';\n      gl.canvas.style.position = 'absolute';\n      gl.canvas.style.left = left + 'px';\n      gl.canvas.style.top = top + 'px';\n      function resize() {\n        gl.canvas.width = window.innerWidth - left - right;\n        gl.canvas.height = window.innerHeight - top - bottom;\n        gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n        if (options.camera || !('camera' in options)) {\n          gl.matrixMode(gl.PROJECTION);\n          gl.loadIdentity();\n          gl.perspective(options.fov || 45, gl.canvas.width / gl.canvas.height,\n            options.near || 0.1, options.far || 1000);\n          gl.matrixMode(gl.MODELVIEW);\n        }\n        if (gl.ondraw) gl.ondraw();\n      }\n      on(window, 'resize', resize);\n      resize();\n    };\n  }\n\n  // A value to bitwise-or with new enums to make them distinguishable from the\n  // standard WebGL enums.\n  var ENUM = 0x12340000;\n\n  // src/matrix.js\n  // Represents a 4x4 matrix stored in row-major order that uses Float32Arrays\n  // when available. Matrix operations can either be done using convenient\n  // methods that return a new matrix for the result or optimized methods\n  // that store the result in an existing matrix to avoid generating garbage.\n\n  var hasFloat32Array = (typeof Float32Array != 'undefined');\n\n  // ### new GL.Matrix([elements])\n  //\n  // This constructor takes 16 arguments in row-major order, which can be passed\n  // individually, as a list, or even as four lists, one for each row. If the\n  // arguments are omitted then the identity matrix is constructed instead.\n  function Matrix() {\n    var m = Array.prototype.concat.apply([], arguments);\n    if (!m.length) {\n      m = [\n        1, 0, 0, 0,\n        0, 1, 0, 0,\n        0, 0, 1, 0,\n        0, 0, 0, 1\n      ];\n    }\n    this.m = hasFloat32Array ? new Float32Array(m) : m;\n  }\n\n  Matrix.prototype = {\n    // ### .inverse()\n    //\n    // Returns the matrix that when multiplied with this matrix results in the\n    // identity matrix.\n    inverse: function () {\n      return Matrix.inverse(this, new Matrix());\n    },\n\n    // ### .transpose()\n    //\n    // Returns this matrix, exchanging columns for rows.\n    transpose: function () {\n      return Matrix.transpose(this, new Matrix());\n    },\n\n    // ### .multiply(matrix)\n    //\n    // Returns the concatenation of the transforms for this matrix and `matrix`.\n    // This emulates the OpenGL function `glMultMatrix()`.\n    multiply: function (matrix) {\n      return Matrix.multiply(this, matrix, new Matrix());\n    },\n\n    // ### .transformPoint(point)\n    //\n    // Transforms the vector as a point with a w coordinate of 1. This\n    // means translations will have an effect, for example.\n    transformPoint: function (v) {\n      var m = this.m;\n      return new Vector(\n        m[0] * v.x + m[1] * v.y + m[2] * v.z + m[3],\n        m[4] * v.x + m[5] * v.y + m[6] * v.z + m[7],\n        m[8] * v.x + m[9] * v.y + m[10] * v.z + m[11]\n      ).divide(m[12] * v.x + m[13] * v.y + m[14] * v.z + m[15]);\n    },\n\n    // ### .transformPoint(vector)\n    //\n    // Transforms the vector as a vector with a w coordinate of 0. This\n    // means translations will have no effect, for example.\n    transformVector: function (v) {\n      var m = this.m;\n      return new Vector(\n        m[0] * v.x + m[1] * v.y + m[2] * v.z,\n        m[4] * v.x + m[5] * v.y + m[6] * v.z,\n        m[8] * v.x + m[9] * v.y + m[10] * v.z\n      );\n    }\n  };\n\n  // ### GL.Matrix.inverse(matrix[, result])\n  //\n  // Returns the matrix that when multiplied with `matrix` results in the\n  // identity matrix. You can optionally pass an existing matrix in `result`\n  // to avoid allocating a new matrix. This implementation is from the Mesa\n  // OpenGL function `__gluInvertMatrixd()` found in `project.c`.\n  Matrix.inverse = function (matrix, result) {\n    result = result || new Matrix();\n    var m = matrix.m, r = result.m;\n\n    r[0] = m[5] * m[10] * m[15] - m[5] * m[14] * m[11] - m[6] * m[9] * m[15] + m[6] * m[13] * m[11] + m[7] * m[9] * m[14] - m[7] * m[13] * m[10];\n    r[1] = -m[1] * m[10] * m[15] + m[1] * m[14] * m[11] + m[2] * m[9] * m[15] - m[2] * m[13] * m[11] - m[3] * m[9] * m[14] + m[3] * m[13] * m[10];\n    r[2] = m[1] * m[6] * m[15] - m[1] * m[14] * m[7] - m[2] * m[5] * m[15] + m[2] * m[13] * m[7] + m[3] * m[5] * m[14] - m[3] * m[13] * m[6];\n    r[3] = -m[1] * m[6] * m[11] + m[1] * m[10] * m[7] + m[2] * m[5] * m[11] - m[2] * m[9] * m[7] - m[3] * m[5] * m[10] + m[3] * m[9] * m[6];\n\n    r[4] = -m[4] * m[10] * m[15] + m[4] * m[14] * m[11] + m[6] * m[8] * m[15] - m[6] * m[12] * m[11] - m[7] * m[8] * m[14] + m[7] * m[12] * m[10];\n    r[5] = m[0] * m[10] * m[15] - m[0] * m[14] * m[11] - m[2] * m[8] * m[15] + m[2] * m[12] * m[11] + m[3] * m[8] * m[14] - m[3] * m[12] * m[10];\n    r[6] = -m[0] * m[6] * m[15] + m[0] * m[14] * m[7] + m[2] * m[4] * m[15] - m[2] * m[12] * m[7] - m[3] * m[4] * m[14] + m[3] * m[12] * m[6];\n    r[7] = m[0] * m[6] * m[11] - m[0] * m[10] * m[7] - m[2] * m[4] * m[11] + m[2] * m[8] * m[7] + m[3] * m[4] * m[10] - m[3] * m[8] * m[6];\n\n    r[8] = m[4] * m[9] * m[15] - m[4] * m[13] * m[11] - m[5] * m[8] * m[15] + m[5] * m[12] * m[11] + m[7] * m[8] * m[13] - m[7] * m[12] * m[9];\n    r[9] = -m[0] * m[9] * m[15] + m[0] * m[13] * m[11] + m[1] * m[8] * m[15] - m[1] * m[12] * m[11] - m[3] * m[8] * m[13] + m[3] * m[12] * m[9];\n    r[10] = m[0] * m[5] * m[15] - m[0] * m[13] * m[7] - m[1] * m[4] * m[15] + m[1] * m[12] * m[7] + m[3] * m[4] * m[13] - m[3] * m[12] * m[5];\n    r[11] = -m[0] * m[5] * m[11] + m[0] * m[9] * m[7] + m[1] * m[4] * m[11] - m[1] * m[8] * m[7] - m[3] * m[4] * m[9] + m[3] * m[8] * m[5];\n\n    r[12] = -m[4] * m[9] * m[14] + m[4] * m[13] * m[10] + m[5] * m[8] * m[14] - m[5] * m[12] * m[10] - m[6] * m[8] * m[13] + m[6] * m[12] * m[9];\n    r[13] = m[0] * m[9] * m[14] - m[0] * m[13] * m[10] - m[1] * m[8] * m[14] + m[1] * m[12] * m[10] + m[2] * m[8] * m[13] - m[2] * m[12] * m[9];\n    r[14] = -m[0] * m[5] * m[14] + m[0] * m[13] * m[6] + m[1] * m[4] * m[14] - m[1] * m[12] * m[6] - m[2] * m[4] * m[13] + m[2] * m[12] * m[5];\n    r[15] = m[0] * m[5] * m[10] - m[0] * m[9] * m[6] - m[1] * m[4] * m[10] + m[1] * m[8] * m[6] + m[2] * m[4] * m[9] - m[2] * m[8] * m[5];\n\n    var det = m[0] * r[0] + m[1] * r[4] + m[2] * r[8] + m[3] * r[12];\n    for (var i = 0; i < 16; i++) r[i] /= det;\n    return result;\n  };\n\n  // ### GL.Matrix.transpose(matrix[, result])\n  //\n  // Returns `matrix`, exchanging columns for rows. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.transpose = function (matrix, result) {\n    result = result || new Matrix();\n    var m = matrix.m, r = result.m;\n    r[0] = m[0]; r[1] = m[4]; r[2] = m[8]; r[3] = m[12];\n    r[4] = m[1]; r[5] = m[5]; r[6] = m[9]; r[7] = m[13];\n    r[8] = m[2]; r[9] = m[6]; r[10] = m[10]; r[11] = m[14];\n    r[12] = m[3]; r[13] = m[7]; r[14] = m[11]; r[15] = m[15];\n    return result;\n  };\n\n  // ### GL.Matrix.multiply(left, right[, result])\n  //\n  // Returns the concatenation of the transforms for `left` and `right`. You can\n  // optionally pass an existing matrix in `result` to avoid allocating a new\n  // matrix. This emulates the OpenGL function `glMultMatrix()`.\n  Matrix.multiply = function (left, right, result) {\n    result = result || new Matrix();\n    var a = left.m, b = right.m, r = result.m;\n\n    r[0] = a[0] * b[0] + a[1] * b[4] + a[2] * b[8] + a[3] * b[12];\n    r[1] = a[0] * b[1] + a[1] * b[5] + a[2] * b[9] + a[3] * b[13];\n    r[2] = a[0] * b[2] + a[1] * b[6] + a[2] * b[10] + a[3] * b[14];\n    r[3] = a[0] * b[3] + a[1] * b[7] + a[2] * b[11] + a[3] * b[15];\n\n    r[4] = a[4] * b[0] + a[5] * b[4] + a[6] * b[8] + a[7] * b[12];\n    r[5] = a[4] * b[1] + a[5] * b[5] + a[6] * b[9] + a[7] * b[13];\n    r[6] = a[4] * b[2] + a[5] * b[6] + a[6] * b[10] + a[7] * b[14];\n    r[7] = a[4] * b[3] + a[5] * b[7] + a[6] * b[11] + a[7] * b[15];\n\n    r[8] = a[8] * b[0] + a[9] * b[4] + a[10] * b[8] + a[11] * b[12];\n    r[9] = a[8] * b[1] + a[9] * b[5] + a[10] * b[9] + a[11] * b[13];\n    r[10] = a[8] * b[2] + a[9] * b[6] + a[10] * b[10] + a[11] * b[14];\n    r[11] = a[8] * b[3] + a[9] * b[7] + a[10] * b[11] + a[11] * b[15];\n\n    r[12] = a[12] * b[0] + a[13] * b[4] + a[14] * b[8] + a[15] * b[12];\n    r[13] = a[12] * b[1] + a[13] * b[5] + a[14] * b[9] + a[15] * b[13];\n    r[14] = a[12] * b[2] + a[13] * b[6] + a[14] * b[10] + a[15] * b[14];\n    r[15] = a[12] * b[3] + a[13] * b[7] + a[14] * b[11] + a[15] * b[15];\n\n    return result;\n  };\n\n  // ### GL.Matrix.identity([result])\n  //\n  // Returns an identity matrix. You can optionally pass an existing matrix in\n  // `result` to avoid allocating a new matrix. This emulates the OpenGL function\n  // `glLoadIdentity()`.\n  Matrix.identity = function (result) {\n    result = result || new Matrix();\n    var m = result.m;\n    m[0] = m[5] = m[10] = m[15] = 1;\n    m[1] = m[2] = m[3] = m[4] = m[6] = m[7] = m[8] = m[9] = m[11] = m[12] = m[13] = m[14] = 0;\n    return result;\n  };\n\n  // ### GL.Matrix.perspective(fov, aspect, near, far[, result])\n  //\n  // Returns a perspective transform matrix, which makes far away objects appear\n  // smaller than nearby objects. The `aspect` argument should be the width\n  // divided by the height of your viewport and `fov` is the top-to-bottom angle\n  // of the field of view in degrees. You can optionally pass an existing matrix\n  // in `result` to avoid allocating a new matrix. This emulates the OpenGL\n  // function `gluPerspective()`.\n  Matrix.perspective = function (fov, aspect, near, far, result) {\n    var y = Math.tan(fov * Math.PI / 360) * near;\n    var x = y * aspect;\n    return Matrix.frustum(-x, x, -y, y, near, far, result);\n  };\n\n  // ### GL.Matrix.frustum(left, right, bottom, top, near, far[, result])\n  //\n  // Sets up a viewing frustum, which is shaped like a truncated pyramid with the\n  // camera where the point of the pyramid would be. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix. This emulates\n  // the OpenGL function `glFrustum()`.\n  Matrix.frustum = function (l, r, b, t, n, f, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 2 * n / (r - l);\n    m[1] = 0;\n    m[2] = (r + l) / (r - l);\n    m[3] = 0;\n\n    m[4] = 0;\n    m[5] = 2 * n / (t - b);\n    m[6] = (t + b) / (t - b);\n    m[7] = 0;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = -(f + n) / (f - n);\n    m[11] = -2 * f * n / (f - n);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = -1;\n    m[15] = 0;\n\n    return result;\n  };\n\n  // ### GL.Matrix.ortho(left, right, bottom, top, near, far[, result])\n  //\n  // Returns an orthographic projection, in which objects are the same size no\n  // matter how far away or nearby they are. You can optionally pass an existing\n  // matrix in `result` to avoid allocating a new matrix. This emulates the OpenGL\n  // function `glOrtho()`.\n  Matrix.ortho = function (l, r, b, t, n, f, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 2 / (r - l);\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = -(r + l) / (r - l);\n\n    m[4] = 0;\n    m[5] = 2 / (t - b);\n    m[6] = 0;\n    m[7] = -(t + b) / (t - b);\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = -2 / (f - n);\n    m[11] = -(f + n) / (f - n);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.scale(x, y, z[, result])\n  //\n  // This emulates the OpenGL function `glScale()`. You can optionally pass an\n  // existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.scale = function (x, y, z, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = x;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = 0;\n\n    m[4] = 0;\n    m[5] = y;\n    m[6] = 0;\n    m[7] = 0;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = z;\n    m[11] = 0;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.translate(x, y, z[, result])\n  //\n  // This emulates the OpenGL function `glTranslate()`. You can optionally pass\n  // an existing matrix in `result` to avoid allocating a new matrix.\n  Matrix.translate = function (x, y, z, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    m[0] = 1;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = x;\n\n    m[4] = 0;\n    m[5] = 1;\n    m[6] = 0;\n    m[7] = y;\n\n    m[8] = 0;\n    m[9] = 0;\n    m[10] = 1;\n    m[11] = z;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.rotate(a, x, y, z[, result])\n  //\n  // Returns a matrix that rotates by `a` degrees around the vector `x, y, z`.\n  // You can optionally pass an existing matrix in `result` to avoid allocating\n  // a new matrix. This emulates the OpenGL function `glRotate()`.\n  Matrix.rotate = function (a, x, y, z, result) {\n    if (!a || (!x && !y && !z)) {\n      return Matrix.identity(result);\n    }\n\n    result = result || new Matrix();\n    var m = result.m;\n\n    var d = Math.sqrt(x * x + y * y + z * z);\n    a *= Math.PI / 180; x /= d; y /= d; z /= d;\n    var c = Math.cos(a), s = Math.sin(a), t = 1 - c;\n\n    m[0] = x * x * t + c;\n    m[1] = x * y * t - z * s;\n    m[2] = x * z * t + y * s;\n    m[3] = 0;\n\n    m[4] = y * x * t + z * s;\n    m[5] = y * y * t + c;\n    m[6] = y * z * t - x * s;\n    m[7] = 0;\n\n    m[8] = z * x * t - y * s;\n    m[9] = z * y * t + x * s;\n    m[10] = z * z * t + c;\n    m[11] = 0;\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // ### GL.Matrix.lookAt(ex, ey, ez, cx, cy, cz, ux, uy, uz[, result])\n  //\n  // Returns a matrix that puts the camera at the eye point `ex, ey, ez` looking\n  // toward the center point `cx, cy, cz` with an up direction of `ux, uy, uz`.\n  // You can optionally pass an existing matrix in `result` to avoid allocating\n  // a new matrix. This emulates the OpenGL function `gluLookAt()`.\n  Matrix.lookAt = function (ex, ey, ez, cx, cy, cz, ux, uy, uz, result) {\n    result = result || new Matrix();\n    var m = result.m;\n\n    var e = new Vector(ex, ey, ez);\n    var c = new Vector(cx, cy, cz);\n    var u = new Vector(ux, uy, uz);\n    var f = e.subtract(c).unit();\n    var s = u.cross(f).unit();\n    var t = f.cross(s).unit();\n\n    m[0] = s.x;\n    m[1] = s.y;\n    m[2] = s.z;\n    m[3] = -s.dot(e);\n\n    m[4] = t.x;\n    m[5] = t.y;\n    m[6] = t.z;\n    m[7] = -t.dot(e);\n\n    m[8] = f.x;\n    m[9] = f.y;\n    m[10] = f.z;\n    m[11] = -f.dot(e);\n\n    m[12] = 0;\n    m[13] = 0;\n    m[14] = 0;\n    m[15] = 1;\n\n    return result;\n  };\n\n  // src/mesh.js\n  // Represents indexed triangle geometry with arbitrary additional attributes.\n  // You need a shader to draw a mesh; meshes can't draw themselves.\n  //\n  // A mesh is a collection of `GL.Buffer` objects which are either vertex buffers\n  // (holding per-vertex attributes) or index buffers (holding the order in which\n  // vertices are rendered). By default, a mesh has a position vertex buffer called\n  // `vertices` and a triangle index buffer called `triangles`. New buffers can be\n  // added using `addVertexBuffer()` and `addIndexBuffer()`. Two strings are\n  // required when adding a new vertex buffer, the name of the data array on the\n  // mesh instance and the name of the GLSL attribute in the vertex shader.\n  //\n  // Example usage:\n  //\n  //     var mesh = new GL.Mesh({ coords: true, lines: true });\n  //\n  //     // Default attribute \"vertices\", available as \"gl_Vertex\" in\n  //     // the vertex shader\n  //     mesh.vertices = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]];\n  //\n  //     // Optional attribute \"coords\" enabled in constructor,\n  //     // available as \"gl_TexCoord\" in the vertex shader\n  //     mesh.coords = [[0, 0], [1, 0], [0, 1], [1, 1]];\n  //\n  //     // Custom attribute \"weights\", available as \"weight\" in the\n  //     // vertex shader\n  //     mesh.addVertexBuffer('weights', 'weight');\n  //     mesh.weights = [1, 0, 0, 1];\n  //\n  //     // Default index buffer \"triangles\"\n  //     mesh.triangles = [[0, 1, 2], [2, 1, 3]];\n  //\n  //     // Optional index buffer \"lines\" enabled in constructor\n  //     mesh.lines = [[0, 1], [0, 2], [1, 3], [2, 3]];\n  //\n  //     // Upload provided data to GPU memory\n  //     mesh.compile();\n\n  // ### new GL.Indexer()\n  //\n  // Generates indices into a list of unique objects from a stream of objects\n  // that may contain duplicates. This is useful for generating compact indexed\n  // meshes from unindexed data.\n  function Indexer() {\n    this.unique = [];\n    this.indices = [];\n    this.map = {};\n  }\n\n  Indexer.prototype = {\n    // ### .add(v)\n    //\n    // Adds the object `obj` to `unique` if it hasn't already been added. Returns\n    // the index of `obj` in `unique`.\n    add: function (obj) {\n      var key = JSON.stringify(obj);\n      if (!(key in this.map)) {\n        this.map[key] = this.unique.length;\n        this.unique.push(obj);\n      }\n      return this.map[key];\n    }\n  };\n\n  // ### new GL.Buffer(target, type)\n  //\n  // Provides a simple method of uploading data to a GPU buffer. Example usage:\n  //\n  //     var vertices = new GL.Buffer(gl.ARRAY_BUFFER, Float32Array);\n  //     var indices = new GL.Buffer(gl.ELEMENT_ARRAY_BUFFER, Uint16Array);\n  //     vertices.data = [[0, 0, 0], [1, 0, 0], [0, 1, 0], [1, 1, 0]];\n  //     indices.data = [[0, 1, 2], [2, 1, 3]];\n  //     vertices.compile();\n  //     indices.compile();\n  //\n  function Buffer(target, type) {\n    this.buffer = null;\n    this.target = target;\n    this.type = type;\n    this.data = [];\n  }\n\n  Buffer.prototype = {\n    // ### .compile(type)\n    //\n    // Upload the contents of `data` to the GPU in preparation for rendering. The\n    // data must be a list of lists where each inner list has the same length. For\n    // example, each element of data for vertex normals would be a list of length three.\n    // This will remember the data length and element length for later use by shaders.\n    // The type can be either `gl.STATIC_DRAW` or `gl.DYNAMIC_DRAW`, and defaults to\n    // `gl.STATIC_DRAW`.\n    //\n    // This could have used `[].concat.apply([], this.data)` to flatten\n    // the array but Google Chrome has a maximum number of arguments so the\n    // concatenations are chunked to avoid that limit.\n    compile: function (type) {\n      var data = [];\n      for (var i = 0, chunk = 10000; i < this.data.length; i += chunk) {\n        data = Array.prototype.concat.apply(data, this.data.slice(i, i + chunk));\n      }\n      var spacing = this.data.length ? data.length / this.data.length : 0;\n      if (spacing != Math.round(spacing)) throw new Error('buffer elements not of consistent size, average size is ' + spacing);\n      this.buffer = this.buffer || gl.createBuffer();\n      this.buffer.length = data.length;\n      this.buffer.spacing = spacing;\n      gl.bindBuffer(this.target, this.buffer);\n      gl.bufferData(this.target, new this.type(data), type || gl.STATIC_DRAW);\n    }\n  };\n\n  // ### new GL.Mesh([options])\n  //\n  // Represents a collection of vertex buffers and index buffers. Each vertex\n  // buffer maps to one attribute in GLSL and has a corresponding property set\n  // on the Mesh instance. There is one vertex buffer by default: `vertices`,\n  // which maps to `gl_Vertex`. The `coords`, `normals`, and `colors` vertex\n  // buffers map to `gl_TexCoord`, `gl_Normal`, and `gl_Color` respectively,\n  // and can be enabled by setting the corresponding options to true. There are\n  // two index buffers, `triangles` and `lines`, which are used for rendering\n  // `gl.TRIANGLES` and `gl.LINES`, respectively. Only `triangles` is enabled by\n  // default, although `computeWireframe()` will add a normal buffer if it wasn't\n  // initially enabled.\n  function Mesh(options) {\n    options = options || {};\n    this.vertexBuffers = {};\n    this.indexBuffers = {};\n    this.addVertexBuffer('vertices', 'gl_Vertex');\n    if (options.coords) this.addVertexBuffer('coords', 'gl_TexCoord');\n    if (options.normals) this.addVertexBuffer('normals', 'gl_Normal');\n    if (options.colors) this.addVertexBuffer('colors', 'gl_Color');\n    if (!('triangles' in options) || options.triangles) this.addIndexBuffer('triangles');\n    if (options.lines) this.addIndexBuffer('lines');\n  }\n\n  Mesh.prototype = {\n    // ### .addVertexBuffer(name, attribute)\n    //\n    // Add a new vertex buffer with a list as a property called `name` on this object\n    // and map it to the attribute called `attribute` in all shaders that draw this mesh.\n    addVertexBuffer: function (name, attribute) {\n      var buffer = this.vertexBuffers[attribute] = new Buffer(gl.ARRAY_BUFFER, Float32Array);\n      buffer.name = name;\n      this[name] = [];\n    },\n\n    // ### .addIndexBuffer(name)\n    //\n    // Add a new index buffer with a list as a property called `name` on this object.\n    addIndexBuffer: function (name) {\n      var buffer = this.indexBuffers[name] = new Buffer(gl.ELEMENT_ARRAY_BUFFER, Uint16Array);\n      this[name] = [];\n    },\n\n    // ### .compile()\n    //\n    // Upload all attached buffers to the GPU in preparation for rendering. This\n    // doesn't need to be called every frame, only needs to be done when the data\n    // changes.\n    compile: function () {\n      for (var attribute in this.vertexBuffers) {\n        var buffer = this.vertexBuffers[attribute];\n        buffer.data = this[buffer.name];\n        buffer.compile();\n      }\n\n      for (var name in this.indexBuffers) {\n        var buffer = this.indexBuffers[name];\n        buffer.data = this[name];\n        buffer.compile();\n      }\n    },\n\n    // ### .transform(matrix)\n    //\n    // Transform all vertices by `matrix` and all normals by the inverse transpose\n    // of `matrix`.\n    transform: function (matrix) {\n      this.vertices = this.vertices.map(function (v) {\n        return matrix.transformPoint(Vector.fromArray(v)).toArray();\n      });\n      if (this.normals) {\n        var invTrans = matrix.inverse().transpose();\n        this.normals = this.normals.map(function (n) {\n          return invTrans.transformVector(Vector.fromArray(n)).unit().toArray();\n        });\n      }\n      this.compile();\n      return this;\n    },\n\n    // ### .computeNormals()\n    //\n    // Computes a new normal for each vertex from the average normal of the\n    // neighboring triangles. This means adjacent triangles must share vertices\n    // for the resulting normals to be smooth.\n    computeNormals: function () {\n      if (!this.normals) this.addVertexBuffer('normals', 'gl_Normal');\n      for (var i = 0; i < this.vertices.length; i++) {\n        this.normals[i] = new Vector();\n      }\n      for (var i = 0; i < this.triangles.length; i++) {\n        var t = this.triangles[i];\n        var a = Vector.fromArray(this.vertices[t[0]]);\n        var b = Vector.fromArray(this.vertices[t[1]]);\n        var c = Vector.fromArray(this.vertices[t[2]]);\n        var normal = b.subtract(a).cross(c.subtract(a)).unit();\n        this.normals[t[0]] = this.normals[t[0]].add(normal);\n        this.normals[t[1]] = this.normals[t[1]].add(normal);\n        this.normals[t[2]] = this.normals[t[2]].add(normal);\n      }\n      for (var i = 0; i < this.vertices.length; i++) {\n        this.normals[i] = this.normals[i].unit().toArray();\n      }\n      this.compile();\n      return this;\n    },\n\n    // ### .computeWireframe()\n    //\n    // Populate the `lines` index buffer from the `triangles` index buffer.\n    computeWireframe: function () {\n      var indexer = new Indexer();\n      for (var i = 0; i < this.triangles.length; i++) {\n        var t = this.triangles[i];\n        for (var j = 0; j < t.length; j++) {\n          var a = t[j], b = t[(j + 1) % t.length];\n          indexer.add([Math.min(a, b), Math.max(a, b)]);\n        }\n      }\n      if (!this.lines) this.addIndexBuffer('lines');\n      this.lines = indexer.unique;\n      this.compile();\n      return this;\n    },\n\n    // ### .getAABB()\n    //\n    // Computes the axis-aligned bounding box, which is an object whose `min` and\n    // `max` properties contain the minimum and maximum coordinates of all vertices.\n    getAABB: function () {\n      var aabb = { min: new Vector(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE) };\n      aabb.max = aabb.min.negative();\n      for (var i = 0; i < this.vertices.length; i++) {\n        var v = Vector.fromArray(this.vertices[i]);\n        aabb.min = Vector.min(aabb.min, v);\n        aabb.max = Vector.max(aabb.max, v);\n      }\n      return aabb;\n    },\n\n    // ### .getBoundingSphere()\n    //\n    // Computes a sphere that contains all vertices (not necessarily the smallest\n    // sphere). The returned object has two properties, `center` and `radius`.\n    getBoundingSphere: function () {\n      var aabb = this.getAABB();\n      var sphere = { center: aabb.min.add(aabb.max).divide(2), radius: 0 };\n      for (var i = 0; i < this.vertices.length; i++) {\n        sphere.radius = Math.max(sphere.radius,\n          Vector.fromArray(this.vertices[i]).subtract(sphere.center).length());\n      }\n      return sphere;\n    }\n  };\n\n  // ### GL.Mesh.plane([options])\n  //\n  // Generates a square 2x2 mesh the xy plane centered at the origin. The\n  // `options` argument specifies options to pass to the mesh constructor.\n  // Additional options include `detailX` and `detailY`, which set the tesselation\n  // in x and y, and `detail`, which sets both `detailX` and `detailY` at once.\n  // Two triangles are generated by default.\n  // Example usage:\n  //\n  //     var mesh1 = GL.Mesh.plane();\n  //     var mesh2 = GL.Mesh.plane({ detail: 5 });\n  //     var mesh3 = GL.Mesh.plane({ detailX: 20, detailY: 40 });\n  //\n  Mesh.plane = function (options) {\n    options = options || {};\n    var mesh = new Mesh(options);\n    var detailX = options.detailX || options.detail || 1;\n    var detailY = options.detailY || options.detail || 1;\n    var W = options.width || 2;\n    var H = options.height || 2;\n\n    for (var y = 0; y <= detailY; y++) {\n      var t = y / detailY;\n      for (var x = 0; x <= detailX; x++) {\n        var s = x / detailX;\n        mesh.vertices.push([(s - 0.5) * W, (t - 0.5) * H, 0]);\n        if (mesh.coords) mesh.coords.push([s, t]);\n        if (mesh.normals) mesh.normals.push([0, 0, 1]);\n        if (x < detailX && y < detailY) {\n          var i = x + y * (detailX + 1);\n          mesh.triangles.push([i, i + 1, i + detailX + 1]);\n          mesh.triangles.push([i + detailX + 1, i + 1, i + detailX + 2]);\n        }\n      }\n    }\n\n    mesh.compile();\n    return mesh;\n  };\n\n  var cubeData = [\n    [0, 4, 2, 6, -1, 0, 0], // -x\n    [1, 3, 5, 7, +1, 0, 0], // +x\n    [0, 1, 4, 5, 0, -1, 0], // -y\n    [2, 6, 3, 7, 0, +1, 0], // +y\n    [0, 2, 1, 3, 0, 0, -1], // -z\n    [4, 5, 6, 7, 0, 0, +1]  // +z\n  ];\n\n  function pickOctant(i) {\n    return new Vector((i & 1) * 2 - 1, (i & 2) - 1, (i & 4) / 2 - 1);\n  }\n\n  // ### GL.Mesh.cube([options])\n  //\n  // Generates a 2x2x2 box centered at the origin. The `options` argument\n  // specifies options to pass to the mesh constructor.\n  Mesh.cube = function (options) {\n    var mesh = new Mesh(options);\n    var w = options && options.width || 2;\n    var h = options && options.height || 2;\n    var d = options && options.depth || 2;\n\n    for (var i = 0; i < cubeData.length; i++) {\n      var data = cubeData[i], v = i * 4;\n      for (var j = 0; j < 4; j++) {\n        var cd = data[j];\n        const vertex = pickOctant(cd).toArray();\n        vertex[0] *= w / 2;\n        vertex[1] *= h / 2;\n        vertex[2] *= d / 2;\n        mesh.vertices.push(vertex);\n        if (mesh.coords) mesh.coords.push([j & 1, (j & 2) / 2]);\n        if (mesh.normals) mesh.normals.push(data.slice(4, 7));\n      }\n      mesh.triangles.push([v, v + 1, v + 2]);\n      mesh.triangles.push([v + 2, v + 1, v + 3]);\n    }\n\n    mesh.compile();\n    return mesh;\n  };\n\n  // ### GL.Mesh.sphere([options])\n  //\n  // Generates a geodesic sphere of radius 1. The `options` argument specifies\n  // options to pass to the mesh constructor in addition to the `detail` option,\n  // which controls the tesselation level. The detail is `6` by default.\n  // Example usage:\n  //\n  //     var mesh1 = GL.Mesh.sphere();\n  //     var mesh2 = GL.Mesh.sphere({ detail: 2 });\n  //\n  Mesh.sphere = function (options) {\n    function tri(a, b, c) { return flip ? [a, c, b] : [a, b, c]; }\n    function fix(x) { return x + (x - x * x) / 2; }\n    options = options || {};\n    var mesh = new Mesh(options);\n    var indexer = new Indexer();\n    var detail = options.detail || 6;\n\n    for (var octant = 0; octant < 8; octant++) {\n      var scale = pickOctant(octant);\n      var flip = scale.x * scale.y * scale.z > 0;\n      var data = [];\n      for (var i = 0; i <= detail; i++) {\n        // Generate a row of vertices on the surface of the sphere\n        // using barycentric coordinates.\n        for (var j = 0; i + j <= detail; j++) {\n          var a = i / detail;\n          var b = j / detail;\n          var c = (detail - i - j) / detail;\n          var vertex = { vertex: new Vector(fix(a), fix(b), fix(c)).unit().multiply(scale).toArray() };\n          if (mesh.coords) vertex.coord = scale.y > 0 ? [1 - a, c] : [c, 1 - a];\n          data.push(indexer.add(vertex));\n        }\n\n        // Generate triangles from this row and the previous row.\n        if (i > 0) {\n          for (var j = 0; i + j <= detail; j++) {\n            var a = (i - 1) * (detail + 1) + ((i - 1) - (i - 1) * (i - 1)) / 2 + j;\n            var b = i * (detail + 1) + (i - i * i) / 2 + j;\n            mesh.triangles.push(tri(data[a], data[a + 1], data[b]));\n            if (i + j < detail) {\n              mesh.triangles.push(tri(data[b], data[a + 1], data[b + 1]));\n            }\n          }\n        }\n      }\n    }\n\n    // Reconstruct the geometry from the indexer.\n    mesh.vertices = indexer.unique.map(function (v) { return v.vertex; });\n    if (mesh.coords) mesh.coords = indexer.unique.map(function (v) { return v.coord; });\n    if (mesh.normals) mesh.normals = mesh.vertices;\n    mesh.compile();\n    return mesh;\n  };\n\n  // ### GL.Mesh.load(json[, options])\n  //\n  // Creates a mesh from the JSON generated by the `convert/convert.py` script.\n  // Example usage:\n  //\n  //     var data = {\n  //       vertices: [[0, 0, 0], [1, 0, 0], [0, 1, 0]],\n  //       triangles: [[0, 1, 2]]\n  //     };\n  //     var mesh = GL.Mesh.load(data);\n  //\n  Mesh.load = function (json, options) {\n    options = options || {};\n    if (!('coords' in options)) options.coords = !!json.coords;\n    if (!('normals' in options)) options.normals = !!json.normals;\n    if (!('colors' in options)) options.colors = !!json.colors;\n    if (!('triangles' in options)) options.triangles = !!json.triangles;\n    if (!('lines' in options)) options.lines = !!json.lines;\n    var mesh = new Mesh(options);\n    mesh.vertices = json.vertices;\n    if (mesh.coords) mesh.coords = json.coords;\n    if (mesh.normals) mesh.normals = json.normals;\n    if (mesh.colors) mesh.colors = json.colors;\n    if (mesh.triangles) mesh.triangles = json.triangles;\n    if (mesh.lines) mesh.lines = json.lines;\n    mesh.compile();\n    return mesh;\n  };\n\n  // src/raytracer.js\n  // Provides a convenient raytracing interface.\n\n  // ### new GL.HitTest([t, hit, normal])\n  //\n  // This is the object used to return hit test results. If there are no\n  // arguments, the constructed argument represents a hit infinitely far\n  // away.\n  function HitTest(t, hit, normal) {\n    this.t = arguments.length ? t : Number.MAX_VALUE;\n    this.hit = hit;\n    this.normal = normal;\n  }\n\n  // ### .mergeWith(other)\n  //\n  // Changes this object to be the closer of the two hit test results.\n  HitTest.prototype = {\n    mergeWith: function (other) {\n      if (other.t > 0 && other.t < this.t) {\n        this.t = other.t;\n        this.hit = other.hit;\n        this.normal = other.normal;\n      }\n    }\n  };\n\n  // ### new GL.Raytracer()\n  //\n  // This will read the current modelview matrix, projection matrix, and viewport,\n  // reconstruct the eye position, and store enough information to later generate\n  // per-pixel rays using `getRayForPixel()`.\n  //\n  // Example usage:\n  //\n  //     var tracer = new GL.Raytracer();\n  //     var ray = tracer.getRayForPixel(\n  //       gl.canvas.width / 2,\n  //       gl.canvas.height / 2);\n  //     var result = GL.Raytracer.hitTestSphere(\n  //       tracer.eye, ray, new GL.Vector(0, 0, 0), 1);\n  function Raytracer() {\n    var v = gl.getParameter(gl.VIEWPORT);\n    var m = gl.modelviewMatrix.m;\n\n    var axisX = new Vector(m[0], m[4], m[8]);\n    var axisY = new Vector(m[1], m[5], m[9]);\n    var axisZ = new Vector(m[2], m[6], m[10]);\n    var offset = new Vector(m[3], m[7], m[11]);\n    this.eye = new Vector(-offset.dot(axisX), -offset.dot(axisY), -offset.dot(axisZ));\n\n    var minX = v[0], maxX = minX + v[2];\n    var minY = v[1], maxY = minY + v[3];\n    this.ray00 = gl.unProject(minX, minY, 1).subtract(this.eye);\n    this.ray10 = gl.unProject(maxX, minY, 1).subtract(this.eye);\n    this.ray01 = gl.unProject(minX, maxY, 1).subtract(this.eye);\n    this.ray11 = gl.unProject(maxX, maxY, 1).subtract(this.eye);\n    this.viewport = v;\n  }\n\n  Raytracer.prototype = {\n    // ### .getRayForPixel(x, y)\n    //\n    // Returns the ray originating from the camera and traveling through the pixel `x, y`.\n    getRayForPixel: function (x, y) {\n      x = (x - this.viewport[0]) / this.viewport[2];\n      y = 1 - (y - this.viewport[1]) / this.viewport[3];\n      var ray0 = Vector.lerp(this.ray00, this.ray10, x);\n      var ray1 = Vector.lerp(this.ray01, this.ray11, x);\n      return Vector.lerp(ray0, ray1, y).unit();\n    }\n  };\n\n  // ### GL.Raytracer.hitTestBox(origin, ray, min, max)\n  //\n  // Traces the ray starting from `origin` along `ray` against the axis-aligned box\n  // whose coordinates extend from `min` to `max`. Returns a `HitTest` with the\n  // information or `null` for no intersection.\n  //\n  // This implementation uses the [slab intersection method](http://www.siggraph.org/education/materials/HyperGraph/raytrace/rtinter3.htm).\n  Raytracer.hitTestBox = function (origin, ray, min, max) {\n    var tMin = min.subtract(origin).divide(ray);\n    var tMax = max.subtract(origin).divide(ray);\n    var t1 = Vector.min(tMin, tMax);\n    var t2 = Vector.max(tMin, tMax);\n    var tNear = t1.max();\n    var tFar = t2.min();\n\n    if (tNear > 0 && tNear < tFar) {\n      var epsilon = 1.0e-6, hit = origin.add(ray.multiply(tNear));\n      min = min.add(epsilon);\n      max = max.subtract(epsilon);\n      return new HitTest(tNear, hit, new Vector(\n        (hit.x > max.x) - (hit.x < min.x),\n        (hit.y > max.y) - (hit.y < min.y),\n        (hit.z > max.z) - (hit.z < min.z)\n      ));\n    }\n\n    return null;\n  };\n\n  // ### GL.Raytracer.hitTestSphere(origin, ray, center, radius)\n  //\n  // Traces the ray starting from `origin` along `ray` against the sphere defined\n  // by `center` and `radius`. Returns a `HitTest` with the information or `null`\n  // for no intersection.\n  Raytracer.hitTestSphere = function (origin, ray, center, radius) {\n    var offset = origin.subtract(center);\n    var a = ray.dot(ray);\n    var b = 2 * ray.dot(offset);\n    var c = offset.dot(offset) - radius * radius;\n    var discriminant = b * b - 4 * a * c;\n\n    if (discriminant > 0) {\n      var t = (-b - Math.sqrt(discriminant)) / (2 * a), hit = origin.add(ray.multiply(t));\n      return new HitTest(t, hit, hit.subtract(center).divide(radius));\n    }\n\n    return null;\n  };\n\n  // ### GL.Raytracer.hitTestTriangle(origin, ray, a, b, c)\n  //\n  // Traces the ray starting from `origin` along `ray` against the triangle defined\n  // by the points `a`, `b`, and `c`. Returns a `HitTest` with the information or\n  // `null` for no intersection.\n  Raytracer.hitTestTriangle = function (origin, ray, a, b, c) {\n    var ab = b.subtract(a);\n    var ac = c.subtract(a);\n    var normal = ab.cross(ac).unit();\n    var t = normal.dot(a.subtract(origin)) / normal.dot(ray);\n\n    if (t > 0) {\n      var hit = origin.add(ray.multiply(t));\n      var toHit = hit.subtract(a);\n      var dot00 = ac.dot(ac);\n      var dot01 = ac.dot(ab);\n      var dot02 = ac.dot(toHit);\n      var dot11 = ab.dot(ab);\n      var dot12 = ab.dot(toHit);\n      var divide = dot00 * dot11 - dot01 * dot01;\n      var u = (dot11 * dot02 - dot01 * dot12) / divide;\n      var v = (dot00 * dot12 - dot01 * dot02) / divide;\n      if (u >= 0 && v >= 0 && u + v <= 1) return new HitTest(t, hit, normal);\n    }\n\n    return null;\n  };\n\n  // src/shader.js\n  // Provides a convenient wrapper for WebGL shaders. A few uniforms and attributes,\n  // prefixed with `gl_`, are automatically added to all shader sources to make\n  // simple shaders easier to write.\n  //\n  // Example usage:\n  //\n  //     var shader = new GL.Shader('\\\n  //       void main() {\\\n  //         gl_Position = gl_ModelViewProjectionMatrix * gl_Vertex;\\\n  //       }\\\n  //     ', '\\\n  //       uniform vec4 color;\\\n  //       void main() {\\\n  //         gl_FragColor = color;\\\n  //       }\\\n  //     ');\n  //\n  //     shader.uniforms({\n  //       color: [1, 0, 0, 1]\n  //     }).draw(mesh);\n\n  function regexMap(regex, text, callback) {\n    let result;\n    while ((result = regex.exec(text)) != null) {\n      callback(result);\n    }\n  }\n\n  // Non-standard names beginning with `gl_` must be mangled because they will\n  // otherwise cause a compiler error.\n  var LIGHTGL_PREFIX = 'LIGHTGL';\n\n  // ### new GL.Shader(vertexSource, fragmentSource)\n  //\n  // Compiles a shader program using the provided vertex and fragment shaders.\n  function Shader(vertexSource, fragmentSource) {\n    // Allow passing in the id of an HTML script tag with the source\n    function followScriptTagById(id) {\n      var element = document.getElementById(id);\n      return element ? element.text : id;\n    }\n    vertexSource = followScriptTagById(vertexSource);\n    fragmentSource = followScriptTagById(fragmentSource);\n\n    // Headers are prepended to the sources to provide some automatic functionality.\n    var header = '\\\n    uniform mat3 gl_NormalMatrix;\\\n    uniform mat4 gl_ModelViewMatrix;\\\n    uniform mat4 gl_ProjectionMatrix;\\\n    uniform mat4 gl_ModelViewProjectionMatrix;\\\n    uniform mat4 gl_ModelViewMatrixInverse;\\\n    uniform mat4 gl_ProjectionMatrixInverse;\\\n    uniform mat4 gl_ModelViewProjectionMatrixInverse;\\\n  ';\n    var vertexHeader = `#version 300 es\n    ` + header + '\\\n    in vec4 gl_Vertex;\\\n    in vec4 gl_TexCoord;\\\n    in vec3 gl_Normal;\\\n    in vec4 gl_Color;\\\n    vec4 ftransform() {\\\n      return gl_ModelViewProjectionMatrix * gl_Vertex;\\\n    }\\\n  ';\n    var fragmentHeader = `#version 300 es\n    precision highp float;\n  ` + header;\n\n    // Check for the use of built-in matrices that require expensive matrix\n    // multiplications to compute, and record these in `usedMatrices`.\n    var source = vertexSource + fragmentSource;\n    var usedMatrices = {};\n    regexMap(/\\b(gl_[^;]*)\\b;/g, header, function (groups) {\n      var name = groups[1];\n      if (source.indexOf(name) != -1) {\n        var capitalLetters = name.replace(/[a-z_]/g, '');\n        usedMatrices[capitalLetters] = LIGHTGL_PREFIX + name;\n      }\n    });\n    if (source.indexOf('ftransform') != -1) usedMatrices.MVPM = LIGHTGL_PREFIX + 'gl_ModelViewProjectionMatrix';\n    this.usedMatrices = usedMatrices;\n\n    // The `gl_` prefix must be substituted for something else to avoid compile\n    // errors, since it's a reserved prefix. This prefixes all reserved names with\n    // `_`. The header is inserted after any extensions, since those must come\n    // first.\n    function fix(header, source) {\n      var replaced = {};\n      var match = /^((\\s*\\/\\/.*\\n|\\s*#extension.*\\n)+)[^]*$/.exec(source);\n      source = match ? match[1] + header + source.substr(match[1].length) : header + source;\n      regexMap(/\\bgl_\\w+\\b/g, header, function (result) {\n        if (!(result in replaced)) {\n          source = source.replace(new RegExp('\\\\b' + result + '\\\\b', 'g'), LIGHTGL_PREFIX + result);\n          replaced[result] = true;\n        }\n      });\n      return source;\n    }\n    vertexSource = fix(vertexHeader, vertexSource);\n    fragmentSource = fix(fragmentHeader, fragmentSource);\n\n    // Compile and link errors are thrown as strings.\n    function compileSource(type, source) {\n      var shader = gl.createShader(type);\n      gl.shaderSource(shader, source);\n      gl.compileShader(shader);\n      if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        throw new Error('compile error: ' + gl.getShaderInfoLog(shader));\n      }\n      return shader;\n    }\n    this.program = gl.createProgram();\n    gl.attachShader(this.program, compileSource(gl.VERTEX_SHADER, vertexSource));\n    gl.attachShader(this.program, compileSource(gl.FRAGMENT_SHADER, fragmentSource));\n    gl.linkProgram(this.program);\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error('link error: ' + gl.getProgramInfoLog(this.program));\n    }\n    this.attributes = {};\n    this.uniformLocations = {};\n\n    // Sampler uniforms need to be uploaded using `gl.uniform1i()` instead of `gl.uniform1f()`.\n    // To do this automatically, we detect and remember all uniform samplers in the source code.\n    var isSampler = {};\n    regexMap(/uniform\\s+sampler(1D|2D|3D|Cube)\\s+(\\w+)\\s*;/g, vertexSource + fragmentSource, function (groups) {\n      isSampler[groups[2]] = 1;\n    });\n    this.isSampler = isSampler;\n  }\n\n  function isArray(obj) {\n    var str = Object.prototype.toString.call(obj);\n    return str == '[object Array]' || str == '[object Float32Array]';\n  }\n\n  function isNumber(obj) {\n    var str = Object.prototype.toString.call(obj);\n    return str == '[object Number]' || str == '[object Boolean]';\n  }\n\n  var tempMatrix = new Matrix();\n  var resultMatrix = new Matrix();\n\n  Shader.prototype = {\n    // ### .uniforms(uniforms)\n    //\n    // Set a uniform for each property of `uniforms`. The correct `gl.uniform*()` method is\n    // inferred from the value types and from the stored uniform sampler flags.\n    uniforms: function (uniforms) {\n      gl.useProgram(this.program);\n\n      for (var name in uniforms) {\n        var location = this.uniformLocations[name] || gl.getUniformLocation(this.program, name);\n        if (!location) continue;\n        this.uniformLocations[name] = location;\n        var value = uniforms[name];\n        if (value instanceof Vector) {\n          value = [value.x, value.y, value.z];\n        } else if (value instanceof Matrix) {\n          value = value.m;\n        }\n        if (isArray(value)) {\n          switch (value.length) {\n            case 1: gl.uniform1fv(location, new Float32Array(value)); break;\n            case 2: gl.uniform2fv(location, new Float32Array(value)); break;\n            case 3: gl.uniform3fv(location, new Float32Array(value)); break;\n            case 4: gl.uniform4fv(location, new Float32Array(value)); break;\n            // Matrices are automatically transposed, since WebGL uses column-major\n            // indices instead of row-major indices.\n            case 9: gl.uniformMatrix3fv(location, false, new Float32Array([\n              value[0], value[3], value[6],\n              value[1], value[4], value[7],\n              value[2], value[5], value[8]\n            ])); break;\n            case 16: gl.uniformMatrix4fv(location, false, new Float32Array([\n              value[0], value[4], value[8], value[12],\n              value[1], value[5], value[9], value[13],\n              value[2], value[6], value[10], value[14],\n              value[3], value[7], value[11], value[15]\n            ])); break;\n            default: throw new Error('don\\'t know how to load uniform \"' + name + '\" of length ' + value.length);\n          }\n        } else if (isNumber(value)) {\n          (this.isSampler[name] ? gl.uniform1i : gl.uniform1f).call(gl, location, value);\n        } else {\n          throw new Error('attempted to set uniform \"' + name + '\" to invalid value ' + value);\n        }\n      }\n\n      return this;\n    },\n\n    // ### .draw(mesh[, mode])\n    //\n    // Sets all uniform matrix attributes, binds all relevant buffers, and draws the\n    // mesh geometry as indexed triangles or indexed lines. Set `mode` to `gl.LINES`\n    // (and either add indices to `lines` or call `computeWireframe()`) to draw the\n    // mesh in wireframe.\n    draw: function (mesh, mode) {\n      this.drawBuffers(mesh.vertexBuffers,\n        mesh.indexBuffers[mode == gl.LINES ? 'lines' : 'triangles'],\n        arguments.length < 2 ? gl.TRIANGLES : mode);\n    },\n\n    // ### .drawBuffers(vertexBuffers, indexBuffer, mode)\n    //\n    // Sets all uniform matrix attributes, binds all relevant buffers, and draws the\n    // indexed mesh geometry. The `vertexBuffers` argument is a map from attribute\n    // names to `Buffer` objects of type `gl.ARRAY_BUFFER`, `indexBuffer` is a `Buffer`\n    // object of type `gl.ELEMENT_ARRAY_BUFFER`, and `mode` is a WebGL primitive mode\n    // like `gl.TRIANGLES` or `gl.LINES`. This method automatically creates and caches\n    // vertex attribute pointers for attributes as needed.\n    drawBuffers: function (vertexBuffers, indexBuffer, mode) {\n      // Only construct up the built-in matrices we need for this shader.\n      var used = this.usedMatrices;\n      var MVM = gl.modelviewMatrix;\n      var PM = gl.projectionMatrix;\n      var MVMI = (used.MVMI || used.NM) ? MVM.inverse() : null;\n      var PMI = (used.PMI) ? PM.inverse() : null;\n      var MVPM = (used.MVPM || used.MVPMI) ? PM.multiply(MVM) : null;\n      var matrices = {};\n      if (used.MVM) matrices[used.MVM] = MVM;\n      if (used.MVMI) matrices[used.MVMI] = MVMI;\n      if (used.PM) matrices[used.PM] = PM;\n      if (used.PMI) matrices[used.PMI] = PMI;\n      if (used.MVPM) matrices[used.MVPM] = MVPM;\n      if (used.MVPMI) matrices[used.MVPMI] = MVPM.inverse();\n      if (used.NM) {\n        var m = MVMI.m;\n        matrices[used.NM] = [m[0], m[4], m[8], m[1], m[5], m[9], m[2], m[6], m[10]];\n      }\n      this.uniforms(matrices);\n\n      // Create and enable attribute pointers as necessary.\n      var length = 0;\n      for (var attribute in vertexBuffers) {\n        var buffer = vertexBuffers[attribute];\n        var location = this.attributes[attribute] ||\n          gl.getAttribLocation(this.program, attribute.replace(/^(gl_.*)$/, LIGHTGL_PREFIX + '$1'));\n        if (location == -1 || !buffer.buffer) continue;\n        this.attributes[attribute] = location;\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer.buffer);\n        gl.enableVertexAttribArray(location);\n        gl.vertexAttribPointer(location, buffer.buffer.spacing, gl.FLOAT, false, 0, 0);\n        length = buffer.buffer.length / buffer.buffer.spacing;\n      }\n\n      // Disable unused attribute pointers.\n      for (var attribute in this.attributes) {\n        if (!(attribute in vertexBuffers)) {\n          gl.disableVertexAttribArray(this.attributes[attribute]);\n        }\n      }\n\n      // Draw the geometry.\n      if (length && (!indexBuffer || indexBuffer.buffer)) {\n        if (indexBuffer) {\n          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer.buffer);\n          gl.drawElements(mode, indexBuffer.buffer.length, gl.UNSIGNED_SHORT, 0);\n        } else {\n          gl.drawArrays(mode, 0, length);\n        }\n      }\n\n      return this;\n    }\n  };\n\n  // src/texture.js\n  // Provides a simple wrapper around WebGL textures that supports render-to-texture.\n\n  // ### new GL.Texture(width, height[, options])\n  //\n  // The arguments `width` and `height` give the size of the texture in texels.\n  // WebGL texture dimensions must be powers of two unless `filter` is set to\n  // either `gl.NEAREST` or `gl.LINEAR` and `wrap` is set to `gl.CLAMP_TO_EDGE`\n  // (which they are by default).\n  //\n  // Texture parameters can be passed in via the `options` argument.\n  // Example usage:\n  //\n  //     var t = new GL.Texture(256, 256, {\n  //       // Defaults to gl.LINEAR, set both at once with \"filter\"\n  //       magFilter: gl.NEAREST,\n  //       minFilter: gl.LINEAR,\n  //\n  //       // Defaults to gl.CLAMP_TO_EDGE, set both at once with \"wrap\"\n  //       wrapS: gl.REPEAT,\n  //       wrapT: gl.REPEAT,\n  //\n  //       format: gl.RGB, // Defaults to gl.RGBA\n  //       type: gl.FLOAT // Defaults to gl.UNSIGNED_BYTE\n  //     });\n  // function Texture(width, height, options = {}) {\n  //   this.width = width;\n  //   this.height = height;\n  //   this.id = gl.createTexture();\n\n  //   const type = options.type || gl.UNSIGNED_BYTE;\n  //   let internalFormat = gl.RGBA8; // default\n  //   if (type === gl.FLOAT) internalFormat = gl.RGBA32F;\n  //   if (type === gl.HALF_FLOAT) internalFormat = gl.RGBA16F;\n\n  //   gl.bindTexture(gl.TEXTURE_2D, this.id);\n  //   gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n  //   gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, options.minFilter || gl.LINEAR);\n  //   gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, options.magFilter || gl.LINEAR);\n  //   gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, options.wrapS || gl.CLAMP_TO_EDGE);\n  //   gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, options.wrapT || gl.CLAMP_TO_EDGE);\n\n  //   gl.texImage2D(\n  //     gl.TEXTURE_2D,\n  //     0,\n  //     internalFormat, // sized internal format\n  //     width,\n  //     height,\n  //     0,\n  //     gl.RGBA,        // format\n  //     type,           // type\n  //     null\n  //   );\n\n  //   gl.bindTexture(gl.TEXTURE_2D, null);\n\n  //   this.type = type;\n  //   this.internalFormat = internalFormat;\n  // }\n\n  function Texture(width, height, options) {\n    options = options || {};\n\n    this.width = width;\n    this.height = height;\n    this.id = gl.createTexture();\n\n    // Default format/type\n    let type = options.type || gl.UNSIGNED_BYTE;\n    let internalFormat = options.format || gl.RGBA;\n    let format = gl.RGBA;\n\n    // Detect extensions for float/half-float\n    const extFloat = gl.getExtension('EXT_color_buffer_float');\n    const extHalf = gl.getExtension('EXT_color_buffer_half_float');\n\n    if (type === gl.FLOAT) {\n      if (!extFloat) {\n        console.warn(\"FLOAT textures not renderable, falling back to UNSIGNED_BYTE\");\n        type = gl.UNSIGNED_BYTE;\n        internalFormat = gl.RGBA8; // fallback\n      } else if (gl instanceof WebGL2RenderingContext) {\n        internalFormat = gl.RGBA32F;\n      }\n      format = gl.RGBA;\n    } else if (type === gl.HALF_FLOAT_OES) {\n      if (!extHalf) {\n        console.warn(\"HALF_FLOAT textures not renderable, falling back to UNSIGNED_BYTE\");\n        type = gl.UNSIGNED_BYTE;\n        internalFormat = gl.RGBA8;\n      } else if (gl instanceof WebGL2RenderingContext) {\n        internalFormat = gl.RGBA16F;\n      }\n      format = gl.RGBA;\n    } else {\n      // UNSIGNED_BYTE\n      type = gl.UNSIGNED_BYTE;\n      internalFormat = gl.RGBA8; // WebGL2 sized format\n      format = gl.RGBA;\n    }\n\n    // Filters\n    const magFilter = options.filter || options.magFilter || gl.LINEAR;\n    const minFilter = options.filter || options.minFilter || gl.LINEAR;\n\n    gl.bindTexture(gl.TEXTURE_2D, this.id);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, options.wrap || options.wrapS || gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, options.wrap || options.wrapT || gl.CLAMP_TO_EDGE);\n\n    // Allocate storage\n    if (gl instanceof WebGL2RenderingContext) {\n      // WebGL2: internalFormat can be sized (RGBA32F, RGBA16F)\n      gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, width, height, 0, format, type, null);\n    } else {\n      // WebGL1: internalFormat must match format (gl.RGBA)\n      gl.texImage2D(gl.TEXTURE_2D, 0, format, width, height, 0, format, type, null);\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // Save final values for later use\n    this.format = format;\n    this.type = type;\n    this.internalFormat = internalFormat;\n  }\n\n\n  var framebuffer;\n  var renderbuffer;\n  var checkerboardCanvas;\n\n  Texture.prototype = {\n    // ### .bind([unit])\n    //\n    // Bind this texture to the given texture unit (0-7, defaults to 0).\n    bind: function (unit) {\n      gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n      gl.bindTexture(gl.TEXTURE_2D, this.id);\n    },\n\n    // ### .unbind([unit])\n    //\n    // Clear the given texture unit (0-7, defaults to 0).\n    unbind: function (unit) {\n      gl.activeTexture(gl.TEXTURE0 + (unit || 0));\n      gl.bindTexture(gl.TEXTURE_2D, null);\n    },\n\n    // ### .canDrawTo()\n    //\n    // Check if rendering to this texture is supported. It may not be supported\n    // for floating-point textures on some configurations.\n    canDrawTo: function () {\n      framebuffer = framebuffer || gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n      var result = gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE;\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      return result;\n    },\n\n    // ### .drawTo(callback)\n    //\n    // Render all draw calls in `callback` to this texture. This method sets up\n    // a framebuffer with this texture as the color attachment and a renderbuffer\n    // as the depth attachment. It also temporarily changes the viewport to the\n    // size of the texture.\n    //\n    // Example usage:\n    //\n    //     texture.drawTo(function() {\n    //       gl.clearColor(1, 0, 0, 1);\n    //       gl.clear(gl.COLOR_BUFFER_BIT);\n    //     });\n    drawTo: function (callback) {\n      const ext = gl.getExtension('EXT_color_buffer_float');\n      if (!ext) console.warn(\"EXT_color_buffer_float not available!\");\n      var v = gl.getParameter(gl.VIEWPORT);\n      framebuffer = framebuffer || gl.createFramebuffer();\n      renderbuffer = renderbuffer || gl.createRenderbuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n      gl.bindRenderbuffer(gl.RENDERBUFFER, renderbuffer);\n      if (this.width != renderbuffer.width || this.height != renderbuffer.height) {\n        renderbuffer.width = this.width;\n        renderbuffer.height = this.height;\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.id, 0);\n      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, renderbuffer);\n      if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) != gl.FRAMEBUFFER_COMPLETE) {\n        throw new Error('Rendering to this texture is not supported (incomplete framebuffer)');\n      }\n      gl.viewport(0, 0, this.width, this.height);\n\n      callback();\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n      gl.viewport(v[0], v[1], v[2], v[3]);\n    },\n\n    // ### .swapWith(other)\n    //\n    // Switch this texture with `other`, useful for the ping-pong rendering\n    // technique used in multi-stage rendering.\n    swapWith: function (other) {\n      var temp;\n      temp = other.id; other.id = this.id; this.id = temp;\n      temp = other.width; other.width = this.width; this.width = temp;\n      temp = other.height; other.height = this.height; this.height = temp;\n    }\n  };\n\n  // ### GL.Texture.fromImage(image[, options])\n  //\n  // Return a new image created from `image`, an `<img>` tag.\n  Texture.fromImage = function (image, options) {\n    options = options || {};\n    var texture = new Texture(image.width, image.height, options);\n    gl.bindTexture(gl.TEXTURE_2D, texture.id); // <-- bind it first\n    try {\n      gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, texture.type, image);\n    } catch (e) {\n      if (location.protocol == 'file:') {\n        throw new Error('image not loaded for security reasons (serve this page over \"http://\" instead)');\n      } else {\n        throw new Error('image not loaded for security reasons (image must originate from the same ' +\n          'domain as this page or use Cross-Origin Resource Sharing)');\n      }\n    }\n    if (options.minFilter && options.minFilter != gl.NEAREST && options.minFilter != gl.LINEAR) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    }\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    return texture;\n  };\n\n  // ### GL.Texture.fromURL(url[, options])\n  //\n  // Returns a checkerboard texture that will switch to the correct texture when\n  // it loads.\n  Texture.fromURL = function (url, options) {\n    checkerboardCanvas = checkerboardCanvas || (function () {\n      var c = document.createElement('canvas').getContext('2d');\n      c.canvas.width = c.canvas.height = 128;\n      for (var y = 0; y < c.canvas.height; y += 16) {\n        for (var x = 0; x < c.canvas.width; x += 16) {\n          c.fillStyle = (x ^ y) & 16 ? '#FFF' : '#DDD';\n          c.fillRect(x, y, 16, 16);\n        }\n      }\n      return c.canvas;\n    })();\n    var texture = Texture.fromImage(checkerboardCanvas, options);\n    var image = new Image();\n    var context = gl;\n    image.onload = function () {\n      context.makeCurrent();\n      Texture.fromImage(image, options).swapWith(texture);\n    };\n    image.src = url;\n    return texture;\n  };\n\n  // ### GL.Texture.canUseFloatingPointTextures()\n  //\n  // Returns false if `gl.FLOAT` is not supported as a texture type. This is the\n  // `OES_texture_float` extension.\n  Texture.canUseFloatingPointTextures = function () {\n    return !!gl.getExtension('OES_texture_float');\n  };\n\n  // ### GL.Texture.canUseFloatingPointLinearFiltering()\n  //\n  // Returns false if `gl.LINEAR` is not supported as a texture filter mode for\n  // textures of type `gl.FLOAT`. This is the `OES_texture_float_linear`\n  // extension.\n  Texture.canUseFloatingPointLinearFiltering = function () {\n    return !!gl.getExtension('OES_texture_float_linear');\n  };\n\n  // ### GL.Texture.canUseFloatingPointTextures()\n  //\n  // Returns false if `gl.HALF_FLOAT_OES` is not supported as a texture type.\n  // This is the `OES_texture_half_float` extension.\n  Texture.canUseHalfFloatingPointTextures = function () {\n    return !!gl.getExtension('OES_texture_half_float');\n  };\n\n  // ### GL.Texture.canUseFloatingPointLinearFiltering()\n  //\n  // Returns false if `gl.LINEAR` is not supported as a texture filter mode for\n  // textures of type `gl.HALF_FLOAT_OES`. This is the\n  // `OES_texture_half_float_linear` extension.\n  Texture.canUseHalfFloatingPointLinearFiltering = function () {\n    return !!gl.getExtension('OES_texture_half_float_linear');\n  };\n\n  // src/vector.js\n  // Provides a simple 3D vector class. Vector operations can be done using member\n  // functions, which return new vectors, or static functions, which reuse\n  // existing vectors to avoid generating garbage.\n  function Vector(x, y, z) {\n    this.x = x || 0;\n    this.y = y || 0;\n    this.z = z || 0;\n  }\n\n  // ### Instance Methods\n  // The methods `add()`, `subtract()`, `multiply()`, and `divide()` can all\n  // take either a vector or a number as an argument.\n  Vector.prototype = {\n    negative: function () {\n      return new Vector(-this.x, -this.y, -this.z);\n    },\n    add: function (v) {\n      if (v instanceof Vector) return new Vector(this.x + v.x, this.y + v.y, this.z + v.z);\n      else return new Vector(this.x + v, this.y + v, this.z + v);\n    },\n    subtract: function (v) {\n      if (v instanceof Vector) return new Vector(this.x - v.x, this.y - v.y, this.z - v.z);\n      else return new Vector(this.x - v, this.y - v, this.z - v);\n    },\n    multiply: function (v) {\n      if (v instanceof Vector) return new Vector(this.x * v.x, this.y * v.y, this.z * v.z);\n      else return new Vector(this.x * v, this.y * v, this.z * v);\n    },\n    divide: function (v) {\n      if (v instanceof Vector) return new Vector(this.x / v.x, this.y / v.y, this.z / v.z);\n      else return new Vector(this.x / v, this.y / v, this.z / v);\n    },\n    equals: function (v) {\n      return this.x == v.x && this.y == v.y && this.z == v.z;\n    },\n    dot: function (v) {\n      return this.x * v.x + this.y * v.y + this.z * v.z;\n    },\n    cross: function (v) {\n      return new Vector(\n        this.y * v.z - this.z * v.y,\n        this.z * v.x - this.x * v.z,\n        this.x * v.y - this.y * v.x\n      );\n    },\n    length: function () {\n      return Math.sqrt(this.dot(this));\n    },\n    unit: function () {\n      return this.divide(this.length());\n    },\n    min: function () {\n      return Math.min(Math.min(this.x, this.y), this.z);\n    },\n    max: function () {\n      return Math.max(Math.max(this.x, this.y), this.z);\n    },\n    toAngles: function () {\n      return {\n        theta: Math.atan2(this.z, this.x),\n        phi: Math.asin(this.y / this.length())\n      };\n    },\n    angleTo: function (a) {\n      return Math.acos(this.dot(a) / (this.length() * a.length()));\n    },\n    toArray: function (n) {\n      return [this.x, this.y, this.z].slice(0, n || 3);\n    },\n    clone: function () {\n      return new Vector(this.x, this.y, this.z);\n    },\n    init: function (x, y, z) {\n      this.x = x; this.y = y; this.z = z;\n      return this;\n    }\n  };\n\n  // ### Static Methods\n  // `Vector.randomDirection()` returns a vector with a length of 1 and a\n  // statistically uniform direction. `Vector.lerp()` performs linear\n  // interpolation between two vectors.\n  Vector.negative = function (a, b) {\n    b.x = -a.x; b.y = -a.y; b.z = -a.z;\n    return b;\n  };\n  Vector.add = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x + b.x; c.y = a.y + b.y; c.z = a.z + b.z; }\n    else { c.x = a.x + b; c.y = a.y + b; c.z = a.z + b; }\n    return c;\n  };\n  Vector.subtract = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x - b.x; c.y = a.y - b.y; c.z = a.z - b.z; }\n    else { c.x = a.x - b; c.y = a.y - b; c.z = a.z - b; }\n    return c;\n  };\n  Vector.multiply = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x * b.x; c.y = a.y * b.y; c.z = a.z * b.z; }\n    else { c.x = a.x * b; c.y = a.y * b; c.z = a.z * b; }\n    return c;\n  };\n  Vector.divide = function (a, b, c) {\n    if (b instanceof Vector) { c.x = a.x / b.x; c.y = a.y / b.y; c.z = a.z / b.z; }\n    else { c.x = a.x / b; c.y = a.y / b; c.z = a.z / b; }\n    return c;\n  };\n  Vector.cross = function (a, b, c) {\n    c.x = a.y * b.z - a.z * b.y;\n    c.y = a.z * b.x - a.x * b.z;\n    c.z = a.x * b.y - a.y * b.x;\n    return c;\n  };\n  Vector.unit = function (a, b) {\n    var length = a.length();\n    b.x = a.x / length;\n    b.y = a.y / length;\n    b.z = a.z / length;\n    return b;\n  };\n  Vector.fromAngles = function (theta, phi) {\n    return new Vector(Math.cos(theta) * Math.cos(phi), Math.sin(phi), Math.sin(theta) * Math.cos(phi));\n  };\n  Vector.randomDirection = function () {\n    return Vector.fromAngles(Math.random() * Math.PI * 2, Math.asin(Math.random() * 2 - 1));\n  };\n  Vector.min = function (a, b) {\n    return new Vector(Math.min(a.x, b.x), Math.min(a.y, b.y), Math.min(a.z, b.z));\n  };\n  Vector.max = function (a, b) {\n    return new Vector(Math.max(a.x, b.x), Math.max(a.y, b.y), Math.max(a.z, b.z));\n  };\n  Vector.lerp = function (a, b, fraction) {\n    return b.subtract(a).multiply(fraction).add(a);\n  };\n  Vector.fromArray = function (a) {\n    return new Vector(a[0], a[1], a[2]);\n  };\n  Vector.angleBetween = function (a, b) {\n    return a.angleTo(b);\n  };\n\n  return GL;\n})();\n\nexport default GL;\n\n","import GL from \"./lightgl\";\n\nlet params = {\n    numSteps: 2, focal: 45,\n    visualizations: {\n        showFlags: true, areaConservationEnabled: true,\n        video: { show: false },\n        shadow: { enabled: true, shadowRadius: .5, shadowPower: .5, showCircle: true, circleRadius: .6, circleStroke: .15 },\n        sparks: { enabled: false, glow: 5., glowOffset: .5, lengthFactor: 1., stroke: .01, num: 40, sizeFactor: 50, fov: Math.PI / 4 }\n    },\n    simulation: { optimized: false, waterDamping: .02, poolSize: new GL.Vector(2.0, 1.0, 2.0) }\n};\n\nexport { params };","import GL from './lightgl.js';\nimport { params } from './params.js';\n\nconst GRAVITY = new GL.Vector(0, -4, 0);\n\nclass Sphere {\n    /**\n     * \n     * @param {GL.Vector} center \n     * @param {float} radius \n     */\n    constructor(center, radius) {\n        this.center = new GL.Vector(center.x, center.y, center.z);\n        this.oldCenter = new GL.Vector(center.x, center.y, center.z);\n        this.radius = radius;\n        this.cinematic = false;\n        this.velocity = new GL.Vector(0, 0, 0);\n        this.acceleration = new GL.Vector(0, 0, 0);\n        this.mass = (4 / 3) * Math.PI * Math.pow(radius, 3) * 1000;\n        this.invMass = 1 / this.mass;\n        this.radiusSquared = radius * radius;\n        this.mesh = GL.Mesh.sphere({ detail: 10 });\n    }\n\n    /**\n     * \n     * @param {float} dt \n     * @param {boolean} isSwimming \n     */\n    update(dt) {\n        if (!this.cinematic) {\n            this.oldCenter = new GL.Vector(this.center.x, this.center.y, this.center.z);\n            const percentUnderWater = Math.max(0, Math.min(1, (this.radius - this.center.y) / (2 * this.radius)));\n            const floatingForce = GRAVITY.multiply(-1.35 * this.mass * percentUnderWater); // 1.1 before // then 1.35\n            const drag = this.velocity.unit().multiply(-1000 * this.radiusSquared * percentUnderWater * this.velocity.dot(this.velocity)); // 1000 before\n            this.addForce(drag);\n            this.addForce(floatingForce);\n            this.addForce(GRAVITY.multiply(this.mass));\n            this.velocity = this.velocity.add(this.acceleration.multiply(dt));\n            this.acceleration = new GL.Vector(0, 0, 0);\n            this.center = this.center.add(this.velocity.multiply(dt));\n\n            // Bounce off the bottom\n            if (this.center.y < this.radius - params.simulation.poolSize.y) {\n                this.center.y = this.radius - 1;\n                this.velocity.y = Math.abs(this.velocity.y) * 0.7;\n            }\n        }\n        else this.velocity = new GL.Vector(0, 0, 0);\n    }\n\n    /**\n     * \n     * @param {GL.Vector} force \n     */\n    addForce(force) {\n        if (!this.cinematic) {\n            this.acceleration = this.acceleration.add(force.multiply(this.invMass));\n        }\n        else console.warn(\"Trying to add force to a cinematic sphere.\");\n    }\n\n    /**\n     * \n     * @param {GL.Vector} newCenter \n     */\n    move(newCenter) {\n        this.oldCenter = new GL.Vector(this.center.x, this.center.y, this.center.z);\n        this.center = new GL.Vector(newCenter.x, newCenter.y, newCenter.z);\n        if (!this.cinematic) console.warn(\"Moving a non cinematic sphere.\");\n    }\n}\n\nexport { Sphere };","const ARM_DELTA_X = .3;\nconst FOOT_DELTA_X = .15;\nconst FOOT_DELTA_Z = 1.;\nconst numAttributes = 9;\nconst NUM_VEC_ATTRIBUTES = Math.ceil(numAttributes / 4);\nconst MAX_NUM_SWIMMER = 10;\n\nexport { ARM_DELTA_X, FOOT_DELTA_X, FOOT_DELTA_Z, NUM_VEC_ATTRIBUTES, MAX_NUM_SWIMMER };","import GL from \"./lightgl\";\nimport { params } from \"./params\";\nimport { Sphere } from \"./sphere\";\nimport { Swimmer } from \"./swimmer\";\nimport { ARM_DELTA_X, FOOT_DELTA_X, FOOT_DELTA_Z, MAX_NUM_SWIMMER, NUM_VEC_ATTRIBUTES } from \"./swimmersConstants\";\n\nconst pointVertexShaderSource = `#version 300 es\n    const float ARM_DELTA_X = float(`+ ARM_DELTA_X + `);\n    const float FOOT_DELTA_X = float( `+ FOOT_DELTA_X + `);\n    const float FOOT_DELTA_Z = float( `+ FOOT_DELTA_Z + `);\n    uniform vec2 invPoolSize;\n    in vec4 iData1;\n    in vec4 iData2;\n    in vec4 iData3;\n    out float fragAltitude;\n    out float fragCyclePhase;\n    void main() {\n        fragCyclePhase = iData3.r;\n        fragAltitude = iData2.a;\n        vec2 center = iData1.rg;\n        vec2 ips = vec2(.5, .5);\n        gl_Position = vec4(center * 2. * invPoolSize, 0., 1.); // TODO SET ips TO invPoolSize\n        gl_PointSize = 1.;\n    }\n\n`;\n\nconst pointFragmentShaderSource = `#version 300 es\n    precision highp float;\n    in float fragCyclePhase;\n    in float fragAltitude;\n    const float PI = 3.141592;\n    out vec4 fragColor;\n    void main() {\n        fragColor = vec4(fragAltitude, fragCyclePhase / (2. * PI), 1., 1.);\n    }\n`;\n\nconst volumeVertexShaderSource = `#version 300 es\n    in vec2 iVertex;\n    out vec2 fragCoord;\n    void main() {\n        fragCoord = iVertex * .5 + .5;\n        gl_Position = vec4(iVertex.xy, 0., 1.);\n    }\n`;\n\nconst volumeFragmentShaderSource = `#version 300 es\n    precision highp float;\n    uniform sampler2D tex;\n    uniform vec2 poolSize;\n    uniform bool horizontal;\n    uniform bool show;\n    uniform bool swapColor;\n    uniform bool blur;\n    in vec2 fragCoord;\n    out vec4 fragColor;\n\n    float volumeInSphere(vec2 diff, float altitude, float cyclePhase) {\n        vec3 toCenter = vec3(diff.x, -altitude, diff.y);\n        const float radius = .25;\n        float t = length(toCenter) / radius;\n        float dy = exp(-pow(t * 1.5, 6.0));\n        float ymin = min(0.0, altitude - dy);\n        float ymax = min(max(0.0, altitude + dy), ymin + 2.0 * dy);\n        return (ymax - ymin) * 0.1;\n    }\n\n    vec4 horizontalPass(float radius, vec2 delta, int rx) {\n        float radiusSq = radius*radius;\n        vec4 res = vec4(0., 0., 0., .5);\n        int N = textureSize(tex, 0).x;\n        // float dx_texel = fragCoord.x * float(N) - floor(fragCoord.x * float(N)) - .5;\n        // dx_texel /= float(N);\n        // dx_texel *= poolSize.x;\n        for(int i = -rx; i < rx; i++) {\n            float i_float = float(i);\n            //TODO tester si vraiment dans kernel\n            float j_float = 0.;\n            float diff = i_float * delta.x;\n            vec2 p = fragCoord + vec2(diff, 0.);\n            vec4 info = texture(tex, p);\n            if(info.b != 0.) {\n                float X = diff * poolSize.x;\n                float Y = sqrt(radiusSq - X*X);\n                res.g = Y;\n                res.r = X;\n                //res.r += volumeInSphere(vec2(-X, 0.), info.r, info.g) * 5.;\n                res.b = info.r;\n            }\n        }\n        return res;\n    }\n\n    vec4 verticalPass(float radius, vec2 delta, int ry) {\n        // vec4 info = texture(tex, fragCoord);\n        // return info;\n        float radiusSq = radius*radius;\n        int M = textureSize(tex, 0).y;\n        float dy_texel = fragCoord.y * float(M) - floor(fragCoord.y * float(M)) - .5;\n        dy_texel /= float(M);\n\n        \n        \n        int N = textureSize(tex, 0).x;\n        float dx_texel = fragCoord.x * float(N) - floor(fragCoord.x * float(N)) - .5;\n        dx_texel /= float(N);\n\n        vec2 d_texel = vec2(dx_texel, dy_texel);\n\n        float dy = dy_texel * poolSize.y;\n        vec4 res = vec4(0., 0., 0., .5);\n        for(int j = -ry; j < ry; j++) {\n            float j_float = float(j);\n            //TODO tester si vraiment dans kernel\n            float diff = j_float * delta.y;\n            vec2 p = fragCoord + vec2(0., diff);\n            vec2 p_centered = p - d_texel;\n            vec4 info_centered = texture(tex, p_centered);\n            p -= vec2(0., dy_texel);\n            vec4 info = texture(tex, p);\n            // info = info_centered;\n            float Y = diff * poolSize.y;\n            Y -= dy;\n            if(info_centered.rgb != vec3(0., 0., 0.) && abs(Y) <= info.g) {\n                float X = info_centered.r;\n                res.r = volumeInSphere(vec2(X, Y), 2.*info_centered.b, info.g) * 5.;\n            }\n        }\n        return res;\n    }\n\n    void main() {\n\n        if (show) {\n            fragColor = vec4(texture(tex, fragCoord).rgb, .7);\n            if (swapColor) fragColor = vec4(texture(tex, fragCoord).grb, .7);\n            return;\n        }\n\n        ivec2 textureSizeInt = textureSize(tex, 0);\n        vec2 textureSize = vec2(float(textureSizeInt.x), float(textureSizeInt.y));\n        vec2 delta = vec2(1./textureSize.x, 1./textureSize.y);\n        const float radius = .25;\n        float radiusSq = radius*radius;\n        int rx = int(radius * textureSize.x / poolSize.x);\n        int ry = int(radius * textureSize.y / poolSize.y);\n\n        if (horizontal) fragColor = horizontalPass(radius, delta, rx);\n        else fragColor = verticalPass(radius, delta, ry);\n    }\n`;\n\n\nconst vertexBuffer = new Float32Array([\n    -1, -1,\n    1, -1,\n    1, 1,\n    -1, 1,\n]);\n\nconst indices = new Uint16Array([\n    0, 1, 2,\n    2, 3, 0\n]);\n\nclass SwimmersAttributes {\n    /**\n     *\n     * @param {WebGLRenderingContext} gl\n     */\n    constructor(gl) {\n        this.numVecAttributes = NUM_VEC_ATTRIBUTES;\n        this.maxNumSwimmer = MAX_NUM_SWIMMER;\n        this.gl = gl;\n        const filter = gl.NEAREST;\n        this.texture = new GL.Texture(this.numVecAttributes, this.maxNumSwimmer, { type: gl.FLOAT, filter: filter });\n\n        this.initPrograms();\n\n        this.indexBuffer = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n        this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, indices, this.gl.STATIC_DRAW);\n\n        this.vboPlane = this.gl.createBuffer();\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vboPlane);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, vertexBuffer, this.gl.STATIC_DRAW);\n\n\n        this.vboPoints = this.gl.createBuffer();\n    }\n\n    /**\n     * \n     * @param {Swimmer[]} swimmers \n     */\n    #findFirst(swimmers) {\n        let maxDist = -params.simulation.poolSize.z;\n        let indexFirst = -1;\n        for (let i = 0; i < swimmers.length; i++) {\n            const dist = swimmers[i].body.center.z;\n            if (dist > maxDist) {\n                maxDist = dist;\n                indexFirst = i;\n            }\n        }\n        return indexFirst;\n    }\n\n    /**\n     * \n     * @param {*} index \n     * @param {Sphere} sphere \n     */\n    #addSphereInformation(index, sphere) {\n        this.swimmersAttributes[this.numVecAttributes * 4 * index] = sphere.center.x;\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 1] = sphere.center.z;\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 7] = sphere.center.y;\n    }\n\n\n    /**\n     * \n     * @param {*} index \n     * @param {Swimmer} swimmer \n     */\n    #addSwimmerInformation(index, swimmer, first = false) {\n        this.#addSphereInformation(index, swimmer.body);\n\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 2] = swimmer.divingDistance;\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 3] = swimmer.divingTime;\n\n        //Second row of attributes\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 4] = swimmer.reactionTime;\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 5] = swimmer.body.velocity.z * 3.6;\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 6] = swimmer.nationality;\n\n        this.swimmersAttributes[this.numVecAttributes * 4 * index + 8] = first ? 1 : 0;\n    }\n\n    /**\n     *\n     * @param {Swimmer[]} swimmers\n     */\n    update(swimmers) {\n        this.numSwimmers = swimmers.length;\n        const numSpheres = 5;\n        const indexFirst = this.#findFirst(swimmers);\n        this.swimmersAttributes = new Float32Array(this.numVecAttributes * 4 * this.maxNumSwimmer * numSpheres);\n        for (let i = 0; i < swimmers.length; i++) {\n            const swimmer = swimmers[i];\n            const first = i == indexFirst;\n            this.#addSwimmerInformation(i, swimmer, first);\n            this.#addSphereInformation(swimmers.length + i, swimmer.leftArm);\n            this.#addSphereInformation(2 * swimmers.length + i, swimmer.rightArm);\n            this.#addSphereInformation(3 * swimmers.length + i, swimmer.leftFoot);\n            this.#addSphereInformation(4 * swimmers.length + i, swimmer.rightFoot);\n\n        }\n        // Write back to textureA\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture.id);\n        this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, false);\n        this.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, this.numVecAttributes, this.maxNumSwimmer, this.gl.RGBA, this.gl.FLOAT, this.swimmersAttributes);\n        this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, true);\n\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vboPoints);\n        this.gl.bufferData(this.gl.ARRAY_BUFFER, this.swimmersAttributes, this.gl.DYNAMIC_DRAW);\n    };\n\n    buildShader(shaderSource, shaderType) {\n        const shader = this.gl.createShader(shaderType); // Create the shader object\n        this.gl.shaderSource(shader, shaderSource); // Load the shader source\n        this.gl.compileShader(shader); // Compile the shader\n        return shader;\n    }\n\n    createProgram(shaders) {\n        const program = this.gl.createProgram();\n        shaders.forEach((shader) => {\n            this.gl.attachShader(program, shader);\n        });\n        this.gl.linkProgram(program);\n        return program;\n    }\n    checkShaders(vs, fs, program) {\n        if (!this.gl.getShaderParameter(vs, this.gl.COMPILE_STATUS))\n            console.error(this.gl.getShaderInfoLog(vs));\n\n        if (!this.gl.getShaderParameter(fs, this.gl.COMPILE_STATUS))\n            console.error(this.gl.getShaderInfoLog(fs));\n\n        if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS))\n            console.error(this.gl.getProgramInfoLog(program));\n    }\n\n    createRenderingTexture(width, height) {\n        this.pointsTexture = new GL.Texture(width, height, { type: this.gl.FLOAT, filter: this.gl.NEAREST }); // TODO try unsigned bytes here.\n        this.pointsFrameBuffer = this.gl.createFramebuffer();\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.pointsFrameBuffer);\n        const attachmentPoint = this.gl.COLOR_ATTACHMENT0;\n        this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, attachmentPoint, this.gl.TEXTURE_2D, this.pointsTexture.id, 0);\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        this.horizontalPassTexture = new GL.Texture(width, height, { type: this.gl.FLOAT, filter: this.gl.LINEAR }); // TODO try unsigned bytes here.\n        this.horizontalPassFrameBuffer = this.gl.createFramebuffer();\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.horizontalPassFrameBuffer);\n        this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, attachmentPoint, this.gl.TEXTURE_2D, this.horizontalPassTexture.id, 0);\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        const N = height / 4;\n        const W = N;\n        const H = N;\n\n        this.displacementTexture = new GL.Texture(W, H, { type: this.gl.FLOAT, filter: this.gl.LINEAR }); // TODO try unsigned bytes here.\n        this.displacementFrameBuffer = this.gl.createFramebuffer();\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.displacementFrameBuffer);\n        this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, attachmentPoint, this.gl.TEXTURE_2D, this.displacementTexture.id, 0);\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        this.oldDisplacementTexture = new GL.Texture(W, H, { type: this.gl.FLOAT, filter: this.gl.LINEAR }); // TODO try unsigned bytes here.\n\n    }\n\n    buildProgram(vertexSource, fragmentSource) {\n        const vs = this.buildShader(vertexSource, this.gl.VERTEX_SHADER);\n        const fs = this.buildShader(fragmentSource, this.gl.FRAGMENT_SHADER);\n\n        const program = this.createProgram([vs, fs]);\n\n        this.checkShaders(vs, fs, program);\n\n        return program;\n    }\n\n    initPrograms() {\n        this.programPoints = this.buildProgram(pointVertexShaderSource, pointFragmentShaderSource);\n        this.programVolume = this.buildProgram(volumeVertexShaderSource, volumeFragmentShaderSource);\n\n        this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n    }\n\n    volumePass() {\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.horizontalPassFrameBuffer);\n        this.gl.useProgram(this.programVolume);\n\n        const vertexLocation = this.gl.getAttribLocation(this.programVolume, \"iVertex\");\n\n        const poolSizeLocation = this.gl.getUniformLocation(this.programVolume, \"poolSize\");\n        this.gl.uniform2f(poolSizeLocation, params.simulation.poolSize.x, params.simulation.poolSize.z);\n\n        const horizontalLocation = this.gl.getUniformLocation(this.programVolume, \"horizontal\");\n        this.gl.uniform1i(horizontalLocation, true);\n\n        const showLocation = this.gl.getUniformLocation(this.programVolume, \"show\");\n        this.gl.uniform1i(showLocation, false);\n\n        const swapColorLocation = this.gl.getUniformLocation(this.programVolume, \"swapColor\");\n        this.gl.uniform1i(swapColorLocation, false);\n\n        const sizeVertex = 2;\n        const type = this.gl.FLOAT;\n        const normalize = false;\n        const sizeof_float = 4;\n        const stride = 0;\n        const offset = 0;\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vboPlane);\n        this.gl.vertexAttribPointer(vertexLocation, sizeVertex, type, normalize, stride, offset);\n        this.gl.enableVertexAttribArray(vertexLocation);\n\n        this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer);\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.pointsTexture.id);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n        this.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\n\n        //VERTICAL PASS\n\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.displacementFrameBuffer);\n\n        this.gl.uniform1i(horizontalLocation, false);\n\n        this.gl.uniform1i(showLocation, false);\n\n\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.horizontalPassTexture.id);\n\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n        this.gl.viewport(0, 0, this.displacementTexture.width, this.displacementTexture.height);\n        this.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\n        this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n\n        // // SHOW\n\n        // this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        // this.gl.uniform1i(showLocation, true);\n\n\n\n        // this.gl.activeTexture(this.gl.TEXTURE0);\n        // this.gl.bindTexture(this.gl.TEXTURE_2D, this.displacementTexture.id);\n\n        // // this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n        // this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n        // //this.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\n\n\n        // // SHOW OLD\n\n        // this.gl.uniform1i(showLocation, true);\n\n        // this.gl.uniform1i(swapColorLocation, true);\n\n\n\n        // this.gl.activeTexture(this.gl.TEXTURE0);\n        // this.gl.bindTexture(this.gl.TEXTURE_2D, this.oldDisplacementTexture.id);\n\n        // //this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n        // this.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n        // this.gl.drawElements(this.gl.TRIANGLES, 6, this.gl.UNSIGNED_SHORT, 0);\n    }\n\n    pointPass() {\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.pointsFrameBuffer);\n        this.gl.useProgram(this.programPoints);\n        const data1Location = this.gl.getAttribLocation(this.programPoints, 'iData1');\n\n        const data2Location = this.gl.getAttribLocation(this.programPoints, 'iData2');\n\n        const data3Location = this.gl.getAttribLocation(this.programPoints, 'iData3');\n\n        const invPoolSizeLocation = this.gl.getUniformLocation(this.programPoints, \"invPoolSize\");\n        this.gl.uniform2f(invPoolSizeLocation, 1. / params.simulation.poolSize.x, 1. / params.simulation.poolSize.z);\n\n\n\n        const size = 4;\n        const type = this.gl.FLOAT;\n        const normalize = false;\n\n        const sizeof_float = 4;\n        const stride = 12 * sizeof_float;\n        let offset = 0;\n\n        this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.vboPoints);\n\n        if (data1Location >= 0) {\n            this.gl.vertexAttribPointer(data1Location, size, type, normalize, stride, offset);\n            this.gl.enableVertexAttribArray(data1Location);\n        }\n\n        offset = 4 * sizeof_float;\n        if (data2Location >= 0) {\n            this.gl.vertexAttribPointer(data2Location, size, type, normalize, stride, offset);\n            this.gl.enableVertexAttribArray(data2Location);\n        }\n\n        offset = 2 * 4 * sizeof_float;\n        if (data3Location >= 0) {\n            this.gl.vertexAttribPointer(data3Location, size, type, normalize, stride, offset);\n            this.gl.enableVertexAttribArray(data3Location);\n        }\n\n        this.gl.viewport(0, 0, this.pointsTexture.width, this.pointsTexture.height);\n        this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n        this.gl.drawArrays(this.gl.POINTS, 0, 5 * this.numSwimmers);\n    }\n\n    updateOldDisplacementTexture() {\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.displacementFrameBuffer);\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.oldDisplacementTexture.id);\n        this.gl.copyTexSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, 0, 0, this.oldDisplacementTexture.width, this.oldDisplacementTexture.height);\n        // this.gl.copyTexImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, 0, 0, this.oldDisplacementTexture.width, this.oldDisplacementTexture.height, 0);\n    }\n\n    draw() {\n\n        this.updateOldDisplacementTexture();\n\n        this.gl.enable(this.gl.BLEND);\n        this.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\n\n        this.pointPass();\n        this.volumePass();\n\n        this.gl.disable(this.gl.BLEND);\n    }\n}\n\nexport { SwimmersAttributes };","import GL from \"./lightgl\";\nimport { params } from \"./params\";\nimport { Sphere } from \"./sphere\";\nimport { SwimmersAttributes } from \"./swimmersAttributes\";\nimport { ARM_DELTA_X, FOOT_DELTA_X, FOOT_DELTA_Z, MAX_NUM_SWIMMER, NUM_VEC_ATTRIBUTES } from \"./swimmersConstants\";\n\nfunction gaussianRandom(mean = 0, stdev = 1) {\n    const u = 1 - Math.random(); // Converting [0,1) to (0,1]\n    const v = Math.random();\n    const z = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);\n    // Transform to the desired mean and standard deviation:\n    return z * stdev + mean;\n}\n\nconst AWAY = new GL.Vector(1000, 0, 0);\nconst armAmplitude = 0.5;\nconst armFrequency = 1;\nconst armPulsation = 2 * Math.PI * armFrequency;\n\n\nclass Swimmer {\n    static useGravity = false;\n    static raceHasStarted = false;\n    static swimming = false;\n\n    /**@type {SwimmersAttributes} */\n    static attributes;\n\n    static initAttributes = (gl) => {\n        Swimmer.attributes = new SwimmersAttributes(gl);\n    }\n\n    static updateAttributesTexture = (swimmers) => {\n        Swimmer.attributes.update(swimmers);\n    }\n\n    static getAttributesTexture = () => {\n        return Swimmer.attributes.texture;\n    }\n\n    static bindDisplacementTexture = (i) => {\n        Swimmer.attributes.displacementTexture.bind(i);\n    }\n\n    static bindOldDisplacementTexture = (i) => {\n        Swimmer.attributes.oldDisplacementTexture.bind(i);\n    }\n\n\n    static reset = (resolution) => {\n        Swimmer.attributes.createRenderingTexture(resolution.x, resolution.y);\n    }\n\n    constructor(center) {\n        this.startingPoint = new GL.Vector(center.x, center.y, center.z);\n        this.center = new GL.Vector(center.x, center.y, center.z);\n        this.force = new GL.Vector(0, 0, 190 + gaussianRandom(0, 20));\n\n        this.reactionTime = Math.max(0.1, gaussianRandom(0.15, 0.02));\n\n        const radius = .25;\n        const armRadius = .15;\n\n        this.body = new Sphere(center, radius);\n        this.leftArm = new Sphere(AWAY, armRadius);\n        this.rightArm = new Sphere(AWAY, armRadius);\n        this.leftFoot = new Sphere(AWAY, armRadius);\n        this.rightFoot = new Sphere(AWAY, armRadius);\n\n        this.body.cinematic = !Swimmer.useGravity;\n        this.leftArm.cinematic = true;\n        this.rightArm.cinematic = true;\n        this.leftFoot.cinematic = true;\n        this.rightFoot.cinematic = true;\n\n        /**@type {Sphere[]} */\n        this.spheres = [this.body, this.leftArm, this.rightArm, this.leftFoot, this.rightFoot];\n\n        this.divingDistance = 0;\n        this.divingTime = 1000;\n\n        this.nationality = Math.random() > .5 ? 0 : 1;\n    }\n\n    jump() {\n        this.body.cinematic = false;\n        this.body.velocity = new GL.Vector(0, 0, 4.5 + gaussianRandom(0, 1));\n        this.body.center = new GL.Vector(this.startingPoint.x, 1, -params.simulation.poolSize.z / 2.);\n    }\n\n    swim(start) {\n        this.started = start;\n        if (start) {\n            this.body.cinematic = false;\n            this.useGravity = true;\n            this.body.center = new GL.Vector(this.startingPoint.x, 0, -params.simulation.poolSize.z / 2.);\n        }\n        else {\n            this.body.velocity = new GL.Vector(0, 0, 0);\n            this.body.center = new GL.Vector(this.startingPoint.x, 0, 0);\n        }\n    }\n\n    getArmOffset(time, phase) {\n        return new GL.Vector(0., Math.cos(armPulsation * time + phase), Math.sin(armPulsation * time + phase)).multiply(armAmplitude);\n    }\n\n    update(dt, time) {\n\n        if (Swimmer.raceHasStarted || Swimmer.swimming) {\n            if (!this.started && Swimmer.raceHasStarted) {\n                if (time > this.reactionTime) {\n                    this.swim(true);\n                    this.jump();\n                }\n                else return;\n            }\n            this.body.addForce(this.force);\n            this.cyclePhase = armPulsation * time % 2 * Math.PI;\n            const offset1 = this.getArmOffset(time, 0);\n            const offset2 = this.getArmOffset(time, Math.PI);\n            const offset3 = this.getArmOffset(time * 2, 0);\n            const offset4 = this.getArmOffset(time * 2, Math.PI);\n            this.rightArm.move(this.body.center.add(offset1).add(new GL.Vector(ARM_DELTA_X, 0, 0)));\n            this.leftArm.move(this.body.center.add(offset2).add(new GL.Vector(-ARM_DELTA_X, 0, 0)));\n            this.rightFoot.move(this.body.center.add(new GL.Vector(FOOT_DELTA_X, offset3.y * 0.5, -FOOT_DELTA_Z)));\n            this.leftFoot.move(this.body.center.add(new GL.Vector(-FOOT_DELTA_X, offset4.y * 0.5, -FOOT_DELTA_Z)));\n        }\n        else {\n            this.rightArm.move(AWAY);\n            this.leftArm.move(AWAY);\n            this.rightFoot.move(AWAY);\n            this.leftFoot.move(AWAY);\n        }\n\n        for (let sphere of this.spheres) sphere.update(dt);\n\n        if (!this.hasDove && this.body.center.y <= 0 && this.body.oldCenter.y >= 0) {\n            this.divingDistance = this.body.center.z + params.simulation.poolSize.z / 2;\n            this.divingTime = time;\n            this.hasDove = true;\n        }\n    }\n}\n\nconst swimmersHelperFunctions = `\n    uniform float wr;\n    #define sqrt_2_PI 2.50662827\n    #define PI 3.1415926536\n    uniform sampler2D swimmersAttributesTexture;\n    const int SWIMMERS_NUM_ATTRIBUTES = 4;\n    const vec2 TEXTURE_SIZE = vec2(`+ NUM_VEC_ATTRIBUTES + `, ` + MAX_NUM_SWIMMER + `);\n    uniform float swimmersNumber;\n    uniform float time;\n\n    vec2 getAttributePosition(int i) {\n        float i_float = float(i);\n        vec2 pixel = vec2(0., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.rg;\n    }\n\n    float getAttributeSpeed(int i) {\n        float i_float = float(i);\n        vec2 pixel = vec2(1., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.g;\n    }\n\n    vec2 getAttributeDiving(int i) {\n        float i_float = float(i);\n        vec2 pixel = vec2(0., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.ba;\n    }\n\n    float getAttributeReactionTime(int i ) {\n        float i_float = float(i);\n        vec2 pixel = vec2(1., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.r;\n    }\n\n    float getNationality(int i ) {\n        float i_float = float(i);\n        vec2 pixel = vec2(1., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.b;\n    }\n\n    float getAltitude(int i ) {\n        float i_float = float(i);\n        vec2 pixel = vec2(1., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.a;\n    }\n\n    bool isFirst(int i) {\n        float i_float = float(i);\n        vec2 pixel = vec2(2., i_float);\n        vec4 attributes = texture(swimmersAttributesTexture, (pixel + .5) / TEXTURE_SIZE);\n        return attributes.r > .5;\n    }\n\n\n    float gaussian(float x, float mean, float std) {\n        return exp(-(x - mean) * (x - mean) / (2. * std * std)) / (std * sqrt_2_PI);\n    }\n\n    float getRecordWave(vec2 coord) {\n        float z = poolSize.z * coord.y;\n        if (true || abs(z - wr) < 1.) {\n            return .2 * gaussian(z, wr, .4);\n        }\n        return 0.;\n    }\n\n    vec3 getDivingWaves(vec2 coord) {\n        vec3 res = vec3(0., 0., -1.);\n        \n        for (int i = 0; i < 10; i++) {\n            float i_float = float(i);\n            if (i_float > swimmersNumber - 0.1) break;\n            vec2 swimmerPos = getAttributePosition(i);\n            float swimmer_x = swimmerPos.x;\n            float swimmer_z = swimmerPos.y;\n            vec2 swimmerDiving = getAttributeDiving(i);\n            float divingDistance = swimmerDiving.x;\n            float divingTime = swimmerDiving.y;\n\n            float timeSinceDiving = time - divingTime;\n            const float rippleSpeed = .5;\n            const float maxTime = 10.;\n            const float lambda = 2. * PI / 0.6;\n            float frequency = 2.;\n            float omega = 2. * PI * frequency;\n            vec2 center = vec2(swimmer_x, divingDistance - poolSize.z / 2.);\n            vec2 pos = (coord - .5) * poolSize.xz;\n            vec2 diff = pos - center;\n            float d = sqrt(dot(diff, diff));\n            d*=2.;\n            \n            float r_max_max = 0.5;\n            float divingDistRange = 2.;\n            float divingDistMin = 2.;\n            float intensity = (divingDistance - divingDistMin) / divingDistRange;\n            float r_max = max(0.3, intensity * r_max_max);\n            float attenuationDist = r_max;\n            \n            float duration = 1.5;\n            float c =  cos(lambda * d - omega * timeSinceDiving);\n            float attenuation = exp(-d / attenuationDist - timeSinceDiving / duration);\n            bool condition = timeSinceDiving > d / frequency;\n            if (condition) res.x += .05 * attenuation * c;\n            if (c > 0.8 && condition) {\n                res.y = max(res.y, min(1., 15.*attenuation));\n                res.z = 1.;\n            }\n        }\n        return res;\n    }\n`\nexport { swimmersHelperFunctions };\nexport { Swimmer };","/*\n * WebGL Water\n * http://madebyevan.com/webgl-water/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\nimport GL from './lightgl.js';\nimport { Sphere } from './sphere.js';\nimport { Swimmer } from './swimmer.js';\nimport { swimmersHelperFunctions } from './swimmer.js';\nimport { params } from './params.js';\n\n// The data in the texture is (position.y, velocity.y, normal.x, normal.z)\nfunction Water(gl, resolution = null) {\n  this.gl = gl;\n  this.visualizationWavesEnabled = true;\n  this.sqrt_2_PI = Math.sqrt(2 * Math.PI);\n  /**@type {Sphere[]} */\n  this.spheres = [];\n  var vertexShader = `\n    out vec2 coord;\n    uniform vec2 invPoolSizeVertex;\n    void main() {\n      coord = gl_Vertex.xy * invPoolSizeVertex + 0.5;\n      gl_Position = vec4(gl_Vertex.xy * 2. * invPoolSizeVertex, 0., 1.0);\n    }\n  `;\n\n  this.reset(resolution);\n  if (!GL.Texture.canUseFloatingPointTextures()) {\n    //throw new Error('This demo requires the OES_texture_float extension');\n  }\n\n  this.dropShader = new GL.Shader(vertexShader, `\n    const float PI = 3.141592653589793;\n    uniform sampler2D tex;\n    uniform vec2 center;\n    uniform vec3 poolSize;\n    uniform float radius;\n    uniform float strength;\n    in vec2 coord;\n    out vec4 fragColor;\n    void main() {\n      /* get vertex info */\n      vec4 info = texture(tex, coord);\n      \n      /* add the drop to the height */\n      float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / (radius / poolSize.z));\n      drop = 0.5 - cos(drop * PI) * 0.5;\n      info.r += drop * strength;\n      \n      fragColor = info;\n    }\n  `);\n  this.updateShader = new GL.Shader(vertexShader, `\n    uniform sampler2D tex;\n    uniform vec2 delta;\n    uniform float wr;\n    uniform float prev_wr;\n    uniform float damping;\n    uniform float sqrt_2_PI;\n    uniform vec3 poolSize;\n    in vec2 coord;\n    out vec4 fragColor;\n    float gaussian(float x, float mean, float std) {\n    return exp(-(x - mean) * (x - mean) / (2. * std * std)) / (std * sqrt_2_PI);\n  }\n  void main() {\n      /* get vertex info */\n      vec4 info = texture(tex, coord);\n\n      /* calculate average neighbor height */\n      vec2 dx = vec2(delta.x, 0.0);\n      vec2 dy = vec2(0.0, delta.y);\n      float average = (\n      texture(tex, coord - dx).r +\n      texture(tex, coord - dy).r +\n      texture(tex, coord + dx).r +\n      texture(tex, coord + dy).r\n    ) * 0.25;\n\n    /* change the velocity to move toward the average */\n    info.g += (average - info.r) * 2.0;\n\n    /* attenuate the velocity a little so waves do not last forever */\n    info.g *= 1. - damping;/*TODO parametriser a*/\n\n    /* move the vertex along the velocity */\n    info.r += info.g;\n      \n\n    fragColor = info;\n  }\n  `);\n  this.normalShader = new GL.Shader(vertexShader, `\n    uniform sampler2D tex;\n    uniform vec2 delta;\n    in vec2 coord;\n    out vec4 fragColor;\n  void main() {\n      /* get vertex info */\n      vec4 info = texture(tex, coord);\n\n      /* update the normal */\n      vec3 dx = vec3(delta.x, texture(tex, vec2(coord.x + delta.x, coord.y)).r - info.r, 0.0);\n      vec3 dy = vec3(0.0, texture(tex, vec2(coord.x, coord.y + delta.y)).r - info.r, delta.y);\n    info.ba = normalize(cross(dy, dx)).xz;\n\n    fragColor = info;\n  }\n  `);\n  this.sphereShader = new GL.Shader(`\n    out vec2 coord;\n    uniform vec2 invPoolSizeVertex;\n    void main() {\n      coord = gl_Vertex.xy * invPoolSizeVertex + 0.5;\n      // displacement = texture(displacementTexture, coord).r;\n      // oldDisplacement = texture(oldDisplacementTexture, coord).r;\n\n      gl_Position = vec4(gl_Vertex.xy * 2. * invPoolSizeVertex, 0., 1.0);\n    }\n  `, `\n    uniform sampler2D tex;\n    \n    \n    uniform vec3 poolSize;\n    in vec2 coord;\n    uniform sampler2D oldDisplacementTexture;\n    uniform sampler2D displacementTexture;\n    uniform bool optimized;\n    uniform float radius;\n    uniform vec3 newCenter;\n    uniform vec3 oldCenter;\n\n    out vec4 fragColor;\n    \n    float volumeInSphere(vec3 center) {\n      vec3 toCenter = vec3((coord.x - 0.5) * poolSize.x, 0.0, (coord.y - 0.5) * poolSize.z) - center;\n      float t = length(toCenter) / radius;\n      float dy = exp(-pow(t * 1.5, 6.0));\n      float ymin = min(0.0, center.y - dy);\n      float ymax = min(max(0.0, center.y + dy), ymin + 2.0 * dy);\n    return (ymax - ymin) * 0.1;\n  }\n\n  void main() {\n\n  vec4 info = texture(tex, coord);\n  \n  if (optimized) {\n      float displacement = texture(displacementTexture, coord).r;\n      float oldDisplacement = texture(oldDisplacementTexture, coord).r;\n\n      \n      info.r += oldDisplacement - displacement;\n      fragColor = info;\n      return;\n    }\n\n    // /* add the old volume */\n    info.r += volumeInSphere(oldCenter);\n\n    // /* subtract the new volume */\n    info.r -= volumeInSphere(newCenter);\n\n    fragColor = info;\n  }\n  `);\n\n  this.visualizationWavesShader = new GL.Shader(vertexShader, `\n    uniform sampler2D tex;\n    uniform bool add;\n    uniform vec3 poolSize;\n    in vec2 coord;\n    out vec4 fragColor;\n\n    ` + swimmersHelperFunctions + `\n\n    void main() {\n      vec4 info = texture(tex, coord);\n      float w = getDivingWaves(coord).x + getRecordWave(coord);\n      info.r += add ? w : -w;\n      fragColor = info;\n    }\n    `);\n}\n\nWater.prototype.reset = function (resolution = null) {\n  this.WR_position = 100000;\n  this.prev_WR_position = 0;\n  if (resolution !== null) {\n    console.log(\"resolution.y : \" + resolution.y);\n    this.W = Math.round(resolution.x);\n    this.H = Math.round(resolution.y);\n    console.log(\"Using custom resolution:\", this.W, this.H);\n  } else {\n    this.W = 256;\n    this.H = 256;\n  }\n  Swimmer.reset(new GL.Vector(this.W, this.H));\n  //Swimmer.attributes.createRenderingTexture(this.W, this.H);\n  this.plane = GL.Mesh.plane({ detail: 255, width: params.simulation.poolSize.x, height: params.simulation.poolSize.z });\n  this.delta = new GL.Vector(1 / this.W, 1 / this.H);\n  /**@type {WebGLRenderingContext} */\n  const g = this.gl;\n  if (this.textureA) g.deleteTexture(this.textureA.id);\n  if (this.textureB) g.deleteTexture(this.textureB.id);\n  this.textureA = new GL.Texture(this.W, this.H, { type: this.gl.FLOAT, filter: filter });\n  this.textureB = new GL.Texture(this.W, this.H, { type: this.gl.FLOAT, filter: filter });\n  this.areaConservationTexture = new GL.Texture(this.W, this.H, { type: this.gl.FLOAT, filter: filter });\n  this.showAreaConservedGrid = false;\n  this.showProjectionGrid = false;\n\n  this.invPoolSize = new GL.Vector(1 / params.simulation.poolSize.x, 1 / params.simulation.poolSize.y, 1 / params.simulation.poolSize.z);\n  var filter = GL.Texture.canUseFloatingPointLinearFiltering() ? this.gl.LINEAR : this.gl.NEAREST;\n  if ((!this.textureA.canDrawTo() || !this.textureB.canDrawTo()) && GL.Texture.canUseHalfFloatingPointTextures()) {\n    console.log(\"No draw\");\n    filter = GL.Texture.canUseHalfFloatingPointLinearFiltering() ? this.gl.LINEAR : this.gl.NEAREST;\n    this.textureA = new GL.Texture(this.W, this.H, { type: this.gl.FLOAT, filter: filter });\n    this.textureB = new GL.Texture(this.W, this.H, { type: this.gl.FLOAT, filter: filter });\n  }\n};\n\nWater.prototype.addDrop = function (x, y, radius, strength) {\n  var this_ = this;\n  this.textureB.drawTo(function () {\n    this_.textureA.bind();\n    this_.dropShader.uniforms({\n      invPoolSizeVertex: [this_.invPoolSize.x, this_.invPoolSize.z],\n      center: [x, y],\n      radius: radius,\n      strength: strength,\n      poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z]\n    }).draw(this_.plane);\n  });\n  this.textureB.swapWith(this.textureA);\n};\n\n/**\n * \n * @param {boolean} add \n * @param {Swimmer[]} swimmers \n * @returns \n */\nWater.prototype.addOrRemoveVisualizationWaves = function (add, swimmers, raceTime) {\n  if (!this.visualizationWavesEnabled) return;\n  var this_ = this;\n\n  this.textureB.drawTo(function () {\n    this_.textureA.bind();\n    const swimmersAttributesTexture = Swimmer.getAttributesTexture();\n    if (swimmersAttributesTexture) swimmersAttributesTexture.bind(1);\n    this_.visualizationWavesShader.uniforms({\n      swimmersAttributesTexture: 1,\n      invPoolSizeVertex: [this_.invPoolSize.x, this_.invPoolSize.z],\n      poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n      wr: this_.WR_position,\n      sqrt_2_PI: this_.sqrt_2_PI,\n      add: add,\n      swimmersNumber: swimmers.length,\n      time: raceTime\n    }).draw(this_.plane);\n  });\n  this.textureB.swapWith(this.textureA);\n\n}\n\n/**\n * \n * @param {Swimmer} swimmer \n */\nWater.prototype.addSwimmer = function (swimmer) {\n  for (let sphere of swimmer.spheres) this.addSphere(sphere);\n}\n\nWater.prototype.addSphere = function (sphere) {\n  this.spheres.push(sphere);\n};\n\nWater.prototype.updateSpheres = function (dt) {\n  const speed = 2.4;\n  this.prev_WR_position = this.WR_position;\n  this.WR_position += dt * speed;\n  if (params.simulation.optimized) {\n    Swimmer.attributes.draw();\n\n    this.textureB.drawTo(() => {\n      this.textureA.bind();\n      Swimmer.bindDisplacementTexture(1);\n      Swimmer.bindOldDisplacementTexture(2);\n      this.sphereShader.uniforms({\n        oldDisplacementTexture: 2,\n        displacementTexture: 1,\n        invPoolSizeVertex: [this.invPoolSize.x, this.invPoolSize.z],\n        poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n        optimized: true\n      }).draw(this.plane);\n      this.textureB.swapWith(this.textureA);\n      Swimmer.attributes.draw();\n\n    })\n  }\n\n  else {\n    for (let i = 0; i < this.spheres.length; i++) {\n      const sphere = this.spheres[i];\n      this.moveSphere(sphere.oldCenter, sphere.center, sphere.radius);\n    }\n  }\n};\n\nWater.prototype.moveSphere = function (oldCenter, newCenter, radius) {\n  var this_ = this;\n  this.textureB.drawTo(function () {\n    this_.textureA.bind();\n    this_.sphereShader.uniforms({\n      invPoolSizeVertex: [this_.invPoolSize.x, this_.invPoolSize.z],\n      oldCenter: oldCenter,\n      newCenter: newCenter,\n      radius: radius,\n      poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n      optimized: false\n    }).draw(this_.plane);\n  });\n  this.textureB.swapWith(this.textureA);\n};\n\nWater.prototype.stepSimulation = function () {\n  var this_ = this;\n  this.textureB.drawTo(function () {\n    this_.textureA.bind();\n    this_.updateShader.uniforms({\n      invPoolSizeVertex: [this_.invPoolSize.x, this_.invPoolSize.z],\n      delta: [this_.delta.x, this_.delta.y],\n      wr: this_.WR_position,\n      prev_wr: this_.prev_WR_position,\n      poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n      sqrt_2_PI: this_.sqrt_2_PI,\n      damping: params.simulation.waterDamping\n    }).draw(this_.plane);\n  });\n  this.textureB.swapWith(this.textureA);\n\n  this.updateAreaConservation();\n};\n\nWater.prototype.updateNormals = function () {\n  var this_ = this;\n  this.textureB.drawTo(function () {\n    this_.textureA.bind();\n    this_.normalShader.uniforms({\n      invPoolSizeVertex: [this_.invPoolSize.x, this_.invPoolSize.z],\n      delta: [this_.delta.x, this_.delta.y]\n      // delta: [Math.max(this_.poolSize.x, this_.poolSize.z) / this_.poolSize.x / Math.max(this_.textureA.width, this_.textureA.height), Math.max(this_.poolSize.x, this_.poolSize.z) / this_.poolSize.z / Math.max(this_.textureA.width, this_.textureA.height)]\n    }).draw(this_.plane);\n  });\n  this.textureB.swapWith(this.textureA);\n};\n\n\nWater.prototype.updateAreaConservation = function () {\n\n  if (!params.visualizations.areaConservationEnabled) {\n    return;\n  }\n  var this_ = this;\n\n  var readType, readArrayType, readExt;\n  if (this.textureA.type === this.gl.FLOAT) {\n    readType = this.gl.FLOAT;\n    readArrayType = Float32Array;\n    readExt = 'EXT_color_buffer_float';\n  } else if (this.textureA.type === this.gl.HALF_FLOAT_OES) {\n    readType = this.gl.HALF_FLOAT_OES;\n    readArrayType = Uint16Array; // Assuming 4 components * 2 bytes each\n    readExt = 'EXT_color_buffer_half_float';\n  } else {\n    console.warn('Unsupported texture type for reading');\n    return;\n  }\n\n  if (!this.gl.getExtension(readExt)) {\n    console.warn(readExt + ' not available; cannot read pixels');\n    return;\n  }\n\n  // Create framebuffer if not exists\n  if (!this.fb) {\n    this.fb = this.gl.createFramebuffer();\n  }\n\n  // Attach textureA to framebuffer\n  this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, this.fb);\n  this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, this.gl.COLOR_ATTACHMENT0, this.gl.TEXTURE_2D, this.textureA.id, 0);\n\n  // Check framebuffer\n  const status = this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);\n  if (status !== this.gl.FRAMEBUFFER_COMPLETE) {\n    console.error('Framebuffer incomplete: ' + status + ' for texture type ' + this.textureA.type);\n    this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n    return;\n  }\n\n  // Read pixels\n  this.gl.pixelStorei(this.gl.PACK_ALIGNMENT, 1);\n  const readBuf = new readArrayType(this.W * this.H * 4);\n  // const writeBuf = new readArrayType(this.W * this.H * 4);\n  const writeBuf = new Float32Array(this.W * this.H * 4);\n  this.gl.readPixels(0, 0, this.W, this.H, this.gl.RGBA, readType, readBuf);\n  for (let i = 0; i < this.W; i++) {\n    writeBuf[i * 4 + 1] = 1.0;\n  }\n  // Example: modify and write back (only for float)\n  const dx_proj = params.simulation.poolSize.x / this.W;\n  const dz_proj = params.simulation.poolSize.z / this.H;\n  const dx_proj_sq = dx_proj * dx_proj;\n  const dz_proj_sq = dz_proj * dz_proj;\n  if (this.textureA.type === this.gl.FLOAT) {\n    // Increase red channel\n    for (let j = 0; j < this.H; j += 1) {\n      for (let i = 0; i < this.W; i += 1) {\n        const index = (j * this.W + i) * 4;\n        const indexAreaConservation = ((this.H - 1 - j) * this.W + i) * 4;\n        const x = writeBuf[indexAreaConservation];\n        const z = writeBuf[indexAreaConservation + 1];\n        if (i + 1 < this.W) {\n          const dy = readBuf[index] - readBuf[index + 4];\n          const dx = Math.sqrt(dy * dy + dx_proj_sq);\n          writeBuf[indexAreaConservation + 4] = x + dx;\n        }\n        if (j + 1 < this.H) {\n          const dy = readBuf[index] - readBuf[index + this.W * 4];\n          const dz = Math.sqrt(dy * dy + dz_proj_sq);\n          writeBuf[indexAreaConservation - 4 * this.W + 1] = z + dz;\n        }\n      }\n    }\n\n\n    // Write back to textureA\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.areaConservationTexture.id);\n    this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT, 1);\n    this.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, this.W, this.H, this.gl.RGBA, this.gl.FLOAT, writeBuf);\n  }\n\n  // Cleanup\n  this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n  this.gl.bindTexture(this.gl.TEXTURE_2D, null);\n};\n\nexport { Water };\n\n","const textHelperFunctions = `\n/*** Settings ***/\n\n#define FONT_TEXTURE iChannel0 // Set to the iChannel containing the alphabet texture\n\n#define FONT_SPACING 2.        // Horizontal character spacing [1 - 2.5]\n\nuniform sampler2D iChannel0;\n\n\n/* ### How to use this shader ? ###\n   \n   === Setup ===\n   \n   0. Copy the content of the \"Common\" tab inside your shader\n   1. Make sure the FONT_TEXTURE #define is set to the iChannel \n      containing the alphabet texture\n      \n      Also make sure the texture filter type is set to \"linear\"  \n      (not \"mipmap\", which creates horizontal lines between the characters)\n   \n   === Declare String ===\n   \n   2. Use makeStr to declare a new string (needs to be done outside any function)\n   3. Write your text using _ before each char, and __ for spaces\n   4. Finish your string with the _end keyword\n   \n       makeStr(printExample) _A _n _o _t _h _e _r __ _E _x _a _m _p _l _e    _end\n          \n   === Print String ===\n   \n   5. Call the new function by passing it your uvs. It returns a grayscale value.\n   \n       finalCol += printExample(uv);\n   \n   - Note that you are responsible for scaling/offsetting the uvs \n     to control the text placement before calling the function.\n   \n   - If you want to print float or integer variables, see below.\n   \n   \n   ###### Printing variables ######\n   \n   In order to print int & float variables, you can call two other functions instead of makeStr:\n   \n     - makeStrI (for integers) & makeStrF (for floats).\n     \n   [ IMPORTANT ]: When using makeStrI or makeStrF, you MUST use _endNum instead of _end \n                  to terminate a string.\n                  \n                  If you're seeing many errors when trying to compile, it's probably\n                  because you're using the wrong terminator for the current string type (_end/_endNum)\n   \n   === Declare Strings ===\n   \n   - In both cases, the variable will be displayed at the position of the _num_ keyword:\n   \n       makeStrI(print_my_int)   _M _y __ _I _n _t _e _g _e _r       _num_            _endNum\n       makeStrF(print_my_float) _F _l _o _a _t  _num_  _A _d _d _i _t _i _o _n _a _l _endNum\n   \n    - print_my_int   will be (vec2 uv, int num)\n    - print_my_float will be (vec2 uv, float num, int number_of_decimals)\n      \n   === Print Strings ===\n\n       print_my_int(uv, 42);          // will print \"My Integer 42\"\n       print_my_float(uv, 42.123, 2); // will print \"Float 42.12 Additional\"\n       \n    - A limitation of this version compared to the previous one is that you can only display\n      one variable per string definition (so only one _num_ keyword is allowed per string).\n   \n   === Debug variables without makeStr ===\n  \n   A handy thing you can do in your Image tab is to create \n   the following debugInt & debugFloat helpers:\n  \n       makeStrF(debugFloat) _num_ _endNum\n       makeStrI(debugInt) _num_ _endNum\n       \n   Defining these two helpers allow to quickly debug int/float variables, \n   without the need to create a full string definition every time using makeStr().\n \n      color += debugInt(uv, 42);\n      color += debugFloat(uv, 3.14, 2);\n \n \n   ### Characters available ###\n   \n   uppercase: _A _B _C ...\n   lowercase: _a _b _c ...\n   digits   : _0 _1 _2 ...\n   special  : _ADD _SUB _DOT ... (see \"Special Characters\" below)\n   \n   \n   ### Javascript string generator helper ###\n    \n    Even if this framework allow for easier string editing, it can still be a bit tedious to create\n    long strings with special characters, so I've also made a javascript function that you can run\n    in your developer console to easily create strings:\n\n    function createString(str) {\n        const special_chars = {\n            \" \": \"_\", \"!\": \"EX\", \"\\\"\":\"DBQ\", \"#\": \"NUM\", \"$\": \"DOL\", \"%\": \"PER\",  \"&\": \"AMP\", \n            \"\\'\":\"QT\", \"(\": \"LPR\", \")\": \"RPR\", \"*\": \"MUL\", \"+\": \"ADD\", \",\": \"COM\", \"-\": \"SUB\", \n            \".\": \"DOT\", \"/\": \"DIV\", \":\": \"COL\", \";\": \"SEM\", \"<\": \"LES\", \"=\": \"EQ\", \">\": \"GE\", \n            \"?\": \"QUE\", \"@\": \"AT\", \"[\": \"LBR\", \"\\\\\": \"ANTI\", \"]\": \"RBR\",  \"_\": \"UN\", \n        };\n        const num = str.indexOf('_num_');\n        const end = num == -1 ? ' _end' : ' _endNum';\n        str = str.replace('_num_', '').split('').map(e =>  '_' + (special_chars[e] || e));\n        if (num != -1) str = str.slice(0, num).concat( '_num_', str.slice(num));\n        return str.join(' ') + end;\n    }\n\n    Usage (static): \n        > createString(\"Hello World!\") \n        '_H _e _l _l _o __ _W _o _r _l _d _EX _end'\n           \n    Usage (variable): \n        > createString(\"My Number is _num_!\")\n        '_M _y __ _N _u _m _b _e _r __ _i _s __ _num_ _EX _endNum'\n*/\n\n// Special characters\n#define _STAR 28,\n#define __    32,\n#define _EX   33, // \" ! \"\n#define _DBQ  34, // \" \" \"\n#define _NUM  35, // \" # \"\n#define _DOL  36, // \" $ \"\n#define _PER  37, // \" % \"\n#define _AMP  38, // \" & \"\n#define _QT   39, // \" ' \"\n#define _LPR  40, // \" ( \"\n#define _RPR  41, // \" ) \"\n#define _MUL  42, // \" * \"\n#define _ADD  43, // \" + \"\n#define _COM  44, // \" , \"\n#define _SUB  45, // \" - \"\n#define _DOT  46, // \" . \"\n#define _DIV  47, // \" / \"\n#define _COL  58, // \" : \"\n#define _SEM  59, // \" ; \"\n#define _LES  60, // \" < \"\n#define _EQ   61, // \" = \"\n#define _GE   62, // \" > \"\n#define _QUE  63, // \" ? \"\n#define _AT   64, // \" @ \"\n#define _LBR  91, // \" [ \"\n#define _ANTI 92, // \" \\ \"\n#define _RBR  93, // \" ] \"\n#define _UN   95, // \" _ \"\n\n// Digits\n#define _0 48,\n#define _1 49,\n#define _2 50,\n#define _3 51,\n#define _4 52,\n#define _5 53,\n#define _6 54,\n#define _7 55,\n#define _8 56,\n#define _9 57,\n// Uppercase\n#define _A 65,\n#define _B 66,\n#define _C 67,\n#define _D 68,\n#define _E 69,\n#define _F 70,\n#define _G 71,\n#define _H 72,\n#define _I 73,\n#define _J 74,\n#define _K 75,\n#define _L 76,\n#define _M 77,\n#define _N 78,\n#define _O 79,\n#define _P 80,\n#define _Q 81,\n#define _R 82,\n#define _S 83,\n#define _T 84,\n#define _U 85,\n#define _V 86,\n#define _W 87,\n#define _X 88,\n#define _Y 89,\n#define _Z 90,\n// Lowercase\n#define _a 97,\n#define _b 98,\n#define _c 99,\n#define _d 100,\n#define _e 101,\n#define _f 102,\n#define _g 103,\n#define _h 104,\n#define _i 105,\n#define _j 106,\n#define _k 107,\n#define _l 108,\n#define _m 109,\n#define _n 110,\n#define _o 111,\n#define _p 112,\n#define _q 113,\n#define _r 114,\n#define _s 115,\n#define _t 116,\n#define _u 117,\n#define _v 118,\n#define _w 119,\n#define _x 120,\n#define _y 121,\n#define _z 122,\n\n// ======  utils  ======\n\n#define print_char(i) \\\n    texture(FONT_TEXTURE, u + vec2(float(i)-float(x)/FONT_SPACING + FONT_SPACING/8., 15-(i)/16) / 16.).r\n\n// ======  makeStr()  ======\n\n// Function start\n#define makeStr(func_name)                               \\\n    float func_name(vec2 u) {                            \\\n        if (u.x < 0. || abs(u.y - .03) > .03) return 0.; \\\n        const int[] str = int[](                         \\\n\n// Function end\n#define _end  0);                                        \\\n    int x = int(u.x * 16. * FONT_SPACING);               \\\n    if (x >= str.length()-1) return 0.;                  \\\n    return print_char(str[x]);                           \\\n}\n\n\n// -------------------------------------------------------------------\n//    If you only plan to display static characters (no variables) \n//    you don't need to include anything below this disclaimer\n// -------------------------------------------------------------------\n\n// ======  makeStrFloat() & makeStrInt() ======\n\n#define log10(x) int(ceil(.4342944819 * log(x + x*1e-5)))\n#define _num_ 0); const int[] str2 = int[]( \n\n// makeStrFloat() start\n#define makeStrF(func_name)                              \\\n    float func_name(vec2 u, float num, int dec) {        \\\n        if (u.x < 0. || abs(u.y - .03) > .03) return 0.; \\\n        const int[] str1 = int[](\n\n// makeStrInt() start\n#define makeStrI(func_name)                              \\\n    float func_name(vec2 u, int num_i) {                 \\\n        if (u.x < 0. || abs(u.y - .03) > .03) return 0.; \\\n        float num = float(num_i);                        \\\n        const int dec = -1;                              \\\n        const int[] str1 = int[](\n\n// makeStrFloat & makeStrInt end\n#define _endNum  0);                            \\\n    const int l1 = str1.length() - 1;           \\\n    int x = int(u.x * 16. * FONT_SPACING);      \\\n    if (x < l1) return print_char(str1[x]);     \\\n    int neg = 0;                                \\\n    if (num < 0.) {                             \\\n        if (x == l1) return print_char(45);     \\\n        num = abs(num);                         \\\n        neg = 1;                                \\\n    }                                           \\\n    int pre = neg + max(1, log10(num));         \\\n    int s2 = l1 + pre + dec + 1;                \\\n    if (x >= s2) {                              \\\n        if (x >= s2+str2.length()-1) return 0.; \\\n        int n2 = str2[x - s2];                  \\\n        return print_char(n2);                  \\\n    }                                           \\\n    float d = float(l1 + pre - x);              \\\n    if (d == 0.) return print_char(46);         \\\n    d = pow(10., d < 0.  ? ++d : d);            \\\n    int n = 48 + int(10.*fract(num/.999999/d)); \\\n    return print_char(n);                       \\\n}\n\n/* === Curious about how makeStrI() and makeStrF() work ? ===\n\nHere is a broken-down and commented version of the following syntax:\n\n    makeStrF(print_string_with_float) _H _e _l _l _o _num_ _W _o _r _l _d _endNum\n    \nThis will translate exactly to the following code:\n\nfloat print_string_with_float(vec2 u, float num, int decimals) \n{\n    if (u.x < 0. || abs(u.y - .03) > .03) return 0.;\n    \n    // The number (num) will be displayed between these two strings.\n    // The separation is handled by the #define \"_num_\"\n    const int[] str1 = int[]( _H _e _l _l _o  0);\n    const int[] str2 = int[]( _W _o _r _l _d  0);\n    \n    const int str1_length = str1.length() - 1;\n    \n    int x = int(u.x * 16. * SPACING);\n    \n    // Print char from 1st string (before number)\n    if (x < str1_length) {\n        int n1 = str1[x];\n        return print_char(n1);\n    }\n    \n    // Handle negative numbers\n    int is_negative = 0;\n    if (num < 0.) {        \n        // Print a minus sign\n        if (x == str1_length) return print_char(45);\n        \n        num = abs(num);\n        is_negative = 1;\n    }\n        \n    int digit_count = is_negative + max(1, log10(num)); // Number of characters before decimal point\n    int num_length  = digit_count + decimals + 1;       // Total number of characters for the number\n    int str2_start  = str1_length + num_length;\n    \n    // Print char from 2nd string (after number)\n    if (x >= str2_start) {\n        const int str2_length = str2.length() - 1;\n        int n2 = str2[x - str2_start];\n        if (x >= str2_start + str2_length) return 0.; // right bound\n        return print_char(n2);\n    }\n        \n    // Print the decmial separator (dot)\n    if (x == str1_length + digit_count) {\n        return print_char(46);\n    }\n    \n    // Get current digit\n    int digit_index = x - str1_length;\n    if (digit_index > digit_count) {\n        // Offset by 1 for digits located after the decimal point\n        digit_index--;\n    }\n    float exponent = float(digit_count - digit_index);\n    int n = 48 + int(10.*fract(num/.999999/pow(10., exponent)));\n        \n    // Print digit\n    return print_char(n);\n}\n*/\n`\n\nexport { textHelperFunctions };","/*\n * WebGL Water\n * http://madebyevan.com/webgl-water/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\nimport GL from './lightgl.js';\nimport { Swimmer } from './swimmer.js';\nimport { Water } from './water.js';\nimport { swimmersHelperFunctions } from './swimmer.js';\nimport { textHelperFunctions } from './renderText.js';\nimport { params } from './params.js';\n\nvar helperFunctions = `\n  const float IOR_AIR = 1.0;\n  const float IOR_WATER = 1.333;\n  const vec3 abovewaterColor = vec3(0.25, 1.0, 1.25);\n  const vec3 underwaterColor = vec3(0.4, 0.9, 1.0);\n  uniform vec3 light;\n  uniform vec3 sphereCenter;\n  uniform float sphereRadius;\n  uniform sampler2D tiles;\n  uniform sampler2D causticTex;\n  uniform sampler2D water;\n  uniform sampler2D areaConservationTexture;\n  uniform bool areaConservation;\n  uniform vec2 flagCenter;\n  uniform vec3 poolSize;\n  \n  vec2 intersectCube(vec3 origin, vec3 ray, vec3 cubeMin, vec3 cubeMax) {\n    vec3 tMin = (cubeMin - origin) / ray;\n    vec3 tMax = (cubeMax - origin) / ray;\n    vec3 t1 = min(tMin, tMax);\n    vec3 t2 = max(tMin, tMax);\n    float tNear = max(max(t1.x, t1.y), t1.z);\n    float tFar = min(min(t2.x, t2.y), t2.z);\n    return vec2(tNear, tFar);\n  }\n  \n  float intersectSphere(vec3 origin, vec3 ray, vec3 sphereCenter, float sphereRadius) {\n    vec3 toSphere = origin - sphereCenter;\n    float a = dot(ray, ray);\n    float b = 2.0 * dot(toSphere, ray);\n    float c = dot(toSphere, toSphere) - sphereRadius * sphereRadius;\n    float discriminant = b*b - 4.0*a*c;\n    if (discriminant > 0.0) {\n      float t = (-b - sqrt(discriminant)) / (2.0 * a);\n      if (t > 0.0) return t;\n    }\n    return 1.0e6;\n  }\n  \n  vec3 getSphereColor(vec3 point) {\n    vec3 color = vec3(0.5);\n    \n    /* ambient occlusion with walls */\n    color *= 1.0 - 0.9 / pow((1.0 + sphereRadius - abs(point.x) / (0.5*poolSize.x)) / sphereRadius, 3.0);\n    color *= 1.0 - 0.9 / pow((1.0 + sphereRadius - abs(point.z) / (0.5*poolSize.z)) / sphereRadius, 3.0);\n    color *= 1.0 - 0.9 / pow((point.y + 1.0 + sphereRadius) / sphereRadius, 3.0);\n    \n    /* caustics */\n    vec3 sphereNormal = (point - sphereCenter) / sphereRadius;\n    vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);\n    float diffuse = max(0.0, dot(-refractedLight, sphereNormal)) * 0.5;\n    vec2 coord = point.xz / poolSize.xz + 0.5;\n    vec4 info = texture(water, coord);\n    if (point.y < info.r) {\n      vec4 caustic = texture(causticTex, 0.75 * (point.xz - point.y * refractedLight.xz / refractedLight.y) / poolSize.xz + 0.5);\n      diffuse *= caustic.r * 4.0;\n    }\n    color += diffuse;\n    \n    return color;\n  }\n  \n  vec3 getWallColor(vec3 point) {\n    float scale = 0.5;\n    \n    vec3 wallColor;\n    vec3 normal;\n    if (abs(point.x) > poolSize.x * 0.5 - 0.01) {\n      wallColor = texture(tiles, point.yz * 0.5 + vec2(1.0, 0.5)).rgb;\n      normal = vec3(-point.x, 0.0, 0.0);\n    } else if (abs(point.z) > poolSize.z * 0.5 - 0.01) {\n      wallColor = texture(tiles, point.yx * 0.5 + vec2(1.0, 0.5)).rgb;\n      normal = vec3(0.0, 0.0, -point.z);\n    } else {\n      wallColor = texture(tiles, point.xz * 0.5 + 0.5).rgb;\n      normal = vec3(0.0, 1.0, 0.0);\n    }\n    \n    /*scale /= length(point) * 10;*/ /* pool ambient occlusion */\n    scale *= 1.0 - 0.9 / pow(length(point - sphereCenter) / sphereRadius, 4.0); /* sphere ambient occlusion */\n    \n    /* caustics */\n    vec3 refractedLight = -refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);\n    float diffuse = max(0.0, dot(refractedLight, normal));\n    vec4 info = texture(water, point.xz / poolSize.xz + 0.5);\n    if (point.y < info.r) {\n      vec4 caustic = texture(causticTex, 0.75 * (point.xz - point.y * refractedLight.xz / refractedLight.y) / poolSize.xz + 0.5);\n      scale += diffuse * caustic.r * 2.0 * caustic.g;\n    } else {\n      /* shadow for the rim of the pool */\n      vec2 t = intersectCube(point, refractedLight, vec3(-poolSize.x / 2., -poolSize.y, -poolSize.z / 2.), vec3(poolSize.x / 2., poolSize.y, poolSize.z / 2.));\n      diffuse *= 1.0 / (1.0 + exp(-200.0 / (1.0 + 10.0 * (t.y - t.x)) * (point.y + refractedLight.y * t.y - 2.0 / 12.0)));\n      \n      scale += diffuse * 0.5;\n    }\n    \n    return wallColor * scale;\n  }\n`;\n\nfunction Renderer(gl, water, flagCenter, flagSize) {\n  /**@type {Water} */\n  this.water = water;\n  this.gl = gl;\n  this.tileTexture = GL.Texture.fromImage(document.getElementById('tiles'), {\n    minFilter: this.gl.LINEAR_MIPMAP_LINEAR,\n    wrap: this.gl.REPEAT,\n    format: this.gl.RGB\n  });\n  this.franceTexture = GL.Texture.fromImage(document.getElementById('france'), {\n    minFilter: this.gl.LINEAR_MIPMAP_LINEAR,\n    wrap: this.gl.REPEAT,\n    format: this.gl.RGBA\n  });\n  this.chinaTexture = GL.Texture.fromImage(document.getElementById('china'), {\n    minFilter: this.gl.LINEAR_MIPMAP_LINEAR,\n    wrap: this.gl.REPEAT,\n    format: this.gl.RGBA\n  });\n  this.lettersTexture = GL.Texture.fromImage(document.getElementById('letters'), {\n    minFilter: this.gl.LINEAR,\n    magFilter: this.gl.LINEAR,\n    wrap: this.gl.REPEAT,\n    format: this.gl.RGBA\n  });\n  this.flagSize = flagSize;\n  this.flagSize = [1.5, 1.];\n  this.flagCenter = flagCenter;\n  this.lightDir = new GL.Vector(2.0, 2.0, -1.0).unit();\n  this.causticTex = new GL.Texture(1024, 1024);\n  this.waterShaders = [];\n  for (var i = 0; i < 2; i++) {\n    this.waterShaders[i] = new GL.Shader(`\n      uniform sampler2D water;\n      uniform vec3 poolSizeVertexShader;\n      out vec3 position;\n      void main() {\n        vec4 info = texture(water, gl_Vertex.xy / poolSizeVertexShader.xz + 0.5);\n        position = gl_Vertex.xzy;\n        position.y += info.r;\n        gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);\n      }\n    `, helperFunctions + `\n      uniform vec3 eye;\n      in vec3 position;\n      out vec4 fragColor;\n      uniform bool showFlags;\n      uniform samplerCube sky;\n      uniform bool showProjectionGrid;\n      uniform bool showAreaConservedGrid;\n      uniform sampler2D france;\n      uniform sampler2D china;\n      uniform vec2 flagSize;\n\n      uniform bool shadowEnabled;\n      uniform float shadowRadius;\n      uniform float shadowPower;\n      uniform bool showCircle;\n      uniform float shadowCircleRadius;\n      uniform float shadowCircleStroke;\n      \n      // Color declarations\n      #define RED     vec3( 1,.3,.4)\n      #define GREEN   vec3(.2, 1,.4)\n      #define BLUE    vec3(.2,.8, 1)\n      #define RAINBOW abs(cos(uv.x + vec3(5,6,1)))\n      \n      \n      ` + swimmersHelperFunctions + textHelperFunctions + `\n      makeStrF(printFrame) _num_ __ _k _m _DIV _h _endNum\n\n      makeStr(printStar) _STAR _end\n      \n      bool isOnConservedAreaGrid(vec2 pos, float size) {\n        vec2 gridCoord = pos / size;\n        return abs(fract(gridCoord.x) - 0.5) < 0.05 || abs(fract(gridCoord.y) - 0.5) < 0.05;\n      }\n      bool isInCircle(vec2 position, vec2 center, float R, float r) {\n        vec2 diff = position - center;\n        float dist_sq = dot(diff, diff);\n        return dist_sq < R*R && dist_sq > r*r;\n      }\n      vec3 getSurfaceRayColor(vec3 origin, vec3 ray, vec3 waterColor) {\n        vec3 color;\n        float q = intersectSphere(origin, ray, sphereCenter, sphereRadius);\n        if (q < 1.0e6) {\n          color = getSphereColor(origin + ray * q);\n        } else if (ray.y < 0.0) {\n          vec2 t = intersectCube(origin, ray, vec3(-poolSize.x / 2., -poolSize.y, -poolSize.z / 2.), vec3(poolSize.x / 2., poolSize.y, poolSize.z / 2.));\n          color = getWallColor(origin + ray * t.y);\n        } else {\n          vec2 t = intersectCube(origin, ray, vec3(-poolSize.x / 2., -poolSize.y, -poolSize.z / 2.), vec3(poolSize.x / 2., poolSize.y, poolSize.z / 2.));\n          vec3 hit = origin + ray * t.y;\n          if (hit.y < 2.0 / 12.0) {\n            color = getWallColor(hit);\n          } else {\n            color = texture(sky, ray).rgb;\n            color += vec3(pow(max(0.0, dot(light, ray)), 5000.0)) * vec3(10.0, 8.0, 6.0);\n          }\n        }\n        if (ray.y < 0.0) {\n          color *= waterColor;\n          vec2 position = origin.xz;\n          vec2 projectedPosition = position;\n          if (!showFlags) return color;\n          vec2 coord = position / poolSize.xz + .5;\n          vec3 divingWave = getDivingWaves(coord);\n          if (divingWave.z > 0.) {\n            color = (1. - divingWave.y) * color + divingWave.y * vec3(0., 1., 0.);\n          }\n          for (int i = 0; i < 10; i++) {\n            float i_float = float(i);\n            if (i_float > swimmersNumber - 0.1) break;\n            vec2 swimmerPos = getAttributePosition(i);\n            float swimmer_x = swimmerPos.x;\n            float swimmer_z = swimmerPos.y;\n            vec2 flagCenterNew = vec2(swimmer_x, swimmer_z - 2.5);\n            vec2 flagCorner = flagCenterNew - flagSize / 2.;\n            if (showProjectionGrid && isOnConservedAreaGrid(position, 0.1)) color = vec3(1., 1., 0.); /* Debug conserved area grid */\n            if (abs(origin.z + poolSize.z / 2. - wr) < .05) color = vec3(1., 1., 0.); \n            if (areaConservation) {\n              vec2 coord = origin.xz / poolSize.xz + 0.5;\n              position = texture(areaConservationTexture, coord).xy;\n              flagCorner = texture(areaConservationTexture, flagCorner / poolSize.xz + 0.5).xy;\n            }\n            if (showAreaConservedGrid && isOnConservedAreaGrid(position, 0.1)) color = vec3(1., 0., 0.); /* Debug conserved area grid */\n            vec2 posFlag = position - flagCorner - flagSize / 2.;/*Fixes the corner of the flag on the XZ plane*/\n            vec2 flagCoord = posFlag / flagSize + 0.5;\n            if (abs(posFlag.x) <= flagSize.x / 2. && abs(posFlag.y) <= flagSize.y / 2.) {\n              vec3 flagColor;\n              if(getNationality(i) < .5) flagColor = texture(france, vec2(1.-flagCoord.y,1.- flagCoord.x)).xyz;\n              else flagColor = texture(china, vec2(1.-flagCoord.y,1.- flagCoord.x)).xyz;\n              color = flagColor;\n              float delta = .1;\n              vec2 delta_tex = vec2(delta, delta) / flagSize;\n              if (min(flagCoord.y, 1.- flagCoord.y) <= delta_tex.y \n                || min(flagCoord.x, 1. - flagCoord.x) <= delta_tex.x) color = vec3(1., 1., 1.);\n            }\n            vec2 letterCoord = flagCoord.yx;\n            letterCoord = vec2(-.5, .75) - letterCoord;\n            letterCoord /= 10.;\n            vec3 letterColor = GREEN/.4 * printFrame(letterCoord, getAttributeSpeed(i), 2);\n            if (max(letterColor.r, max(letterColor.g, letterColor.b)) > .3) color = letterColor;\n            \n            if (isFirst(i)) {\n              vec2 starCoord = letterCoord + vec2(.35, 0.);\n              // vec2 uv = starCoord * 50.;\n              vec3 starColor = vec3(1., 1., 0.) * printStar(starCoord);\n              if (max(starColor.r, max(starColor.g, starColor.b)) > .1) color = starColor;\n            }\n            \n            float altitude = getAltitude(i);\n            if (!shadowEnabled || abs(altitude) < .15) continue;\n            vec2 diff = (projectedPosition - swimmerPos);\n            vec2 diffNormalized = diff/shadowRadius;\n            float distSq = dot(diffNormalized, diffNormalized);\n            float attenuation = min(1., pow(distSq, shadowPower));\n            float altitudeAttenuation = min(1., abs(altitude));\n            attenuation = 1.-(1.-attenuation)*altitudeAttenuation;\n            color *= attenuation;\n            if (!showCircle) continue;\n            distSq = dot(diff, diff);\n            color += max(0.,1.-abs((shadowCircleRadius - distSq)/shadowCircleStroke)) * vec3(1., 1., 0.) * altitudeAttenuation;\n          }\n        }\n        return color;\n      }\n      \n      void main() {\n        vec2 coord = position.xz / poolSize.xz + 0.5;\n        vec4 info = texture(water, coord);\n        /* make water look more \"peaked\" */\n        /*for (int i = 0; i < 5; i++) {\n          coord += info.ba * 0.005;\n          info = texture(water, coord);\n        }*/\n        \n        vec3 normal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);\n        vec3 incomingRay = normalize(position - eye);\n        \n        ` + (i ? /* underwater */ `\n          normal = -normal;\n          vec3 reflectedRay = reflect(incomingRay, normal);\n          vec3 refractedRay = refract(incomingRay, normal, IOR_WATER / IOR_AIR);\n          float fresnel = mix(0.5, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));\n          \n          vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, underwaterColor);\n          vec3 refractedColor = getSurfaceRayColor(position, refractedRay, vec3(1.0)) * vec3(0.8, 1.0, 1.1);\n          \n          fragColor = vec4(mix(reflectedColor, refractedColor, (1.0 - fresnel) * length(refractedRay)), 1.0);\n        ` : /* above water */ `\n          vec3 reflectedRay = reflect(incomingRay, normal);\n          vec3 refractedRay = refract(incomingRay, normal, IOR_AIR / IOR_WATER);\n          float fresnel = mix(0.25, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));\n          \n          vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, abovewaterColor);\n          vec3 refractedColor = getSurfaceRayColor(position, refractedRay, abovewaterColor);\n          \n          fragColor = vec4(mix(refractedColor, reflectedColor, fresnel), 1.0);\n        `) + `\n      }\n    `);\n  }\n  this.sphereMesh = GL.Mesh.sphere({ detail: 10 });\n  this.sphereShader = new GL.Shader(helperFunctions + `\n    out vec3 position;\n  void main() {\n    position = sphereCenter + gl_Vertex.xyz * sphereRadius;\n    gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);\n  }\n  `, helperFunctions + `\n    in vec3 position;\n    out vec4 fragColor;\n  void main() {\n    fragColor = vec4(getSphereColor(position), 1.0);\n      vec4 info = texture(water, position.xz / poolSize.xz + 0.5);\n    if (position.y < info.r) {\n      fragColor.rgb *= underwaterColor * 1.2;\n    }\n  }\n  `);\n  this.reset();\n  this.cubeShader = new GL.Shader(helperFunctions + `\n    out vec3 position;\n  void main() {\n    position = gl_Vertex.xyz;\n    position.y = ((1.0 - position.y) * (7.0 / 12.0) - 1.0) * poolSize.y;\n    gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);\n  }\n  `, helperFunctions + `\n    in vec3 position;\n    out vec4 fragColor;\n  void main() {\n    fragColor = vec4(getWallColor(position), 1.0);\n      vec4 info = texture(water, position.xz / poolSize.xz + 0.5);\n    if (position.y < info.r) {\n      fragColor.rgb *= underwaterColor * 1.2;\n    }\n  }\n  `);\n  this.sphereCenter = new GL.Vector();\n  this.sphereRadius = 0;\n  var hasDerivatives = !!this.gl.getExtension('OES_standard_derivatives');\n  this.causticsShader = new GL.Shader(helperFunctions + `\n    out vec3 oldPos;\n    out vec3 newPos;\n    out vec3 ray;\n\n    /* project the ray onto the plane */\n    vec3 project(vec3 origin, vec3 ray, vec3 refractedLight) {\n      vec2 tcube = intersectCube(origin, ray, vec3(-poolSize.x / 2., -poolSize.y, -poolSize.z / 2.), vec3(poolSize.x / 2., poolSize.y, poolSize.z / 2.));\n    origin += ray * tcube.y;\n      float tplane = (-origin.y - 1.0) / refractedLight.y;\n    return origin + refractedLight * tplane;\n  }\n\n  void main() {\n      vec2 coord = gl_Vertex.xy / poolSize.xz + 0.5;\n      vec4 info = texture(water, coord);\n    info.ba *= 0.5;\n      vec3 normal = vec3(info.b, sqrt(1.0 - dot(info.ba, info.ba)), info.a);\n\n      /* project the vertices along the refracted vertex ray */\n      vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);\n    ray = refract(-light, normal, IOR_AIR / IOR_WATER);\n    oldPos = project(gl_Vertex.xzy, refractedLight, refractedLight);\n    newPos = project(gl_Vertex.xzy + vec3(0.0, info.r, 0.0), ray, refractedLight);\n\n    gl_Position = vec4(0.75 * (newPos.xz + refractedLight.xz / refractedLight.y), 0.0, 1.0);\n  }\n  `, (hasDerivatives ? '#extension GL_OES_standard_derivatives: enable\\n' : '') + `\n  ` + helperFunctions + `\n    in vec3 oldPos;\n    in vec3 newPos;\n    in vec3 ray;\n    out vec4 fragColor;\n\n  void main() {\n    ` + (hasDerivatives ? `\n        /* if the triangle gets smaller, it gets brighter, and vice versa */\n        float oldArea = length(dFdx(oldPos)) * length(dFdy(oldPos));\n        float newArea = length(dFdx(newPos)) * length(dFdy(newPos));\n    fragColor = vec4(oldArea / newArea * 0.2, 1.0, 0.0, 0.0);\n    ` : `\n    fragColor = vec4(0.2, 0.2, 0.0, 0.0);\n    ` ) + `\n      \n      vec3 refractedLight = refract(-light, vec3(0.0, 1.0, 0.0), IOR_AIR / IOR_WATER);\n\n      /* compute a blob shadow and make sure we only draw a shadow if the player is blocking the light */\n      vec3 dir = (sphereCenter - newPos) / sphereRadius;\n      vec3 area = cross(dir, refractedLight);\n      float shadow = dot(area, area);\n      float dist = dot(dir, -refractedLight);\n    shadow = 1.0 + (shadow - 1.0) / (0.05 + dist * 0.025);\n    shadow = clamp(1.0 / (1.0 + exp(-shadow)), 0.0, 1.0);\n    shadow = mix(1.0, shadow, clamp(dist * 2.0, 0.0, 1.0));\n    fragColor.g = shadow;\n\n      /* shadow for the rim of the pool */\n      vec2 t = intersectCube(newPos, -refractedLight, vec3(-poolSize.x / 2., -poolSize.y, -poolSize.z / 2.), vec3(poolSize.x / 2., poolSize.y, poolSize.z / 2.));\n    fragColor.r *= 1.0 / (1.0 + exp(-200.0 / (1.0 + 10.0 * (t.y - t.x)) * (newPos.y - refractedLight.y * t.y - 2.0 / 12.0)));\n  }\n  `);\n}\nRenderer.prototype.reset = function () {\n  this.cubeMesh = GL.Mesh.cube({ width: params.simulation.poolSize.x, height: 2., depth: params.simulation.poolSize.z });\n  // this.cubeMesh = GL.Mesh.cube();\n  this.cubeMesh.triangles.splice(4, 2);\n  this.cubeMesh.compile();\n};\n\nRenderer.prototype.updateCaustics = function (water) {\n  return;\n  if (!this.causticsShader) return;\n  var this_ = this;\n  this.causticTex.drawTo(function () {\n    this_.gl.clear(this_.gl.COLOR_BUFFER_BIT);\n    water.textureA.bind(0);\n    this_.causticsShader.uniforms({\n      light: this_.lightDir,\n      water: 0,\n      sphereCenter: this_.sphereCenter,\n      sphereRadius: this_.sphereRadius,\n      poolSize: [water.poolSize.x, water.poolSize.y, water.poolSize.z]\n    }).draw(water.plane);\n  });\n};\n\n/**\n * \n * @param {Water} water \n * @param {*} sky \n * @param {Swimmer[]} swimmers \n */\nRenderer.prototype.renderWater = function (water, sky, swimmers, raceTime, shadowParams) {\n  var tracer = new GL.Raytracer();\n  water.textureA.bind(0);\n  this.tileTexture.bind(1);\n  sky.bind(2); // TODO make a skybox from the ceiling of a swimming pool\n  this.causticTex.bind(3);\n  this.franceTexture.bind(4); // TODO make the texture work\n  this.chinaTexture.bind(8);\n  this.lettersTexture.bind(7);\n  water.areaConservationTexture.bind(5);\n  const swimmersAttributesTexture = Swimmer.getAttributesTexture();\n  if (swimmersAttributesTexture) swimmersAttributesTexture.bind(6);\n  this.gl.enable(this.gl.CULL_FACE);\n\n  for (var i = 0; i < 2; i++) {\n    this.gl.cullFace(i ? this.gl.BACK : this.gl.FRONT);\n    this.waterShaders[i].uniforms({\n      light: this.lightDir,\n      water: 0,\n      tiles: 1,\n      sky: 2,\n      causticTex: 3,\n      france: 4,\n      china: 8,\n      areaConservationTexture: 5,\n      swimmersAttributesTexture: 6,\n      iChannel0: 7,\n      areaConservation: params.visualizations.areaConservationEnabled,\n      flagSize: [1.5, 2.],\n      flagCenter: [this.flagCenter.x, this.flagCenter.y],\n      poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n      poolSizeVertexShader: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n      eye: tracer.eye,\n      sphereCenter: this.sphereCenter,\n      sphereRadius: this.sphereRadius,\n      showProjectionGrid: water.showProjectionGrid,\n      showAreaConservedGrid: water.showAreaConservedGrid,\n      wr: water.WR_position,\n      swimmersNumber: swimmers.length,\n      showFlags: params.visualizations.showFlags,\n      time: raceTime,\n      shadowEnabled: shadowParams.enabled,\n      shadowRadius: shadowParams.shadowRadius,\n      shadowPower: shadowParams.shadowPower,\n      showCircle: shadowParams.showCircle,\n      shadowCircleRadius: shadowParams.circleRadius,\n      shadowCircleStroke: shadowParams.circleStroke\n    }).draw(water.plane);\n  }\n  this.gl.disable(this.gl.CULL_FACE);\n};\n\n/**\n * \n * @param {Water} water \n */\nRenderer.prototype.renderSpheres = function (water) {\n  for (let sphere of water.spheres) {\n    this.renderSphere(water, sphere);\n  }\n};\n\n/**\n * \n * @param {Water} water \n * @param {Sphere} sphere \n */\nRenderer.prototype.renderSphere = function (water, sphere) {\n  water.textureA.bind(0);\n  this.causticTex.bind(1);\n  this.sphereShader.uniforms({\n    light: this.lightDir,\n    water: 0,\n    causticTex: 1,\n    sphereCenter: [sphere.center.x, sphere.center.y, sphere.center.z],\n    sphereRadius: sphere.radius,\n    poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n  }).draw(sphere.mesh);\n};\n\nRenderer.prototype.renderSphereOld = function (water) {\n  water.textureA.bind(0);\n  this.causticTex.bind(1);\n  this.sphereShader.uniforms({\n    light: this.lightDir,\n    water: 0,\n    causticTex: 1,\n    sphereCenter: this.sphereCenter,\n    sphereRadius: this.sphereRadius,\n    poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n  }).draw(this.sphereMesh);\n};\n\nRenderer.prototype.renderCube = function (water) {\n  this.gl.enable(this.gl.CULL_FACE);\n  water.textureA.bind(0);\n  this.tileTexture.bind(1);\n  this.causticTex.bind(2);\n  this.cubeShader.uniforms({\n    light: this.lightDir,\n    water: 0,\n    tiles: 1,\n    causticTex: 2,\n    sphereCenter: this.sphereCenter,\n    sphereRadius: this.sphereRadius,\n    poolSize: [params.simulation.poolSize.x, params.simulation.poolSize.y, params.simulation.poolSize.z],\n  }).draw(this.cubeMesh);\n  this.gl.disable(this.gl.CULL_FACE);\n};\n\nexport { Renderer };","/*\n * WebGL Water\n * http://madebyevan.com/webgl-water/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\nfunction Cubemap(images, gl) {\n    this.gl = gl;\n    this.id = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this.id);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_X, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.xneg);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.xpos);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Y, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.yneg);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Y, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.ypos);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_NEGATIVE_Z, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.zneg);\n    gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_Z, 0, gl.RGB, gl.RGB, gl.UNSIGNED_BYTE, images.zpos);\n}\n\nCubemap.prototype.bind = function (unit) {\n    this.gl.activeTexture(this.gl.TEXTURE0 + (unit || 0));\n    this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP, this.id);\n};\n\nCubemap.prototype.unbind = function (unit) {\n    this.gl.activeTexture(this.gl.TEXTURE0 + (unit || 0));\n    this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP, null);\n};\n\nexport { Cubemap };\n","import GL from \"./lightgl.js\";\nimport { params } from \"./params.js\";\nimport { Swimmer } from \"./swimmer.js\";\nimport { swimmersHelperFunctions } from \"./swimmer.js\";\n\nconst MAX_SPARKS = 200;\n\nexport { MAX_SPARKS };\n\nconst sparksHelper = `\n/// The amount of 'sparks' to use (spark count between about 73-206 is known to crash Win7/Chrome)\nuniform float iTime;\nuniform vec2 iResolution;\nuniform float sparksGlow;\nuniform float sparksLengthFactor;\nuniform float sparksGlowOffset;\nuniform float sparksStroke;\nuniform float sparksNumber;\nuniform float sparksSizeFactor;\nuniform float fov;\n#define MAX_SPARKS ` + MAX_SPARKS + `\n/// The amount of 'sparks' to use (spark count between about 73-206 is known to crash Win7/Chrome)\n#define SPARKS 40    // Low-end\n//#define SPARKS 100   // Low-mid\n//#define SPARKS 210   // Mid-high (recommended)\n//#define SPARKS 500   // High\n//#define SPARKS 1000  // Really High\n//#define SPARKS 2000  // Insane\n\n/// Switch between defines to choose different sets of settings\n//#define ORIGINAL_SPARKS\n//#define WATER_SPOUT\n#define FIRE_STREAM\n//#define STAR_BOMB\n//#define WATER_LINE\n\n#define SIZE_FACTOR 50.\n\n#define BRIGHTNESS 1.0   /// 0.0 == auto-brightness\n\n#ifdef ORIGINAL_SPARKS\n\t#define SPEED_FACTOR 1.5\n\t#define LENGTH_FACTOR 0.6\n\t#define GROUP_FACTOR 1.0\n\t#define SPREAD_FACTOR 0.3\n\t#define MIN_ANGLE 0.1\n\t#define RAND_FACTOR 1.0\n#endif\n\n#ifdef WATER_SPOUT\n\t#define SPEED_FACTOR 1.5\n\t#define LENGTH_FACTOR 1.5\n\t#define GROUP_FACTOR 0.5\n\t#define SPREAD_FACTOR 0.1\n\t#define MIN_ANGLE 0.1\n\t#define RAND_FACTOR 1.0\n\t#define BLUE\n#endif\n\n#ifdef FIRE_STREAM\n\t#define SPEED_FACTOR 1.5\n\t#define LENGTH_FACTOR 1.5\n\t#define GROUP_FACTOR 1.0\n\t#define SPREAD_FACTOR 0.1\n\t#define MIN_ANGLE 0.1\n\t#define RAND_FACTOR 0.0\n#endif\n\n#ifdef STAR_BOMB\n\t#define SPEED_FACTOR 0.5\n\t#define LENGTH_FACTOR 0.2\n\t#define GROUP_FACTOR 1.0\n\t#define SPREAD_FACTOR 0.2\n\t#define MIN_ANGLE 0.3\n\t#define RAND_FACTOR 0.0\n\t#define DOT_SPREAD\n#endif\n\n#ifdef WATER_LINE\n\t#define SPEED_FACTOR 1.5\n\t#define LENGTH_FACTOR 1.5\n\t#define GROUP_FACTOR 0.7\n\t#define SPREAD_FACTOR 0.1\n\t#define MIN_ANGLE 0.1\n\t#define RAND_FACTOR 1.0\n\t#define LINEAR_SPREAD\n\t#define BLUE\n#endif\n\nconst float brightness = (float(BRIGHTNESS) == 0.0) ? 200.0 / (float(SPARKS) + 40.0) : float(BRIGHTNESS);\n\nvec3 sampleAngle(float u1) {\n\tfloat r = sqrt(u1);\n\treturn r * sparkDirection -sqrt(1.0 - u1) * waterNormal;\n\treturn r * sparkDirection + vec3(0., -sqrt(1.0 - u1), 0.);\n\treturn vec3(-r * -0.809017, -sqrt(1.0 - u1), r * 0.587785);\n}\n\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n}\n\nfloat spread(vec2 co) {\n#ifdef LINEAR_SPREAD\n\treturn fract(co.x * 0.618033988749895);\n#else\n\t#ifdef DOT_SPREAD\n\t\treturn fract(co.x * 1.0);\n\t#else\n    \treturn fract(sin(dot(co.xy, vec2(12.9898,78.233))) * 43758.5453);\n\t#endif\n#endif\n}\n\nfloat planeIntersection(vec3 rpos, vec3 rdir, vec3 n) {\n\treturn -dot(n, rpos) / dot(rdir, n);\n}\n\nfloat cylinder(vec3 pos, vec3 dir, float len) {\n\tfloat x = dot(pos, dir);\n\treturn max(max(length(pos - dir * x) - sparksStroke, x), -x-len);\n}\n\nvec4 color(float age) {\n\tfloat f = 1.0 - age * 0.05;\n\t#ifdef BLUE\n\treturn vec4(0.2*f*f, 0.5*f*f+0.05, 0.5*f+0.4, min(f*2.0, 1.0));\n\t#else\n\treturn vec4(0.5*f+0.4, 0.5*f*f+0.05, 0.2*f*f, min(f*2.0, 1.0));\n\t#endif\n}\n\nvec3 trace(vec3 rpos, vec3 rdir, vec2 fragCoord, vec3 center, float reactionTime) {\n    // center *= 0.;\n\n\tfloat sparkT = planeIntersection(rpos - center, rdir, sparkPlaneNormal);\n\tfloat floorT = planeIntersection(rpos - center, rdir, waterNormal);\n\n\t// float sparkT = planeIntersection(rpos - center, rdir, vec3(0.587785, 0.0, -0.809017));\n\t// float floorT = planeIntersection(rpos - center, rdir, vec3(0., 1., 0.));\n\t\n\tvec4 col = vec4(0.0, 0.0, 0.0, rdir.y < 0.0 ? 1.0 : 1.0);\n\tvec3 sparkCol = vec3(0.0, 0.0, 0.0);\n\t\n\tvec3 floorPos = rpos + rdir * floorT;\n\tvec3 sparkPos = rpos + rdir * sparkT;\n\n    float maxSparksSubstraction = 3.*sparksNumber / 4.;\n\n    float attenuation = min(.9, (reactionTime - .1) / .2);\n\n    float sizeFactor =  sparksSizeFactor / (1. - attenuation);\n\n    float sparksSubstraction = maxSparksSubstraction * attenuation;\n\t\n\tfloat time = iTime * SPEED_FACTOR;\n    if (time < 0. || time > 2. ) return vec3(0., 0., 0.);\n\tfor (int i = 0; i < MAX_SPARKS; i++)\n\t{\n        float float_i = float(i);\n        if (float_i >= sparksNumber - sparksSubstraction) break;\n\t\t// Calculate spark position and velocity\n\t\tfloat a = spread(vec2(i, 1.0))*SPREAD_FACTOR+MIN_ANGLE;\n\t\tfloat b = spread(vec2(i, 3.0))*RAND_FACTOR;\n\t\tfloat startTime = spread(vec2(i, 5.0)) * GROUP_FACTOR;\n\t\tvec3 dir = sampleAngle(a) * 10.0 * (1. - attenuation);\n        vec3 gravity = -1.2 * 2. * waterNormal / sizeFactor;\n\t\n\t\tvec3 start = -dir * (1.35 + b * 0.3) / sizeFactor;\n\t\tvec3 force = start * 0.02 + gravity;\n\n\t\tfloat c = (time + startTime) * 20.0;\n        if (c > 20.) break;\n\t\tvec3 offset = center + start * c + force * c * c * 0.5;\n        bool visible = true;\n        if (dot(offset - center, waterNormal) < 0.) {\n            visible = false;\n        }\n\t\t\n\t\tvec3 v = start + force * c;\n\t\tfloat vel = length(v) * sparksLengthFactor;\n\t\tvec3 vdir = normalize(v);\n\t\tvec4 sc = color(c);\n\t\t\t\t\n\t\t// Shade floor\n\t\tif (true || rdir.y < 0.0) {\n\t\t\tvec3 spos = floorPos - offset;\n\t\t\tfloat h = cylinder(spos, vdir, vel);\n\t\t\t\t\t\t\n\t\t\tfloat invRad = 10.0;\n\t\t\tfloat dist = h * 0.5;\n\t\t\tfloat atten = 1.0 / (1.0 + 2.0 * invRad * dist + invRad * invRad * dist * dist);\n\t\t\tif (floorT <= sparkT && sparkT > 0.0) {\n\t\t\t\tdist += 0.8;\n\t\t\t\tatten += 1.0 / (1.0 + 100.0*dist*dist*dist);\n\t\t\t}\n            atten /= sizeFactor;\n\t\t\tcol += vec4(sc.xyz * sc.w * atten, 0.0) * brightness;\n\t\t}\n\t\n\t\t// Shade sparks\n\t\tif (visible) {\n\t\t\tvec3 spos = sparkPos - offset;\t\t\t\n\t\t\tfloat h = cylinder(spos, vdir, vel);\n\t\t\t\t\n\t\t\tif (h < 0.0) {\n\t\t\t\tsparkCol += vec3(sc.xyz * sc.w);\n\t\t\t} else {\n\t\t\t\tfloat dist = h * 0.05 * sizeFactor + sparksGlowOffset;\n\t\t\t\tfloat atten = 1.0 / (1.0 + 100.0 * pow(dist, sparksGlow));\n\t\t\t\tsparkCol += sc.xyz * sc.w * (atten);\n\t\t\t\t// sparkCol += sc.xyz * sc.w * (atten + clamp(1.0 - h * sparkT * 0.05, 0.0, 1.0));\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvec3 final =  col.xyz + sparkCol * brightness;\n\treturn final + vec3(rand(vec2(fragCoord.x * fragCoord.y, iTime))) * 0.000002;\n\treturn final + vec3(rand(vec2(fragCoord.x * fragCoord.y, iTime))) * 0.00002;\n\treturn final + vec3(rand(vec2(fragCoord.x * fragCoord.y, iTime))) * 0.002;\n}\n\n// Ray-generation\nvec3 sparks(vec2 px, vec3 offset, float reactionTime) {\n\tvec2 rd = (px / iResolution.yy - vec2(iResolution.x/iResolution.y*0.5-0.5, 0.0)) * 2.0 - 1.0;\n    rd *= -1.;\n    float d = 1. / tan(fov / 2.); // TODO pre compute this before shader\n\tvec3 rdir = normalize(vec3(rd.x , rd.y, d));\n    vec3 center = (gl_ModelViewMatrix * vec4(offset, 1.)).xyz;\n\treturn pow(trace(vec3(0., 0., 0.), rdir, px, center, reactionTime), vec3(0.4545));\n}\n\n`;\n\n//\n// start here\n//\nclass Video {\n    constructor(gl, src) {\n        /**@type {WebGLRenderingContext} */\n        this.gl = gl\n        this.copyVideo = false;\n        this.show = false;\n        // Only continue if WebGL is available and working\n        if (gl === null) {\n            alert(\n                \"Unable to initialize WebGL. Your browser or machine may not support it.\"\n            );\n            return;\n        }\n        // Set clear color to black, fully opaque\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        // Clear the color buffer with specified clear color\n        gl.clear(gl.COLOR_BUFFER_BIT);\n\n        // Vertex shader program\n\n        this.shader = new GL.Shader(`\n    out highp vec2 vTextureCoord;\n    out vec3 waterNormal;\n    out vec3 sparkPlaneNormal;\n    out vec3 sparkDirection;\n\n    void main(void) {\n        gl_Position = vec4(gl_Vertex.xz, 0., 1.);\n        waterNormal = (gl_ModelViewMatrix * vec4(0., 1., 0., 0.)).xyz;\n        sparkPlaneNormal = (gl_ModelViewMatrix * vec4(-1., 0., 0., 0.)).xyz;\n        sparkDirection = (gl_ModelViewMatrix * vec4(0., 0., 1., 0.)).xyz;\n        vTextureCoord = gl_TexCoord.st;\n    }\n`, `\n    in highp vec2 vTextureCoord;\n    in vec3 waterNormal;\n    in vec3 sparkPlaneNormal;\n    in vec3 sparkDirection;\n    out vec4 fragColor;\n\n    uniform sampler2D uSampler;\n    uniform bool sparksEnabled;\n    uniform vec3 poolSize;\n\n    ` + sparksHelper + `` + swimmersHelperFunctions + `\n\n    void main(void) {\n        highp vec4 texelColor = texture(uSampler, vTextureCoord);\n        fragColor = vec4(texelColor.rgb, 0.5);\n        if (!sparksEnabled) return;\n        vec3 spark1 = sparks(gl_FragCoord.xy, vec3(2., 1., -poolSize.z / 2.), .1);\n        vec3 spark2 = sparks(gl_FragCoord.xy, vec3(-2., 1., -poolSize.z / 2.), .1);\n        vec3 spark = vec3(0., 0., 0.);\n        // spark = spark1 + spark2;\n        for (int i = 0; i < 10; i++) {\n            float i_float = float(i);\n            vec3 sparkPos = vec3(25. / 2. - 25. / 10. / 2. - i_float * 25./10., 1., -25.);\n            float reactionTime = getAttributeReactionTime(i);\n            spark += sparks(gl_FragCoord.xy, sparkPos, reactionTime);\n        }\n        // fragColor = vec4(mix(fragColor.rgb, spark, .5), max(0.5, 2.*length(spark)));\n        fragColor = vec4(mix(fragColor.rgb, spark, 2.*length(spark)), max(0.5, 2.*length(spark)));\n        // fragColor = vec4(fragColor.rgb + spark, max(0.5, 2.*length(spark)));\n        // float m = max(fragColor.r, max(fragColor.g, fragColor.b));\n        // if (m > 1.) fragColor.rgb /= m;\n        // fragColor = vec4(spark, 2.*length(spark));\n        // fragColor = vec4(1, 0, 0, 1);\n    }\n`);\n\n        this.mesh = GL.Mesh.plane({ width: 2., height: 2., coords: true, normals: true });\n        this.mesh.transform(GL.Matrix.rotate(90, 1, 0, 0));\n        this.mesh.transform(GL.Matrix.translate(0, .1, 0));\n        // Using `this.shader` (lightgl) for rendering; skip manual\n        // initShaderProgram/vsSource/fsSource which were undefined.\n        this.programInfo = null;\n\n        // Here's where we call the routine that builds all the\n        // objects we'll be drawing.\n        // this.buffers = initBuffers(gl);\n\n        this.texture = this.initTexture();\n        this.video = this.setupVideo(src);\n\n        // Flip image pixels into the bottom-to-top order that WebGL expects.\n        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n    }\n\n    render(time) {\n        const sparksParams = params.visualizations.sparks;\n        const poolSize = params.simulation.poolSize;\n        if (!params.visualizations.video.show) return;\n        if (this.copyVideo) {\n            this.updateTexture();\n        }\n\n        // Set up the mesh if not already compiled\n        if (!this.mesh.vertexBuffers || !this.mesh.vertexBuffers.vertex) {\n            this.mesh.compile();\n        }\n\n        // this.gl.enable(this.gl.CULL_FACE);\n        this.gl.enable(this.gl.BLEND);\n        this.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\n        // this.gl.blendFunc(this.gl.ONE, this.gl.ONE);\n        this.gl.activeTexture(this.gl.TEXTURE0);\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\n        if (Swimmer.swimmersAttributesTexture) Swimmer.swimmersAttributesTexture.bind(1);\n        this.shader.uniforms({\n            uSampler: 0,\n            swimmersHelperFunctions: 1,\n            iTime: time,\n            poolSize: [poolSize.x, poolSize.y, poolSize.z],\n            iResolution: [this.gl.canvas.width, this.gl.canvas.height],\n            sparksEnabled: sparksParams.enabled,\n            sparksGlow: sparksParams.glow,\n            sparksGlowOffset: sparksParams.glowOffset,\n            sparksStroke: sparksParams.stroke,\n            sparksNumber: sparksParams.num,\n            sparksLengthFactor: sparksParams.lengthFactor,\n            sparksSizeFactor: sparksParams.sizeFactor,\n            fov: sparksParams.fov\n        }).draw(this.mesh);\n        this.gl.disable(this.gl.BLEND);\n    }\n\n\n    initTexture() {\n        const texture = this.gl.createTexture();\n        this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n\n        // Because video has to be download over the internet\n        // they might take a moment until it's ready so\n        // put a single pixel in the texture so we can\n        // use it immediately.\n        const level = 0;\n        const internalFormat = this.gl.RGBA;\n        const width = 1;\n        const height = 1;\n        const border = 0;\n        const srcFormat = this.gl.RGBA;\n        const srcType = this.gl.UNSIGNED_BYTE;\n        const pixel = new Uint8Array([0, 0, 255, 255]); // opaque blue\n        this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            level,\n            internalFormat,\n            width,\n            height,\n            border,\n            srcFormat,\n            srcType,\n            pixel\n        );\n\n        // Turn off mips and set wrapping to clamp to edge so it\n        // will work regardless of the dimensions of the video.\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n        this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\n        return texture;\n    }\n\n    updateTexture() {\n        const level = 0;\n        const internalFormat = this.gl.RGBA;\n        const srcFormat = this.gl.RGBA;\n        const srcType = this.gl.UNSIGNED_BYTE;\n        this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\n        this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            level,\n            internalFormat,\n            srcFormat,\n            srcType,\n            this.video\n        );\n    }\n\n    setupVideo(url) {\n        const video = document.createElement(\"video\");\n\n        let playing = false;\n        let timeupdate = false;\n\n        video.playsInline = true;\n        video.muted = true;\n        video.loop = true;\n\n        // Waiting for these 2 events ensures\n        // there is data in the video\n\n        video.addEventListener(\n            \"playing\",\n            () => {\n                playing = true;\n                checkReady();\n            },\n            true\n        );\n\n        video.addEventListener(\n            \"timeupdate\",\n            () => {\n                timeupdate = true;\n                checkReady();\n            },\n            true\n        );\n\n        video.src = url;\n        video.play();\n        const this_ = this;\n        const checkReady = () => {\n            if (playing && timeupdate) {\n                this_.copyVideo = true;\n            }\n        }\n\n        return video;\n    }\n}\n\nexport { Video };","import GUI from \"three/examples/jsm/libs/lil-gui.module.min.js\";\nimport { params } from \"./params\";\nimport { MAX_SPARKS } from \"./video\";\n\nconst gui = new GUI();\n\n/**\n * \n * @param {WebGLRenderingContext} gl \n * @param {*} reset \n */\nconst createGUI = function (gl, reset) {\n    //const folder = gui.addFolder('variables');\n\n    const visualizationsFolder = gui.addFolder(\"visualizations\");\n    visualizationsFolder.close();\n    visualizationsFolder.add(params.visualizations, 'areaConservationEnabled', 'areaConservationEnabled').name('area conservation').listen();\n    visualizationsFolder.add(params.visualizations, \"showFlags\").name('show flags').listen();\n\n    const videoFolder = visualizationsFolder.addFolder(\"video\");\n    videoFolder.close();\n    videoFolder.add(params.visualizations.video, 'show').name(\"show\").listen();\n\n    // lengthFactor: 1.5, stroke: .004, num: 40 \n    const sparksFolder = visualizationsFolder.addFolder(\"Sparks\");\n    sparksFolder.close();\n    sparksFolder.add(params.visualizations.sparks, 'enabled').name(\"sparks enabled\");\n    sparksFolder.add(params.visualizations.sparks, 'glow', 1, 30).name(\"sparks glow factor\");\n    sparksFolder.add(params.visualizations.sparks, 'lengthFactor', 0.1, 10).name(\"sparks length factor\");\n    sparksFolder.add(params.visualizations.sparks, 'glowOffset', .1, 3).name(\"sparks glow offset\");\n    sparksFolder.add(params.visualizations.sparks, 'stroke', .001, .05).name(\"sparks stroke\");\n    sparksFolder.add(params.visualizations.sparks, 'num', 10, MAX_SPARKS).step(1).name(\"sparks number\");\n    sparksFolder.add(params.visualizations.sparks, 'sizeFactor', 10, 100).name(\"size factor\");\n\n    const shadowFolder = visualizationsFolder.addFolder(\"Swimmers shadows\");\n    shadowFolder.close();\n    shadowFolder.add(params.visualizations.shadow, \"enabled\").name(\"enable\");\n    shadowFolder.add(params.visualizations.shadow, \"shadowRadius\", 0, 2).name(\"shadow radius\");\n    shadowFolder.add(params.visualizations.shadow, \"shadowPower\", 0.1, 2).name(\"shadow power\");\n    shadowFolder.add(params.visualizations.shadow, \"showCircle\").name(\"circle\");\n    shadowFolder.add(params.visualizations.shadow, \"circleRadius\", .5, 2).name(\"circle radius\");\n    shadowFolder.add(params.visualizations.shadow, \"circleStroke\", .1, .5).name(\"circle stroke\");\n\n    const simulationFolder = gui.addFolder(\"Simulation\");\n    simulationFolder.close();\n    simulationFolder.add(params.simulation, \"optimized\").name(\"optimized\");\n    simulationFolder.add(params.simulation.poolSize, 'x', 1, 25).name('pool width').onChange(function (value) { reset(); }).listen();\n    simulationFolder.add(params.simulation.poolSize, 'z', 1, 50).name('pool height').onChange(function (value) { reset(); }).listen();\n    simulationFolder.add(params.simulation.poolSize, 'y', 1, 3).name('pool depth').onChange(function (value) { reset(); }).listen();\n    simulationFolder.add(params.simulation, 'waterDamping', 0.005, 0.15).name('water damping').listen();\n\n    const cameraFolder = gui.addFolder(\"camera\");\n    cameraFolder.close();\n    cameraFolder.add(params, 'focal', 28, 45).name('focal').listen().onChange(function (value) {\n        params.visualizations.sparks.fov = value * 2 * Math.PI / 360;\n        gl.matrixMode(gl.PROJECTION);\n        gl.loadIdentity();\n        gl.perspective(params.focal, gl.canvas.width / gl.canvas.height, 0.01, 100);\n        gl.matrixMode(gl.MODELVIEW);\n        console.log(\"perspective : \" + params.focal);\n    });\n}\n\nexport { createGUI };","/*\n * WebGL Water\n * http://madebyevan.com/webgl-water/\n *\n * Copyright 2011 Evan Wallace\n * Released under the MIT license\n */\n\nimport { Water } from './water.js';\nimport { Renderer } from './renderer.js';\nimport { Cubemap } from './cubemap.js';\nimport { Sphere } from './sphere.js';\nimport GL from './lightgl.js';\nimport { Video } from './video.js';\nimport { Swimmer } from './swimmer.js';\nimport { MAX_SPARKS } from './video.js';\nimport { params } from './params.js';\nimport { createGUI } from './gui.js';\n\n\nfunction text2html(text) {\n  return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\\n/g, '<br>');\n}\n\nfunction handleError(text) {\n  var html = text2html(text);\n  if (html == 'WebGL not supported') {\n    html = 'Your browser does not support WebGL.<br>Please see\\\n    <a href=\"http://www.khronos.org/webgl/wiki/Getting_a_WebGL_Implementation\">\\\n    Getting a WebGL Implementation</a>.';\n  }\n  var loading = document.getElementById('loading');\n  loading.innerHTML = html;\n  loading.style.zIndex = 1;\n}\n\nwindow.onerror = handleError\n/**@type {WebGLRenderingContext} */\nvar gl = GL.create();\n/**@type {Water} */\nvar water;\nvar cubemap;\n/**@type {Renderer} */\nvar renderer;\n/**@type {Swimmer[]} */\nconst swimmers = [];\nconst numSwimmers = 10;\nvar angleX = -25;\nvar angleY = -200.5;\nvar angleZ = 0;\nlet translateX = 0;\nlet translateY = 0;\nvar zoomDistance = 4.0;\n\nconst videoStartTime = 17;\nlet videoTime = 0;\nlet raceTime = 0;\nvar paused = false;\nvar flagCenter;\nvar flagSize;\nSwimmer.initAttributes(gl);\nlet resolution = new GL.Vector(256, 256);\nfunction updateResolutionWarning() {\n  document.getElementById('warning').hidden = !(resolution.x * resolution.y > 300000 && (water && params.visualizations.areaConservationEnabled));\n}\n\nlet timeSinceFrameRateUpdate = 0;\nlet frameRate = 0;\nlet frameRateCounter = 0;\nfunction updateFrameRateHTML(dt) {\n  timeSinceFrameRateUpdate += dt;\n  frameRate += 1 / dt;\n  frameRateCounter++;\n  if (timeSinceFrameRateUpdate >= 1) {\n    frameRate /= frameRateCounter;\n    document.getElementById('fps').innerText = `${(1 / dt).toFixed(1)} FPS`;\n    timeSinceFrameRateUpdate = 0;\n    frameRateCounter = 0;\n  }\n}\nfunction reset() {\n  console.log(\"reset\");\n  document.getElementById('resolution').innerText = `Resolution: ${resolution.x} x ${resolution.y}`;\n  updateResolutionWarning();\n  flagCenter = new GL.Vector(0., -params.simulation.poolSize.z / 2. + 1.);\n  water.reset(resolution);\n  renderer.flagCenter = flagCenter;\n  renderer.flagSize = flagSize;\n  renderer.reset();\n\n  const dx = params.simulation.poolSize.x / numSwimmers;\n  let x = -params.simulation.poolSize.x / 2 + dx / 2;\n  for (let swimmer of swimmers) {\n    swimmer.body.center.x = x;\n    swimmer.startingPoint.x = x;\n    x += dx;\n  }\n}\n\n\n\nwindow.onload = function () {\n  var ratio = window.devicePixelRatio || 1;\n  var help = document.getElementById('help');\n\n  function onresize() {\n    var width = innerWidth;\n    var height = innerHeight;\n    gl.canvas.width = width * ratio;\n    gl.canvas.height = height * ratio;\n    gl.canvas.style.width = width + 'px';\n    gl.canvas.style.height = height + 'px';\n    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);\n    gl.matrixMode(gl.PROJECTION);\n    gl.loadIdentity();\n    gl.perspective(params.focal, gl.canvas.width / gl.canvas.height, 0.01, 100);\n    gl.matrixMode(gl.MODELVIEW);\n    draw();\n  }\n\n  document.body.appendChild(gl.canvas);\n  gl.canvas.oncontextmenu = function (e) { e.preventDefault(); };\n  gl.clearColor(0, 0, 0, 1);\n\n  flagCenter = new GL.Vector(0., -params.simulation.poolSize.z / 2. + 1.);\n  flagSize = 0.7;\n  water = new Water(gl);\n  const video = new Video(gl, \"./video.mp4\");  // Empty path - use drag-and-drop instead\n  // video.video.src = \"./video.mp4\";\n\n  // Drop zone for MP4 files\n  const dropZone = document.getElementById('drop-zone');\n  let dragCounter = 0;\n\n  document.addEventListener('dragenter', (e) => {\n    dragCounter++;\n    dropZone.style.display = 'flex';\n  });\n\n  document.addEventListener('dragover', (e) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = 'copy';\n  });\n\n  document.addEventListener('dragleave', (e) => {\n    dragCounter--;\n    if (dragCounter === 0) {\n      dropZone.style.display = 'none';\n    }\n  });\n\n  document.addEventListener('drop', (e) => {\n    e.preventDefault();\n    dragCounter = 0;\n    dropZone.style.display = 'none';\n    const files = e.dataTransfer.files;\n    if (files.length > 0 && (files[0].type.startsWith('video/') || files[0].name.endsWith('.mp4'))) {\n      const url = URL.createObjectURL(files[0]);\n      video.video.src = url;\n      video.video.play();\n      console.log('Loaded:', files[0].name);\n    }\n  });\n\n  createGUI(gl, reset);\n  // folder.add(params, 'numSteps', 1, 10).step(1).name(\"number of simulation steps\");\n  renderer = new Renderer(gl, water, flagCenter, flagSize);\n  cubemap = new Cubemap({\n    xneg: document.getElementById('xneg'),\n    xpos: document.getElementById('xpos'),\n    yneg: document.getElementById('ypos'),\n    ypos: document.getElementById('ypos'),\n    zneg: document.getElementById('zneg'),\n    zpos: document.getElementById('zpos')\n  }, gl);\n\n\n  if (!water.textureA.canDrawTo() || !water.textureB.canDrawTo()) {\n    throw new Error('Rendering to floating-point textures is required but not supported');\n  }\n\n  const center = new GL.Vector(-0.4, -0.75, 0.2);\n  const center2 = new GL.Vector(0.4, -0.75, 0.2);\n  const s = new Swimmer(center);\n  const s2 = new Swimmer(center2)\n  for (let i = 0; i < 1; i++) swimmers.push(new Swimmer(center));\n  const radius = s.body.radius;\n  for (let swimmer of swimmers) water.addSwimmer(swimmer);\n  reset();\n\n  for (var i = 0; i < 20; i++) {\n    water.addDrop(Math.random() * 2 - 1, Math.random() * 2 - 1, 0.06, (i & 1) ? 0.01 : -0.01);\n  }\n\n  document.getElementById('loading').innerHTML = '';\n  onresize();\n\n  var requestAnimationFrame =\n    window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    function (callback) { setTimeout(callback, 0); };\n\n  var prevTime = new Date().getTime();\n  function animate() {\n    var nextTime = new Date().getTime();\n    if (!paused) {\n      update((nextTime - prevTime) / 1000, nextTime / 1000);\n      draw(nextTime);\n    }\n    prevTime = nextTime;\n    requestAnimationFrame(animate);\n  }\n  requestAnimationFrame(animate);\n\n  window.onresize = onresize;\n\n  var prevHit;\n  var planeNormal;\n  var swimmerSelected;\n  var mode = -1;\n  var MODE_ADD_DROPS = 0;\n  var MODE_MOVE_SPHERE = 1;\n  var MODE_ORBIT_CAMERA = 2;\n  const MODE_TRANSLATE_CAMERA = 3;\n\n  var oldX, oldY;\n\n  function startDrag(x, y, event) {\n    oldX = x;\n    oldY = y;\n    if (!event || event.button === 0) {\n      var tracer = new GL.Raytracer();\n      var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n      var pointOnPlane = tracer.eye.add(ray.multiply(-tracer.eye.y / ray.y));\n      for (let swimmer of swimmers) {\n        var sphereHitTest = GL.Raytracer.hitTestSphere(tracer.eye, ray, swimmer.body.center, swimmer.body.radius);\n        if (sphereHitTest) {\n          mode = MODE_MOVE_SPHERE;\n          swimmerSelected = swimmer;\n          swimmer.body.cinematic = true;\n          prevHit = sphereHitTest.hit;\n          planeNormal = tracer.getRayForPixel(gl.canvas.width / 2, gl.canvas.height / 2).negative();\n          return;\n        }\n      }\n      if (Math.abs(pointOnPlane.x) < params.simulation.poolSize.x / 2 && Math.abs(pointOnPlane.z) < params.simulation.poolSize.z / 2) {\n        mode = MODE_ADD_DROPS;\n        duringDrag(x, y);\n      }\n    } else if (event.button === 2) {\n      mode = MODE_ORBIT_CAMERA;\n    }\n    else if (event.button === 1) {\n      mode = MODE_TRANSLATE_CAMERA;\n    }\n  }\n\n  function duringDrag(x, y, e) {\n    switch (mode) {\n      case MODE_ADD_DROPS: {\n        var tracer = new GL.Raytracer();\n        var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n        var pointOnPlane = tracer.eye.add(ray.multiply(-tracer.eye.y / ray.y));\n        water.addDrop(pointOnPlane.x / params.simulation.poolSize.x * 2, pointOnPlane.z / params.simulation.poolSize.z * 2, 0.06, 0.03);\n        if (paused) {\n          water.updateNormals();\n          renderer.updateCaustics(water);\n        }\n        break;\n      }\n      case MODE_MOVE_SPHERE: {\n        var tracer = new GL.Raytracer();\n        var ray = tracer.getRayForPixel(x * ratio, y * ratio);\n        var t = -planeNormal.dot(tracer.eye.subtract(prevHit)) / planeNormal.dot(ray);\n        var nextHit = tracer.eye.add(ray.multiply(t));\n        const center = swimmerSelected.body.center.add(nextHit.subtract(prevHit));\n        const radius = swimmerSelected.body.radius;\n        const x_sphere = Math.max(radius - params.simulation.poolSize.x / 2, Math.min(params.simulation.poolSize.x / 2 - radius, center.x));\n        const y_sphere = Math.max(radius - params.simulation.poolSize.y, Math.min(10, center.y));\n        const z_sphere = Math.max(radius - params.simulation.poolSize.z / 2, Math.min(params.simulation.poolSize.z / 2 - radius, center.z));\n        swimmerSelected.body.move(new GL.Vector(x_sphere, y_sphere, z_sphere));\n        prevHit = nextHit;\n        if (paused) renderer.updateCaustics(water);\n        break;\n      }\n      case MODE_ORBIT_CAMERA: {\n        if (e && e.shiftKey) {\n          angleZ -= x - oldX;\n          angleZ = Math.max(-89.999, Math.min(89.999, angleZ));\n          break;\n        }\n        angleY -= x - oldX;\n        angleX -= y - oldY;\n        angleX = Math.max(-89.999, Math.min(89.999, angleX));\n        break;\n      }\n      case MODE_TRANSLATE_CAMERA: {\n        const factor = .001 * zoomDistance;\n        translateX += factor * (x - oldX);\n        translateY -= factor * (y - oldY);\n      }\n    }\n    oldX = x;\n    oldY = y;\n    if (paused) draw();\n  }\n\n  function stopDrag() {\n    mode = -1;\n    if (swimmerSelected) swimmerSelected.body.cinematic = !Swimmer.useGravity;\n  }\n\n  function isHelpElement(element) {\n    return element === help || element.parentNode && isHelpElement(element.parentNode);\n  }\n\n  function zoom(delta) {\n    zoomDistance *= 1 - delta * 0.0004;\n    zoomDistance = Math.max(2, Math.min(1000, zoomDistance));\n    if (paused) draw();\n  };\n\n  addEventListener('wheel', function (e) {\n    var delta = e.deltaY;\n    zoom(-delta);\n  });\n\n  document.onmousedown = function (e) {\n    if (!isHelpElement(e.target)) {\n      e.preventDefault();\n      startDrag(e.pageX, e.pageY, e);\n    }\n  };\n\n  document.onmousemove = function (e) {\n    duringDrag(e.pageX, e.pageY, e);\n  };\n\n  document.onmouseup = function () {\n    stopDrag();\n  };\n\n  document.ontouchstart = function (e) {\n    if (e.touches.length === 1 && !isHelpElement(e.target)) {\n      e.preventDefault();\n      startDrag(e.touches[0].pageX, e.touches[0].pageY, false);\n    }\n  };\n\n  document.ontouchmove = function (e) {\n    if (e.touches.length === 1) {\n      duringDrag(e.touches[0].pageX, e.touches[0].pageY);\n    }\n  };\n\n  document.ontouchend = function (e) {\n    if (e.touches.length == 0) {\n      stopDrag();\n    }\n  };\n\n  function startRace() {\n    Swimmer.raceHasStarted = true;\n    for (let swimmer of swimmers) swimmer.started = false;\n  }\n\n  function stopRace() {\n    Swimmer.raceHasStarted = false;\n    for (let swimmer of swimmers) swimmer.swim(false);\n  }\n\n\n  document.onkeydown = function (e) {\n    if (e.which == ' '.charCodeAt(0)) paused = !paused;\n    else if (e.which == 'G'.charCodeAt(0)) {\n      for (let swimmer of swimmers) swimmer.body.cinematic = !swimmer.body.cinematic;\n      Swimmer.useGravity = !Swimmer.useGravity;\n    }\n    else if (e.which == 'L'.charCodeAt(0) && paused) draw();\n    else if (e.which == 'J'.charCodeAt(0)) {\n      jump();\n    }\n    else if (e.which == 'C'.charCodeAt(0)) {\n      params.visualizations.areaConservationEnabled = !params.visualizations.areaConservationEnabled;\n      updateResolutionWarning();\n      console.log(\"Area conservation \" + (params.visualizations.areaConservationEnabled ? \"enabled.\" : \"disabled.\"));\n    }\n    else if (e.which == 'P'.charCodeAt(0)) {\n      water.showProjectionGrid = !water.showProjectionGrid;\n      console.log(\"Projection grid \" + (water.showProjectionGrid ? \"enabled.\" : \"disabled.\"));\n    }\n    else if (e.which == 'A'.charCodeAt(0)) {\n      water.showAreaConservedGrid = !water.showAreaConservedGrid;\n      console.log(\"Area conserved grid \" + (water.showAreaConservedGrid ? \"enabled.\" : \"disabled.\"));\n    }\n    else if (e.which == 'S'.charCodeAt(0)) {\n      Swimmer.swimming = !Swimmer.swimming;\n      if (Swimmer.swimming) {\n        for (let swimmer of swimmers) swimmer.swim(true);\n      }\n      else {\n        stopRace();\n      }\n      console.log(\"Swimming \" + (Swimmer.swimming ? \"enabled.\" : \"disabled.\"));\n    }\n    else if (e.which == 'V'.charCodeAt(0)) {\n      params.visualizations.video.show = !params.visualizations.video.show;\n    }\n    else if (e.which == 'O'.charCodeAt(0)) {\n      params.simulation.poolSize.x = 25;\n      params.simulation.poolSize.y = 2;\n      params.simulation.poolSize.z = 50;\n      // resolution = new GL.Vector(2048, 4096);\n      resolution.x = 1024;\n      resolution.y = 2048;\n\n      params.visualizations.areaConservationEnabled = false;\n\n      params.simulation.waterDamping = 0.1;\n\n      if (swimmers.length != numSwimmers) {\n        for (let i = swimmers.length; i < numSwimmers; i++) {\n          const s = new Swimmer(center);\n          swimmers.push(s);\n          water.addSwimmer(s);\n        }\n      }\n\n      videoTime = 0;\n      if (video.copyVideo) video.video.currentTime = videoTime;\n\n      reset();\n\n      params.focal = 31.75;\n      params.visualizations.sparks.fov = params.focal * 2 * Math.PI / 360;\n      gl.matrixMode(gl.PROJECTION);\n      gl.loadIdentity();\n      gl.perspective(params.focal, gl.canvas.width / gl.canvas.height, 0.01, 100);\n      gl.matrixMode(gl.MODELVIEW);\n      translateX = -0.42;\n      translateY = 1.18;\n      zoomDistance = 52.5;\n      angleX = -24;\n      angleY = -261.5;\n      angleZ = -4;\n      console.log(\"Olympic mode enabled.\");\n    }\n    else if (e.which == 'W'.charCodeAt(0)) {\n      if (Swimmer.raceHasStarted) {\n        Swimmer.raceHasStarted = false;\n        stopRace();\n        return;\n      }\n      water.WR_position = 0;\n      videoTime = videoStartTime;\n      if (video.copyVideo) video.video.currentTime = videoTime;\n      startRace();\n      Swimmer.useGravity = true;\n\n      for (let swimmer of swimmers) swimmer.hasDove = false;\n    }\n    else if (e.which == 'H'.charCodeAt(0)) {\n      document.getElementById(\"commands\").hidden = !document.getElementById(\"commands\").hidden;\n      document.getElementById(\"h\").hidden = !document.getElementById(\"h\").hidden;\n    }\n    else if (e.which == 40) { // down\n      if (resolution.x > 129)\n        resolution.x = Math.round(resolution.x / 2);\n      reset();\n      console.log(\"decreasing x resolution\");\n    }\n    else if (e.which == 38) { // up\n      if (resolution.x < 16384)\n        resolution.x = Math.round(resolution.x * 2);\n      reset();\n      console.log(\"increasing x resolution\");\n    }\n    else if (e.which == 37) { // left\n      if (resolution.y > 129)\n        resolution.y = Math.round(resolution.y / 2);\n      reset();\n      console.log(\"decreasing y resolution\");\n    }\n    else if (e.which == 39) { // right\n      if (resolution.y < 16384)\n        resolution.y = Math.round(resolution.y * 2);\n      reset();\n      console.log(\"increasing y resolution\");\n    }\n  };\n\n\n  function getArmOffset(time, phase) {\n    return new GL.Vector(0., Math.cos(armPulsation * time + phase), Math.sin(armPulsation * time + phase)).multiply(armAmplitude);\n  }\n\n  var frame = 0;\n\n  function update(dt, time) {\n    if (dt > 1) return;\n    frame += dt * 2;\n\n    if (mode == MODE_MOVE_SPHERE) {\n      // Start from rest when the player releases the mouse after moving the sphere\n      for (let swimmer of swimmers) swimmer.body.velocity = new GL.Vector(0, 0, 0);\n    }\n    raceTime = videoTime - videoStartTime;\n\n    // Update the water simulation and graphics\n    for (let swimmer of swimmers) swimmer.update(dt, raceTime);\n    water.updateSpheres(dt);\n    for (let i = 0; i < params.numSteps; i++) {\n      water.stepSimulation();\n    }\n\n    renderer.updateCaustics(water);\n    videoTime += dt;\n    updateFrameRateHTML(dt);\n\n  }\n\n  function draw(time) {\n    // Change the light direction to the camera look vector when the L key is pressed\n    if (GL.keys.L) {\n      renderer.lightDir = GL.Vector.fromAngles((90 - angleY) * Math.PI / 180, -angleX * Math.PI / 180);\n      if (paused) renderer.updateCaustics(water);\n    }\n    if (params.visualizations.showFlags) Swimmer.updateAttributesTexture(swimmers);\n    water.addOrRemoveVisualizationWaves(true, swimmers, raceTime);\n    water.updateNormals();\n\n    /**@type {WebGLRenderingContext} */\n    const g = gl;\n    // g.clearColor(1, 1, 1, 1);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    gl.loadIdentity();\n    gl.translate(translateX, translateY, -zoomDistance);\n    gl.rotate(-angleZ, 0, 0, 1);\n    gl.rotate(-angleX, 1, 0, 0);\n    gl.rotate(-angleY, 0, 1, 0);\n    gl.translate(0, 0.5, 0);\n\n\n    gl.enable(gl.DEPTH_TEST);\n    renderer.sphereCenter = swimmers[0].body.center;\n    renderer.sphereRadius = radius;\n    renderer.renderCube(water);\n    renderer.renderWater(water, cubemap, swimmers, raceTime, params.visualizations.shadow);\n    renderer.renderSpheres(water);\n    // Swimmer.attributes.draw();\n    video.render(raceTime);\n    gl.disable(gl.DEPTH_TEST);\n    water.addOrRemoveVisualizationWaves(false, swimmers, raceTime);\n  }\n};"],"names":["GL","gl","options","canvas","addMatrixStack","addImmediateMode","addEventListeners","addOtherMethods","Matrix","Indexer","Buffer","Mesh","HitTest","Raytracer","Shader","Texture","Vector","ENUM","tempMatrix","resultMatrix","modelviewStack","projectionStack","matrix","stack","mode","m","from","to","i","fov","aspect","near","far","l","r","b","t","n","f","x","y","z","a","ex","ey","ez","cx","cy","cz","ux","uy","uz","hasFloat32Array","objX","objY","objZ","modelview","projection","viewport","point","winX","winY","winZ","immediateMode","pointSize","g","s","context","oldX","oldY","buttons","hasOld","has","isDragging","augment","original","e","name","callback","obj","mousedown","on","mousemove","mouseup","off","reset","resetAll","mapKeyCode","code","named","element","key","post","time","update","now","top","left","right","bottom","resize","v","result","det","c","u","target","type","data","chunk","spacing","attribute","buffer","invTrans","normal","indexer","j","aabb","sphere","mesh","detailX","detailY","W","H","cubeData","pickOctant","w","h","d","cd","vertex","tri","flip","fix","detail","octant","scale","json","hit","other","axisX","axisY","axisZ","offset","minX","maxX","minY","maxY","ray0","ray1","origin","ray","min","max","tMin","tMax","t1","t2","tNear","tFar","epsilon","center","radius","discriminant","ab","ac","toHit","dot00","dot01","dot02","dot11","dot12","divide","regexMap","regex","text","LIGHTGL_PREFIX","vertexSource","fragmentSource","followScriptTagById","id","header","vertexHeader","fragmentHeader","source","usedMatrices","groups","capitalLetters","replaced","match","compileSource","shader","isSampler","isArray","str","isNumber","uniforms","location","value","vertexBuffers","indexBuffer","used","MVM","PM","MVMI","PMI","MVPM","matrices","length","width","height","internalFormat","format","extFloat","extHalf","magFilter","minFilter","framebuffer","renderbuffer","checkerboardCanvas","unit","temp","image","texture","url","theta","phi","fraction","params","GRAVITY","Sphere","dt","percentUnderWater","floatingForce","drag","force","newCenter","ARM_DELTA_X","FOOT_DELTA_X","FOOT_DELTA_Z","numAttributes","NUM_VEC_ATTRIBUTES","MAX_NUM_SWIMMER","pointVertexShaderSource","pointFragmentShaderSource","volumeVertexShaderSource","volumeFragmentShaderSource","vertexBuffer","indices","SwimmersAttributes","__privateAdd","_SwimmersAttributes_instances","filter","swimmers","numSpheres","indexFirst","__privateMethod","findFirst_fn","swimmer","first","addSwimmerInformation_fn","addSphereInformation_fn","shaderSource","shaderType","shaders","program","vs","fs","attachmentPoint","N","vertexLocation","poolSizeLocation","horizontalLocation","showLocation","swapColorLocation","sizeVertex","normalize","stride","data1Location","data2Location","data3Location","invPoolSizeLocation","size","sizeof_float","maxDist","dist","index","gaussianRandom","mean","stdev","AWAY","armAmplitude","armFrequency","armPulsation","_Swimmer","armRadius","start","phase","offset1","offset2","offset3","offset4","__publicField","resolution","Swimmer","swimmersHelperFunctions","Water","vertexShader","strength","this_","add","raceTime","swimmersAttributesTexture","oldCenter","readType","readArrayType","readExt","status","readBuf","writeBuf","dx_proj","dz_proj","dx_proj_sq","dz_proj_sq","indexAreaConservation","dy","dx","dz","textHelperFunctions","helperFunctions","Renderer","water","flagCenter","flagSize","hasDerivatives","sky","shadowParams","tracer","Cubemap","images","MAX_SPARKS","sparksHelper","Video","src","sparksParams","poolSize","level","border","srcFormat","srcType","pixel","video","playing","timeupdate","checkReady","gui","GUI","createGUI","visualizationsFolder","videoFolder","sparksFolder","shadowFolder","simulationFolder","cameraFolder","text2html","handleError","html","loading","cubemap","renderer","numSwimmers","angleX","angleY","angleZ","translateX","translateY","zoomDistance","videoStartTime","videoTime","paused","updateResolutionWarning","timeSinceFrameRateUpdate","updateFrameRateHTML","ratio","help","onresize","draw","dropZone","dragCounter","files","center2","requestAnimationFrame","prevTime","animate","nextTime","prevHit","planeNormal","swimmerSelected","MODE_ADD_DROPS","MODE_MOVE_SPHERE","MODE_ORBIT_CAMERA","MODE_TRANSLATE_CAMERA","startDrag","event","pointOnPlane","sphereHitTest","duringDrag","nextHit","x_sphere","y_sphere","z_sphere","factor","stopDrag","isHelpElement","zoom","delta","startRace","stopRace"],"mappings":"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"}